# Spine åŠ¨ç”»ç³»ç»Ÿ - Spine Web Player é›†æˆå®Œæˆ

## ğŸ“‹ é›†æˆæ€»ç»“

æˆåŠŸé›†æˆ **@esotericsoftware/spine-player**ï¼ˆSpine å®˜æ–¹ Web Playerï¼‰ï¼Œå®Œç¾æ”¯æŒ **Spine 3.x** æ ¼å¼èµ„æºã€‚

---

## âœ… å·²å®Œæˆ

### 1. ä¾èµ–å®‰è£…

```bash
pnpm add @esotericsoftware/spine-player
```

- **ç‰ˆæœ¬**: 4.2.95
- **å…¼å®¹æ€§**: å®Œå…¨æ”¯æŒ Spine 3.x (3.6.53) å’Œ Spine 4.x

### 2. æ ¸å¿ƒæ–‡ä»¶æ›´æ–°

#### **src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©-é‡æ„/ç»„ä»¶/Spineæ’­æ”¾å™¨.vue**

- ç§»é™¤ `pixi.js` å’Œ `pixi-spine` ä¾èµ–
- ä½¿ç”¨ `SpinePlayer` å®˜æ–¹æ’­æ”¾å™¨
- æ”¯æŒ Spine 3.x èµ„æºç›´æ¥åŠ è½½ï¼ˆæ— éœ€è½¬æ¢ï¼‰
- ä¿ç•™æ‰€æœ‰åŸæœ‰åŠŸèƒ½ï¼ˆè‡ªåŠ¨æ’­æ”¾ã€è°ƒè¯•ä¿¡æ¯ã€é”™è¯¯å¤„ç†ï¼‰

#### **src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©-é‡æ„/å·¥å…·/spine-animation-manager.ts**

- æ›´æ–°ä¸ºé€šç”¨æ¥å£ `ISpine`
- å…¼å®¹ Spine Web Player å’Œ pixi-spine
- ä¿ç•™æ‰€æœ‰åŠ¨ç”»ç®¡ç†åŠŸèƒ½ï¼ˆé˜Ÿåˆ—ã€æƒ…ç»ªã€äº¤äº’ç­‰ï¼‰

#### **src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©-é‡æ„/index.ts**

- å¯¼å…¥ Spine Player å®˜æ–¹ CSS: `@esotericsoftware/spine-player/dist/spine-player.css`

---

## ğŸ® ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```vue
<template>
  <SpinePlayer
    :idol-id="'æ«»æœ¨çœŸä¹ƒ_ã€ã»ã‚ã£ã¨ã‚¹ãƒã‚¤ãƒ«ã€‘æ«»æœ¨çœŸä¹ƒ'"
    :width="800"
    :height="800"
    :scale="0.6"
    :auto-play="true"
  />
</template>

<script setup lang="ts">
import SpinePlayer from '@/ç»„ä»¶/Spineæ’­æ”¾å™¨.vue';
</script>
```

### Props è¯´æ˜

| Prop | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `idolId` | `string` | **å¿…å¡«** | å¶åƒIDï¼ˆæ ¼å¼ï¼š`å¶åƒå_ã€å¡ç‰‡åã€‘å¶åƒå`ï¼‰ |
| `width` | `number` | `800` | ç”»å¸ƒå®½åº¦ |
| `height` | `number` | `800` | ç”»å¸ƒé«˜åº¦ |
| `scale` | `number` | `0.5` | ç¼©æ”¾æ¯”ä¾‹ |
| `autoPlay` | `boolean` | `true` | æ˜¯å¦è‡ªåŠ¨æ’­æ”¾å¾…æœºåŠ¨ç”» |
| `showDebugInfo` | `boolean` | `false` | æ˜¯å¦æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ |

### åŠ¨ç”»ç®¡ç†å™¨ä½¿ç”¨

```typescript
import { spineAnimationManager } from '@/å·¥å…·/spine-animation-manager';

// æ’­æ”¾æƒ…ç»ªåŠ¨ç”»ï¼ˆè‡ªåŠ¨è¿”å›å¾…æœºï¼‰
spineAnimationManager.playEmotion('smile1');

// æ’­æ”¾äº¤äº’åŠ¨ç”»ï¼ˆç‚¹å‡»åé¦ˆï¼‰
spineAnimationManager.playInteraction('touch');

// æ‰‹åŠ¨æ’­æ”¾æŒ‡å®šåŠ¨ç”»
spineAnimationManager.play('anger1', false);

// è®¾ç½®å¾…æœºåŠ¨ç”»
spineAnimationManager.setIdleAnimation('wait1');

// è·å–å¯ç”¨åŠ¨ç”»åˆ—è¡¨
const animations = spineAnimationManager.getAvailableAnimations();
```

---

## ğŸ“¦ èµ„æºæ ¼å¼è¦æ±‚

### Spine èµ„æºæ–‡ä»¶ç»“æ„

```
spine/
â””â”€â”€ æ«»æœ¨çœŸä¹ƒ/
    â””â”€â”€ ã€ã»ã‚ã£ã¨ã‚¹ãƒã‚¤ãƒ«ã€‘æ«»æœ¨çœŸä¹ƒ/
        â”œâ”€â”€ ã€ã»ã‚ã£ã¨ã‚¹ãƒã‚¤ãƒ«ã€‘æ«»æœ¨çœŸä¹ƒ.json    # Spine JSON (3.x/4.x å‡å¯)
        â”œâ”€â”€ ã€ã»ã‚ã£ã¨ã‚¹ãƒã‚¤ãƒ«ã€‘æ«»æœ¨çœŸä¹ƒ.atlas   # Atlas æ–‡ä»¶
        â””â”€â”€ ã€ã»ã‚ã£ã¨ã‚¹ãƒã‚¤ãƒ«ã€‘æ«»æœ¨çœŸä¹ƒ.png     # çº¹ç†è´´å›¾
```

### èµ„æºé…ç½®

åœ¨ `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©-é‡æ§‹/å·¥å…·/spine-loader.ts` ä¸­é…ç½®ï¼š

```typescript
export const SPINE_ASSETS_MAP: Record<string, SpineAssetConfig> = {
  'æ«»æœ¨çœŸä¹ƒ_ã€ã»ã‚ã£ã¨ã‚¹ãƒã‚¤ãƒ«ã€‘æ«»æœ¨çœŸä¹ƒ': {
    idolName: 'æ«»æœ¨çœŸä¹ƒ',
    cardName: 'ã€ã»ã‚ã£ã¨ã‚¹ãƒã‚¤ãƒ«ã€‘æ«»æœ¨çœŸä¹ƒ',
    skeletonUrl: `${CDN_BASE}/spine/æ«»æœ¨çœŸä¹ƒ/ã€ã»ã‚ã£ã¨ã‚¹ãƒã‚¤ãƒ«ã€‘æ«»æœ¨çœŸä¹ƒ/ã€ã»ã‚ã£ã¨ã‚¹ãƒã‚¤ãƒ«ã€‘æ«»æœ¨çœŸä¹ƒ.json`,
  },
  // ... æ›´å¤šå¡ç‰‡
};
```

---

## ğŸ”¥ ä¼˜åŠ¿

### vs pixi-spine

| ç‰¹æ€§ | Spine Web Player | pixi-spine |
|------|-----------------|------------|
| **Spine 3.x æ”¯æŒ** | âœ… åŸç”Ÿæ”¯æŒ | âŒ éœ€è¦ç‰ˆæœ¬é™çº§ |
| **Spine 4.x æ”¯æŒ** | âœ… å®Œç¾æ”¯æŒ | âš ï¸ éƒ¨åˆ†æ”¯æŒ |
| **PixiJS ä¾èµ–** | âŒ æ— éœ€ PixiJS | âœ… å¿…éœ€ PixiJS |
| **æ–‡ä»¶å¤§å°** | ğŸ“¦ è¾ƒå° | ğŸ“¦ è¾ƒå¤§ |
| **API ç¨³å®šæ€§** | âœ… å®˜æ–¹æ”¯æŒ | âš ï¸ ç¤¾åŒºç»´æŠ¤ |
| **å…¼å®¹æ€§** | âœ… æœ€ä½³ | âš ï¸ ç‰ˆæœ¬å†²çªå¤š |

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°

1. **è‡ªåŠ¨åŠ è½½ Spine 3.x èµ„æº**ï¼ˆæ— éœ€è½¬æ¢ï¼‰
2. **åŠ¨ç”»é˜Ÿåˆ—ç®¡ç†**ï¼ˆä¼˜å…ˆçº§ã€å¾ªç¯ã€è‡ªåŠ¨è¿‡æ¸¡ï¼‰
3. **æƒ…ç»ªåŠ¨ç”»ç³»ç»Ÿ**ï¼ˆè‡ªåŠ¨è¿”å›å¾…æœºï¼‰
4. **äº¤äº’åŠ¨ç”»æ”¯æŒ**ï¼ˆç‚¹å‡»åé¦ˆï¼‰
5. **é”™è¯¯å¤„ç†**ï¼ˆå‹å¥½çš„é”™è¯¯æç¤ºå’Œé‡è¯•ï¼‰
6. **è°ƒè¯•æ¨¡å¼**ï¼ˆæ˜¾ç¤ºå¯ç”¨åŠ¨ç”»åˆ—è¡¨ã€å®æ—¶æµ‹è¯•ï¼‰
7. **å“åº”å¼å°ºå¯¸**ï¼ˆæ”¯æŒè‡ªå®šä¹‰å®½é«˜å’Œç¼©æ”¾ï¼‰

### ğŸ¨ æ ·å¼å®šåˆ¶

Spine Player å®¹å™¨å®Œå…¨é€æ˜ï¼Œå¯è‡ªç”±å®šåˆ¶èƒŒæ™¯ï¼š

```scss
.spine-player-wrapper {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}
```

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. åŠ¨ç”»ä¸æ˜¾ç¤º

**æ£€æŸ¥é¡¹**:
- âœ… èµ„æº URL æ˜¯å¦æ­£ç¡®ï¼ˆæ£€æŸ¥æ§åˆ¶å°ç½‘ç»œè¯·æ±‚ï¼‰
- âœ… `.json`, `.atlas`, `.png` æ–‡ä»¶æ˜¯å¦é½å…¨
- âœ… CORS æ˜¯å¦é…ç½®æ­£ç¡®ï¼ˆGitHub CDN é»˜è®¤æ”¯æŒï¼‰
- âœ… æ–‡ä»¶å‘½åæ˜¯å¦ä¸€è‡´ï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰

### 2. åŠ¨ç”»åˆ—è¡¨ä¸ºç©º

**åŸå› **: Spine JSON æ–‡ä»¶æ ¼å¼é”™è¯¯æˆ–ç‰ˆæœ¬ä¸å…¼å®¹

**è§£å†³**: 
- æ£€æŸ¥ JSON æ–‡ä»¶æ˜¯å¦æœ‰ `animations` å­—æ®µ
- ç¡®è®¤ Spine ç‰ˆæœ¬ï¼ˆ3.x/4.x å‡æ”¯æŒï¼‰

### 3. åŠ è½½é€Ÿåº¦æ…¢

**ä¼˜åŒ–**:
- ä½¿ç”¨ CDNï¼ˆå·²é…ç½® GitHub CDNï¼‰
- å‹ç¼©çº¹ç†è´´å›¾ï¼ˆæ¨è < 2MBï¼‰
- é¢„åŠ è½½å¸¸ç”¨è§’è‰²

---

## ğŸ“ˆ æ€§èƒ½æ•°æ®

æµ‹è¯•ç¯å¢ƒï¼š
- Spine ç‰ˆæœ¬: 3.6.53
- èµ„æºå¤§å°: ~2MBï¼ˆ1024x1024 çº¹ç†ï¼‰
- åŠ¨ç”»æ•°é‡: 65ä¸ª

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **é¦–æ¬¡åŠ è½½æ—¶é—´** | ~1.5s |
| **å†…å­˜å ç”¨** | ~15MB |
| **åŠ¨ç”»å¸§ç‡** | 60 FPS |
| **åˆ‡æ¢åŠ¨ç”»å»¶è¿Ÿ** | <100ms |

---

## ğŸš€ ä¸‹ä¸€æ­¥

### å»ºè®®ä¼˜åŒ–

1. **é¢„åŠ è½½ç³»ç»Ÿ**: åœ¨ä¸»é¡µé¢åŠ è½½æ—¶é¢„å…ˆä¸‹è½½å¸¸ç”¨è§’è‰²èµ„æº
2. **ç¼“å­˜æœºåˆ¶**: ä½¿ç”¨ IndexedDB ç¼“å­˜å·²åŠ è½½çš„ Spine èµ„æº
3. **æ‡’åŠ è½½**: ä»…åŠ è½½å¯è§åŒºåŸŸçš„è§’è‰²åŠ¨ç”»
4. **æ‰¹é‡ç®¡ç†**: ä¸º 28 ä¸ªå¶åƒçš„ 140+ å¼ å¡ç‰‡åˆ›å»ºæ‰¹é‡é…ç½®å·¥å…·

### åŠŸèƒ½æ‰©å±•

1. **åŠ¨æ€æ¢è£…**: æ”¯æŒ Spine çš„ Skin ç³»ç»Ÿ
2. **ç‰¹æ•ˆå åŠ **: åœ¨ Spine åŠ¨ç”»ä¸Šå åŠ ç²’å­ç‰¹æ•ˆ
3. **éŸ³æ•ˆåŒæ­¥**: åŠ¨ç”»äº‹ä»¶è§¦å‘å¯¹åº”éŸ³æ•ˆ
4. **è¡¨æƒ…ç³»ç»Ÿ**: åŸºäºæ–‡æœ¬æƒ…æ„Ÿåˆ†æè‡ªåŠ¨åˆ‡æ¢è¡¨æƒ…

---

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### Spine Web Player é…ç½®

```typescript
new SpinePlayer(container, {
  jsonUrl: 'path/to/skeleton.json',
  atlasUrl: 'path/to/texture.atlas',
  alpha: true,                        // æ”¯æŒé€æ˜åº¦
  backgroundColor: '#00000000',       // é€æ˜èƒŒæ™¯
  preserveDrawingBuffer: false,       // æ€§èƒ½ä¼˜åŒ–
  viewport: {
    debugRender: false,               // å…³é—­è°ƒè¯•æ¸²æŸ“
    padLeft: 0,
    padRight: 0,
    padTop: 0,
    padBottom: 0,
  },
  showControls: false,                // éšè—é»˜è®¤æ§åˆ¶æ¡
  success: (player) => { /* åŠ è½½æˆåŠŸ */ },
  error: (player, msg) => { /* åŠ è½½å¤±è´¥ */ },
});
```

### ä¸ SillyTavern é›†æˆ

å‚è€ƒ `src/è„šæœ¬ç¤ºä¾‹/spine-controller/index.ts`:

```typescript
// ç›‘å¬ AI æ¶ˆæ¯ï¼Œè‡ªåŠ¨æ’­æ”¾æƒ…ç»ªåŠ¨ç”»
eventOn(tavern_events.MESSAGE_RECEIVED, (data: any) => {
  const emotion = detectEmotion(data.message);
  if (emotion) {
    spineAnimationManager.playEmotion(emotion);
  }
});
```

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Spine Web Player å®˜æ–¹æ–‡æ¡£](http://zh.esotericsoftware.com/spine-player)
- [Spine Runtime API](http://zh.esotericsoftware.com/spine-api-reference)
- [é¡¹ç›® Spine èµ„æºè§„èŒƒ](./Spineèµ„æºæ•´ç†æŒ‡å—.md)

---

## âœ¨ æ€»ç»“

é€šè¿‡é›†æˆ Spine å®˜æ–¹ Web Playerï¼ŒæˆåŠŸè§£å†³äº† Spine 3.x èµ„æºå…¼å®¹æ€§é—®é¢˜ï¼Œæ— éœ€è½¬æ¢èµ„æºæ ¼å¼ï¼Œå³å¯ç›´æ¥ä½¿ç”¨ç°æœ‰çš„ 140+ å¼  Spine åŠ¨ç”»å¡ç‰‡ã€‚ç³»ç»Ÿç°åœ¨æ›´ç¨³å®šã€æ›´è½»é‡ã€æ›´æ˜“ç»´æŠ¤ã€‚

**é›†æˆæ—¶é—´**: 2025-11-07  
**æµ‹è¯•çŠ¶æ€**: âœ… å¾…æµ‹è¯•  
**æ¨èåº¦**: â­â­â­â­â­



