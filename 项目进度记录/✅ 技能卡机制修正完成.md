# ✅ 技能卡机制修正完成

## 🔧 重要修正说明

根据用户反馈和《学园偶像大师》实际游戏截图，发现并修正了技能卡机制的**核心设计错误**。

---

## ❌ 之前的错误理解

### 错误描述：
之前文档中错误地认为技能卡可以**直接提升Vocal/Dance/Visual三维**，例如：

```
❌ 错误示例（已修正）：
- "全力Vocal"（3费）：获得 [Vocal] × 3.0 的分数
- "舞台支配"（4费）：获得 [Dance] × 4.0 的分数
- "永恒的高潮"（5费）：获得 [Vocal] × 7.0 的分数
```

这种理解与实际游戏机制**完全不符**！

---

## ✅ 正确的游戏机制

### 核心原理

#### 1. **技能卡的真实作用**

技能卡**不直接提升**Vocal/Dance/Visual三维，而是操作：

| 效果类型     | 说明                                                  | 真实示例（来自学园偶像大师）                             |
| ------------ | ----------------------------------------------------- | -------------------------------------------------------- |
| **属性操作** | 获得/消耗：元气、干劲、精力、专注、集中、活力、全力值 | 元气+10、干劲+4、消耗专注3、全力值消耗3点                |
| **Buff获得** | 获得持续性状态效果                                    | 状态良好+2回合、好调+3回合、集中+2层、体力消耗减少+2回合 |
| **Buff消耗** | 消耗Buff以触发更强效果                                | 消耗状态良好1回合，下一张卡效果发动2次                   |
| **数值增幅** | 提升训练/比赛的得分效率                               | 数值上升量增加20%、好印象增加为1.1倍                     |
| **特殊效果** | 改变游戏规则的效果                                    | 技能卡使用数+1、将3张SSR移至牌堆顶、下回合手牌+2         |
| **消耗体力** | 需要消耗体力才能使用                                  | 消耗5体力、体力消耗减少+2回合                            |

#### 2. **Vocal/Dance/Visual三维的真实作用**

三维**不是技能卡的效果**，而是作为**分数乘区**：

1. **设置审查基准**：决定比赛中Vocal/Dance/Visual回合的分布比例
   - 例如：Vocal审查基准最高的偶像，比赛中Vocal回合占比最多

2. **提供分数乘区**：在训练/比赛中，三维越高，在对应主题回合中获得的最终得分越高
   - Vocal回合：技能卡基础得分 × Vocal三维加成倍率 = 最终得分
   - Dance回合：技能卡基础得分 × Dance三维加成倍率 = 最终得分
   - Visual回合：技能卡基础得分 × Visual三维加成倍率 = 最终得分

#### 3. **完整的得分流程**

```
┌─────────────────────────────────────────────────────────┐
│  训练/比赛得分流程                                      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. 打出技能卡                                          │
│     ↓                                                   │
│     效果：元气+10、干劲+4、状态良好+2回合               │
│     （不直接提升Vocal/Dance/Visual）                    │
│                                                         │
│  2. 技能卡产生基础得分                                  │
│     ↓                                                   │
│     基础得分受元气、干劲、专注、集中等属性影响          │
│     也受状态良好、好调等Buff影响                        │
│                                                         │
│  3. 当前回合属性主题判定                                │
│     ↓                                                   │
│     比赛/训练回合类型：Vocal回合 or Dance回合 or Visual回合 │
│                                                         │
│  4. 应用三维加成倍率                                    │
│     ↓                                                   │
│     最终得分 = 基础得分 × 对应三维加成倍率              │
│     - Vocal回合：基础得分 × (Vocal三维 / 基准值)        │
│     - Dance回合：基础得分 × (Dance三维 / 基准值)        │
│     - Visual回合：基础得分 × (Visual三维 / 基准值)      │
│                                                         │
│  5. 累计总得分                                          │
│     ↓                                                   │
│     训练：根据总得分判定Perfect/Clear/Fail              │
│     比赛：根据总得分与对手比较，判定排名                │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 📸 真实游戏截图验证

根据用户提供的《学园偶像大师》截图，真实技能卡效果如下：

### 1. **觉醒**（3费，感性）
- **效果**：状态良好消耗1回合，数值+3（2次）；专注+4，不可重复
- **强化效果**：状态良好消耗1回合，数值+4（2次）；专注+6，不可重复
- ✅ 没有直接提升Vocal/Dance/Visual

### 2. **国民的偶像**（-1费，SSR，感性）
- **效果**：消耗状态良好1回合，下一张使用的技能卡效果额外发动1次；技能卡使用数+1，课程中限1次，不可重复
- **强化效果**：消耗状态良好1回合，活力+8，下一张使用的技能卡效果额外发动1次；技能卡使用数+1，课程中限1次，不可重复
- ✅ 没有直接提升Vocal/Dance/Visual

### 3. **天赋之才**（-5费，感性）
- **效果**：消耗5体力，好调+3回合，集中+2，将抽牌堆和弃牌中的随机3张SSR技能卡移动到抽牌堆最上方；下一回合，技能卡使用数+1
- **强化效果**：消耗4体力，好调+3回合，集中+4，将抽牌堆和弃牌中的随机3张SSR技能卡移动到抽牌堆最上方；下一回合，技能卡使用数+1
- ✅ 没有直接提升Vocal/Dance/Visual

### 4. **理性技能卡**（2费，理性）
- **效果**：元气+2，干劲+4，数值上升量增加10%，好印象在15以上时，此后的3回合，回合开始时，好印象增加为1.1倍，课程中限1次，不可重复
- **强化效果**：元气+2，干劲+5，数值上升量增加20%，好印象在15以上时，此后的3回合，回合开始时，好印象增加为1.1倍，课程中限1次，不可重复
- ✅ 没有直接提升Vocal/Dance/Visual

### 5. **魅惑视线**（-3费，SSR，感性）
- **效果**：消耗专注3；获得：状态绝佳+4回合；体力消耗减少+2回合；技能卡使用数+1；课程中限1次，不可重复
- **强化效果**：消耗专注3；获得：状态绝佳+5回合；体力消耗减少+5回合；技能卡使用数+1；课程中限1次，不可重复
- ✅ 没有直接提升Vocal/Dance/Visual

### 6. **成为偶像**（-3费，非凡）
- **效果**：全力值消耗3点；技能卡使用数+1；手牌内可提升数值卡可额外触发一次数值增加，课程中限1次，不可重复
- **强化效果**：全力值消耗3点；精力+4，状态调整至温存，技能卡使用数+1；手牌内可提升数值卡可额外触发一次数值增加，课程中限1次，不可重复
- ✅ 没有直接提升Vocal/Dance/Visual

---

## 📝 已修正的文件

### 1. `E:\偶像大师\闪耀色彩卡牌机制说明.txt`

#### 修正位置1：第143-151行 - 卡片效果示例
```txt
✅ 修正后：
**卡片效果示例**（基于学园偶像大师）：
- **属性操作**：元气+10、干劲+4、专注+3、消耗全力值3点
- **Buff效果**：状态良好+2回合、好调+3回合、集中+2层、体力消耗减少+2回合
- **数值增幅**：数值上升量增加20%、好印象增加为1.1倍、得分+X（基于当前属性）
- **特殊效果**：技能卡使用数+1、下一张卡效果发动2次、将3张SSR移至牌堆顶
- **消耗/回复体力**：消耗5体力、体力回复+2

**注意**：技能卡不直接提升Vocal/Dance/Visual三维，而是通过属性和Buff间接影响训练/比赛得分
```

#### 修正位置2：第174-221行 - 专属技能卡（AI生成）
```txt
✅ 新增重要说明：
- ❌ 技能卡**不直接提升Vocal/Dance/Visual三维**
- ✅ 技能卡的效果主要包括：**属性操作**（元气、干劲、专注等）、**Buff效果**（状态良好、好调等）、**特殊效果**（使用数+1、数值增幅等）
- ✅ Vocal/Dance/Visual三维的作用：
  1. 设置**审查基准**（决定比赛中各属性回合的分布）
  2. 在比赛/训练中提供**分数乘区**（三维越高，在对应主题回合内，技能卡获得的分数越高）

✅ 新增效果类型示例表
✅ 新增真实示例（基于学园偶像大师）
✅ 新增AI生成技能卡的提示词要求
```

#### 修正位置3：第381-394行 - 比赛流程
```txt
✅ 修正后：
**比赛流程**：
1. 进入打牌界面
2. 使用技能卡获取基础得分（技能卡效果包括：元气、干劲、专注、集中等属性，以及状态良好、好调等Buff）
3. 比赛的每个出牌回合都会被划分到一种属性主题（Vocal/Dance/Visual）
4. 在该回合中，技能卡获得的基础得分会乘以对应的**三维加成倍率**转换为最终得分
5. **三维加成倍率**：Vocal/Dance/Visual三维越高，在对应主题回合中获得的最终得分越高
6. 三种属性的回合占比以P卡的**审查基准**高低比例为准、顺序随机，但最后三回合的属性必定以审查基准高低决定顺序
7. 比赛结束后，根据总得分决定排名

✅ 新增关键机制说明
```

### 2. `E:\偶像大师\项目进度记录\项目开发大纲.md`

#### 修正位置：第709-776行 - 技能卡平衡表
```typescript
✅ 修正后：
const CARD_BALANCE = {
  R: { 
    cost: [1, 2],
    effectPower: 'weak',
    examples: [
      '元气+10',
      '得分+5',
      '干劲+2'
    ]
  },
  SR: { 
    cost: [2, 3],
    effectPower: 'medium',
    examples: [
      '专注+4、干劲+3',
      '元气+15、得分+10',
      '状态良好+2回合'
    ]
  },
  SSR: { 
    cost: [3, 5],
    effectPower: 'strong',
    examples: [
      '消耗状态良好1回合，下一张卡效果发动2次，技能卡使用数+1（国民的偶像）',
      '专注+6、集中+3、数值上升量增加15%',
      '状态良好+3回合、好调+2回合、元气+20'
    ]
  },
  UR: { 
    cost: [4, 6],
    effectPower: 'overwhelming',
    examples: [
      '消耗5体力，好调+3回合，集中+2，将3张SSR移至牌堆顶，下回合技能卡使用数+1（天赋之才）',
      '全力值消耗3点，精力+4，状态调整至温存，技能卡使用数+1，手牌内可提升数值卡可额外触发一次（成为偶像）',
      '消耗专注3，状态绝佳+5回合，体力消耗减少+5回合，技能卡使用数+1（魅惑视线）'
    ]
  }
};

✅ 新增技能卡效果类型常量（SKILL_CARD_EFFECT_TYPES）
```

---

## 🎯 对开发的影响

### 1. **AI卡牌生成系统**

**必须严格遵守**以下规则：

```
❌ 禁止生成的效果：
- "获得 [Vocal] × 3.0 的分数"
- "Vocal+20"
- "提升Dance属性"
- 任何直接提升Vocal/Dance/Visual三维的效果

✅ 允许生成的效果：
- 元气、干劲、精力、专注、集中、活力、全力值等属性
- 状态良好、好调、状态绝佳、好印象、体力消耗减少等Buff
- 数值上升量增加X%、好印象增加为X倍等增幅效果
- 技能卡使用数+1、下一张卡效果发动2次等特殊效果
```

### 2. **培育计划关联**

AI生成技能卡时，应根据培育计划类型偏向不同效果：

| 培育计划            | 偏向效果类型 | 示例                                   |
| ------------------- | ------------ | -------------------------------------- |
| **感性（Sense）**   | 情感类效果   | 好印象、好调、活力、状态良好           |
| **理性（Logic）**   | 逻辑类效果   | 集中、专注、数值增幅（X%）             |
| **非凡（Anomaly）** | 特殊机制     | 全力值、温存、坚决、改变规则的独特效果 |

### 3. **得分计算系统**

在实现训练/比赛得分计算时，必须遵循：

```typescript
// 正确的得分计算流程
function calculateRoundScore(
  skillCard: SkillCard,
  currentAttributes: Attributes,  // 元气、干劲、专注等
  currentBuffs: Buffs,           // 状态良好、好调等
  roundType: 'Vocal' | 'Dance' | 'Visual',  // 当前回合类型
  idolStats: { vo: number, da: number, vi: number }  // 偶像三维
): number {
  // 1. 技能卡产生基础得分（受属性和Buff影响）
  let baseScore = calculateBaseScore(skillCard, currentAttributes, currentBuffs);
  
  // 2. 应用三维加成倍率
  const multiplier = getStatsMultiplier(roundType, idolStats);
  const finalScore = baseScore * multiplier;
  
  return finalScore;
}
```

### 4. **提示词系统**

在Phase 2.0（提示词加工厂）中，为AI生成技能卡的提示词必须包含：

```
你是一个技能卡设计师，为《偶像大师闪耀色彩》的P卡设计专属技能卡。

【重要规则】：
1. 技能卡**绝对不能**直接提升Vocal/Dance/Visual三维
2. 技能卡效果**只能**包括：
   - 属性操作：元气、干劲、精力、专注、集中、活力、全力值
   - Buff效果：状态良好、好调、状态绝佳、好印象、体力消耗减少等
   - 数值增幅：数值上升量增加X%、好印象增加为X倍
   - 特殊效果：技能卡使用数+1、下一张卡效果发动2次、移动卡牌等
3. Vocal/Dance/Visual三维只在比赛/训练中作为**分数乘区**，不是技能卡的直接效果

【参考示例】：
- ✅ 正确："元气+10、干劲+4、状态良好+2回合"
- ❌ 错误："Vocal+20、获得 [Dance] × 3.0 的分数"
```

---

## ✨ 修正总结

| 项目       | 修正前（错误）                 | 修正后（正确）                                       |
| ---------- | ------------------------------ | ---------------------------------------------------- |
| 技能卡效果 | 直接提升Vocal/Dance/Visual三维 | 操作元气、干劲、专注等属性，以及状态良好、好调等Buff |
| 三维作用   | 被技能卡直接提升               | 作为**分数乘区**，在对应主题回合中提供得分倍率加成   |
| 得分流程   | 技能卡直接产生最终得分         | 技能卡产生基础得分 → 应用三维加成倍率 → 最终得分     |
| 审查基准   | 未明确说明                     | 决定比赛中Vocal/Dance/Visual回合的分布比例           |
| AI生成规则 | 可能生成错误的三维提升效果     | 严格限制为属性操作、Buff效果、数值增幅、特殊效果     |

---

## 🎮 对游戏玩法的影响

### 1. **更丰富的策略深度**

- **属性管理**：需要平衡元气、干劲、专注等多种属性
- **Buff组合**：通过状态良好、好调等Buff叠加，创造强力Combo
- **资源消耗**：合理消耗体力、专注、全力值等资源以触发强力效果
- **卡牌顺序**：通过"下一张卡效果发动2次"等效果，规划出牌顺序

### 2. **培育计划差异化**

- **感性（Sense）**：擅长情感类Buff，适合长期积累优势
- **理性（Logic）**：擅长数值增幅，适合精确计算和爆发
- **非凡（Anomaly）**：擅长特殊机制，玩法最独特

### 3. **三维的重要性**

虽然技能卡不直接提升三维，但三维依然极其重要：
- **审查基准**：决定比赛中有利回合的占比
- **分数乘区**：三维越高，同样的技能卡在对应回合中得分越高
- **培育目标**：需要通过训练奖励、自由活动等途径提升三维

---

## 🎯 下一步

1. ✅ 机制说明文档已修正
2. ✅ 项目开发大纲已修正
3. ⏭️ 开始实现Phase 2.1（卡牌战斗系统UI）
4. ⏭️ 设计AI卡牌生成提示词（Phase 2.0）
5. ⏭️ 实现得分计算系统（包含三维加成倍率）

**项目状态**: 🟢 核心机制已修正，准备进入开发阶段











