# 图片压缩使用指南

## 📦 安装依赖

```bash
cd E:\偶像大师
npm install sharp
```

## 🚀 使用方法

### 方式一：直接压缩（推荐）

```bash
node compress-images.js
```

### 方式二：修改配置后压缩

打开 `compress-images.js`，修改配置：

```javascript
const CONFIG = {
  // 源目录（根据实际情况修改）
  SOURCE_DIR: 'E:\\BaiduNetdiskDownload\\闪耀色彩',
  
  // 输出目录
  OUTPUT_DIR: 'E:\\偶像大师\\闪耀色彩图片资源-压缩版',
  
  // 是否生成WebP（强烈推荐）
  GENERATE_WEBP: true,
  
  // 压缩质量（85 = 高质量 + 大幅压缩）
  QUALITY: {
    PNG: 85,
    JPEG: 85,
    WEBP: 85,
  },
};
```

## 📊 预期效果

### 压缩率统计
- **PNG**: 减少 **60-80%** 体积
- **JPG**: 减少 **30-50%** 体积
- **WebP**: 比PNG再减少 **30-50%**

### 示例（您的资源）
假设原始 **7GB** 资源：
- 压缩PNG/JPG后: **~2-3GB**
- 使用WebP: **~1-1.5GB**

---

## 🌐 jsDelivr + GitHub主分支方案

### ❓ 为什么不能用Release了？

**jsDelivr不支持GitHub Release**，只支持以下方式：

```bash
# ✅ 支持：主分支
https://cdn.jsdelivr.net/gh/用户名/仓库名@main/路径

# ✅ 支持：指定分支
https://cdn.jsdelivr.net/gh/用户名/仓库名@dev/路径

# ✅ 支持：指定tag
https://cdn.jsdelivr.net/gh/用户名/仓库名@v1.0.0/路径

# ❌ 不支持：Release下载链接
https://github.com/.../releases/download/...
```

---

## 📦 资源容量限制

### GitHub仓库限制
| 项目               | 限制                         |
| ------------------ | ---------------------------- |
| 单个仓库（软限制） | **1 GB**                     |
| 单个仓库（硬限制） | **5 GB**                     |
| 单个文件           | **100 MB** (超过需用Git LFS) |
| Git LFS免费额度    | 1 GB存储 + 1 GB/月流量       |

### jsDelivr CDN限制
| 项目           | 限制                          |
| -------------- | ----------------------------- |
| 单个文件       | **50 MB**                     |
| 推荐仓库总大小 | **< 500 MB**                  |
| 最大仓库总大小 | **无限制（但不推荐超过1GB）** |

---

## 🎯 您的资源策略（推荐）

### 当前状态
- **原始资源**: 7GB (Release中)
- **问题**: jsDelivr不支持Release

### 解决方案（分阶段）

#### 阶段一：压缩 + 主分支托管（立即可行）

```bash
# 1. 压缩图片
node compress-images.js

# 2. 压缩后大小（预估）
#    PNG/JPG: ~2-3GB
#    WebP: ~1-1.5GB

# 3. 将压缩后的资源推送到主分支
cd E:\偶像大师\闪耀色彩图片资源-压缩版
git init
git add .
git commit -m "添加压缩后的图片资源"
git push

# 4. 使用jsDelivr CDN
# constants.ts:
const CDN_BASE = 'https://cdn.jsdelivr.net/gh/2426269/shinycolors-assets@main';
```

**优势**：
- ✅ 1-1.5GB在GitHub限制内
- ✅ jsDelivr全球CDN加速
- ✅ 加载速度提升 **10-20倍**

---

#### 阶段二：分仓库（如果资源仍超限）

如果压缩后仍然超过1.5GB，可以分成多个仓库：

```bash
仓库1: shinycolors-images (图片，~800MB)
仓库2: shinycolors-audio (音频，~700MB)
```

```typescript
// constants.ts
const IMAGE_CDN = 'https://cdn.jsdelivr.net/gh/2426269/shinycolors-images@main';
const AUDIO_CDN = 'https://cdn.jsdelivr.net/gh/2426269/shinycolors-audio@main';
```

---

## 🔧 具体操作步骤

### 步骤1：安装依赖并压缩

```bash
cd E:\偶像大师
npm install sharp
node compress-images.js
```

**预计耗时**: 30-60分钟（取决于CPU性能）

### 步骤2：检查压缩结果

```bash
# 查看压缩后的总大小
cd E:\偶像大师\闪耀色彩图片资源-压缩版

# 统计文件夹大小（PowerShell）
Get-ChildItem -Recurse | Measure-Object -Property Length -Sum
```

### 步骤3：推送到GitHub主分支

```bash
cd E:\偶像大师\闪耀色彩图片资源-压缩版

# 如果是新仓库
git init
git add .
git commit -m "添加压缩后的图片资源（WebP格式）"
git branch -M main
git remote add origin https://github.com/2426269/shinycolors-assets.git

# 如果文件超过100MB，启用Git LFS
git lfs install
git lfs track "*.png"
git lfs track "*.webp"
git add .gitattributes

git push -u origin main
```

### 步骤4：修改代码使用jsDelivr

打开 `src/偶像大师闪耀色彩/constants.ts`，修改：

```typescript
// 旧代码（慢）
const RELEASE_BASE = 'https://github.com/2426269/shinycolors-assets/releases/download';

// 新代码（快）
const CDN_BASE = 'https://cdn.jsdelivr.net/gh/2426269/shinycolors-assets@main';

// 使用
export const ALBUM_COVER_BASE = `${CDN_BASE}/歌曲图片`;
export const CARD_IMAGE_BASE = `${CDN_BASE}/角色卡面`;
```

### 步骤5：验证

```bash
npm run build
# 测试加载速度
```

---

## ⚠️ 注意事项

### 1. Git LFS可能需要
如果有单个文件 > 100MB：

```bash
git lfs install
git lfs track "*.png"
git lfs track "*.mp3"
git add .gitattributes
```

### 2. 推送时间可能很长
推送1-2GB数据到GitHub可能需要 **30-60分钟**，请耐心等待。

### 3. jsDelivr缓存更新
jsDelivr有12小时缓存，如果更新了文件：

```bash
# 使用特定commit强制刷新
https://cdn.jsdelivr.net/gh/2426269/shinycolors-assets@commit哈希/路径
```

---

## 🎉 预期性能提升

### 当前（GitHub Release）
- 单张图片加载: **3-10秒**
- 总加载时间: **慢且不稳定**

### 优化后（jsDelivr + 压缩）
- 单张图片加载: **200-500ms**
- 总加载时间: **快且稳定**
- **整体提速: 10-20倍** 🚀

---

## ❓ 常见问题

**Q: 压缩会损失画质吗？**  
A: 质量85的压缩，肉眼几乎无法分辨差异。

**Q: 如果资源超过1GB怎么办？**  
A: 分成多个仓库，或使用WebP格式（能再减少30-50%）。

**Q: jsDelivr稳定吗？**  
A: 非常稳定，全球200+节点，大量项目在用（如Bootstrap、jQuery等）。

**Q: 需要删除Release吗？**  
A: 可以保留作为备份，但代码改用jsDelivr。



