# å¶åƒå¤§å¸ˆé—ªè€€è‰²å½© - æŠ½å¡ç³»ç»Ÿå¼€å‘æ–¹æ¡ˆ

> é¡¹ç›®å¯åŠ¨æ—¥æœŸ: 2025å¹´10æœˆ28æ—¥  
> å¼€å‘æ¨¡å¼: å‰ç«¯ä¼˜å…ˆï¼Œæ•°æ®åè¡¥  
> é¡¹ç›®æ€§è´¨: åŒäººéç›ˆåˆ©

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### æ ¸å¿ƒç›®æ ‡
æ„å»ºä¸€ä¸ªè½»é‡åŒ–çš„æŠ½å¡ç³»ç»Ÿï¼Œæ”¯æŒå•æŠ½/åè¿ã€ä¿åº•æœºåˆ¶ã€AIæŠ€èƒ½ç”Ÿæˆï¼Œå¹¶ä¸ç°æœ‰éŸ³ä¹ç³»ç»Ÿæ— ç¼é›†æˆã€‚

### è®¾è®¡ç†å¿µ
- **è½»é‡åŒ–**: åªå­˜å‚¨å¿…è¦æ•°æ®ï¼ŒåŠ¨æ€æ„å»ºæ˜¾ç¤ºå†…å®¹
- **æ¨¡å—åŒ–**: ç‹¬ç«‹æ¨¡å—ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **å¯æ‰©å±•**: ä¾¿äºåç»­æ·»åŠ é™å®šå¡æ± ã€æ´»åŠ¨å¡æ± 
- **AIé›†æˆ**: ä½¿ç”¨SillyTavernçš„APIç”Ÿæˆç‹¬ç‰¹æŠ€èƒ½

---

## ğŸ¯ å¼€å‘é˜¶æ®µåˆ’åˆ†

### Phase 1: å‰ç«¯ç•Œé¢ä¸æ ¸å¿ƒé€»è¾‘ (Week 1-2)
**ç›®æ ‡**: æ­å»ºå®Œæ•´çš„æŠ½å¡ç³»ç»Ÿæ¡†æ¶ï¼Œä½¿ç”¨å ä½æ•°æ®æµ‹è¯•

### Phase 2: æ•°æ®æ”¶é›†ä¸æ•´ç† (Week 3)
**ç›®æ ‡**: æ”¶é›†è§’è‰²å¡å’Œæ”¯æ´å¡æ•°æ®ï¼Œæ›¿æ¢å ä½æ•°æ®

### Phase 3: AIæŠ€èƒ½ç”Ÿæˆä¸ä¼˜åŒ– (Week 4)
**ç›®æ ‡**: å®ç°AIæŠ€èƒ½ç”Ÿæˆï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

### Phase 4: æµ‹è¯•ä¸å‘å¸ƒ (Week 5)
**ç›®æ ‡**: å®Œæ•´æµ‹è¯•ï¼Œä¿®å¤bugï¼Œç¼–å†™æ–‡æ¡£

---

## ğŸ“… Phase 1: å‰ç«¯ç•Œé¢ä¸æ ¸å¿ƒé€»è¾‘ (ä¼˜å…ˆå¼€å‘)

### 1.1 é¡¹ç›®ç»“æ„æ­å»º

**æ—¶é—´**: Day 1

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/gacha/` ç›®å½•
- [ ] åˆ›å»ºåŸºç¡€æ–‡ä»¶ç»“æ„
- [ ] é…ç½®æ„å»ºç³»ç»Ÿ

**æ–‡ä»¶ç»“æ„**:
```
src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/gacha/
â”œâ”€â”€ index.ts                    # å…¥å£æ–‡ä»¶
â”œâ”€â”€ app.vue                     # ä¸»ç•Œé¢
â”œâ”€â”€ index.scss                  # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ types.ts                    # ç±»å‹å®šä¹‰
â”œâ”€â”€ constants.ts                # å¸¸é‡é…ç½®
â”œâ”€â”€ probability.ts              # æ¦‚ç‡è®¡ç®—
â”œâ”€â”€ gacha-core.ts              # æŠ½å¡æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ card-utils.ts              # å¡ç‰‡å·¥å…·å‡½æ•°
â”œâ”€â”€ skill-generator.ts         # AIæŠ€èƒ½ç”Ÿæˆ
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ characters.ts          # è§’è‰²åŸºç¡€æ•°æ®ï¼ˆå ä½ï¼‰
â”‚   â”œâ”€â”€ card-themes.ts         # å¡ç‰‡ä¸»é¢˜åç§°ï¼ˆå ä½ï¼‰
â”‚   â”œâ”€â”€ support-cards.ts       # æ”¯æ´å¡æ•°æ®ï¼ˆå ä½ï¼‰
â”‚   â””â”€â”€ gacha-pools.ts         # å¡æ± é…ç½®
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ResourceBar.vue        # èµ„æºæ ï¼ˆç¾½çŸ³/æ˜Ÿå°˜ï¼‰
â”‚   â”œâ”€â”€ PoolSelector.vue       # å¡æ± é€‰æ‹©å™¨
â”‚   â”œâ”€â”€ PoolDetail.vue         # å¡æ± è¯¦æƒ…
â”‚   â”œâ”€â”€ GachaButton.vue        # æŠ½å¡æŒ‰é’®
â”‚   â”œâ”€â”€ ResultDisplay.vue      # ç»“æœå±•ç¤º
â”‚   â”œâ”€â”€ CardItem.vue           # å•å¼ å¡ç‰‡å±•ç¤º
â”‚   â””â”€â”€ SkillGenerator.vue     # æŠ€èƒ½ç”Ÿæˆå™¨
â””â”€â”€ utils/
    â”œâ”€â”€ storage.ts             # æ•°æ®æŒä¹…åŒ–
    â””â”€â”€ animation.ts           # åŠ¨ç”»å·¥å…·
```

---

### 1.2 ç±»å‹å®šä¹‰ä¸å¸¸é‡

**æ—¶é—´**: Day 1

**æ–‡ä»¶**: `types.ts`
```typescript
// ç¨€æœ‰åº¦ç±»å‹
export type Rarity = 'R' | 'SR' | 'SSR' | 'UR';

// è§’è‰²åŸºç¡€ä¿¡æ¯
export interface Character {
  name: string;        // æ«»æœ¨çœŸä¹ƒ
  en: string;          // Sakuragi.Mano
  unit: string;        // Illumination STARS
}

// æŠ½å¡ç»“æœ
export interface GachaResult {
  characterEn: string;
  characterName: string;
  rarity: Rarity;
  cardNumber: number;
  fullCardName: string;
  imageUrl: string;
  isNew: boolean;
  stardust?: number;
}

// ç”¨æˆ·æ•°æ®
export interface GachaUserData {
  gems: number;
  stardust: number;
  level: number;
  exp: number;
  ownedCards: {
    [cardId: string]: {
      fullName: string;
      obtainedAt: string;
      hasSkill: boolean;
    }
  };
  pity: {
    totalPulls: number;
    ssrPity: number;
    urPity: number;
  };
  history: GachaRecord[];
}

// ç‹¬ç‰¹æŠ€èƒ½
export interface UniqueSkill {
  cardId: string;
  name: string;
  type: 'Vo' | 'Da' | 'Vi' | 'Mental' | 'Support';
  description: string;
  effect: {
    target: string;
    value: string;
    duration: string;
  };
  supportCardImage: string;
  generatedAt: string;
}

// å¡æ± é…ç½®
export interface GachaPool {
  id: string;
  name: string;
  type: 'å¸¸é©»' | 'é™å®š';
  description: string;
  startDate?: string;
  endDate?: string;
  thumbnail: string;
}
```

**æ–‡ä»¶**: `constants.ts`
```typescript
// GitHub Release è·¯å¾„
export const CARD_IMAGE_BASE = 'https://github.com/2426269/shinycolors-assets/releases/download/idol-cards';
export const SUPPORT_IMAGE_BASE = 'https://github.com/2426269/shinycolors-assets/releases/download/support-cards';

// åŸºç¡€æ¦‚ç‡
export const BASE_RATES = {
  UR: 0.0050,
  SSR: 0.0500,
  SR: 0.1600,
  R: 0.7850,
} as const;

// ä¿åº•é…ç½®
export const PITY_CONFIG = {
  SSR_PITY: 90,
  UR_PITY: 200,
  TEN_PULL_SR: true,
} as const;

// æŠ½å¡ä»·æ ¼
export const GACHA_COST = {
  SINGLE: 300,
  TEN: 3000,
} as const;

// æ˜Ÿå°˜è½¬æ¢
export const STARDUST_CONVERSION = {
  R: 10,
  SR: 50,
  SSR: 300,
  UR: 1500,
} as const;

// åˆå§‹èµ„æº
export const INITIAL_RESOURCES = {
  gems: 3000,
  stardust: 0,
  level: 1,
  exp: 0,
} as const;
```

---

### 1.3 å ä½æ•°æ®å‡†å¤‡

**æ—¶é—´**: Day 2

**ç›®çš„**: åˆ›å»ºæœ€å°æµ‹è¯•æ•°æ®é›†ï¼ŒéªŒè¯ç³»ç»ŸåŠŸèƒ½

**æ–‡ä»¶**: `data/characters.ts`
```typescript
/**
 * è§’è‰²åŸºç¡€æ•°æ®ï¼ˆå ä½ç‰ˆï¼‰
 * ä»…åŒ…å«5ä¸ªæµ‹è¯•è§’è‰²ï¼Œç”¨äºéªŒè¯ç³»ç»ŸåŠŸèƒ½
 */
export const CHARACTERS: Character[] = [
  { name: 'æ«»æœ¨çœŸä¹ƒ', en: 'Sakuragi.Mano', unit: 'Illumination STARS' },
  { name: 'èŠ¹æ²¢ã‚ã•ã²', en: 'Serizawa.Asahi', unit: 'Straylight' },
  { name: 'æœˆå²¡æ‹é˜', en: 'Tsukioka.Kogane', unit: 'Illumination STARS' },
  { name: 'é¢¨é‡ç¯ç¹”', en: 'Kuno.Hiori', unit: "L'Antica" },
  { name: 'é»›å†¬å„ªå­', en: 'Mayuzumi.Fuyuko', unit: 'Straylight' },
];

// ç¨€æœ‰åº¦æ± ï¼ˆå ä½ï¼‰
export const RARITY_POOLS = {
  UR: [0, 1],           // åªæœ‰2ä¸ªè§’è‰²æœ‰UR
  SSR: [0, 1, 2, 3, 4], // å…¨éƒ¨è§’è‰²æœ‰SSR
  SR: [0, 1, 2, 3, 4],
  R: [0, 1, 2, 3, 4],
} as const;

// å¡ç‰‡æ•°é‡ï¼ˆå ä½ï¼‰
export const CARD_COUNTS: Record<string, Partial<Record<Rarity, number>>> = {
  'Sakuragi.Mano': { R: 2, SR: 3, SSR: 5, UR: 2 },
  'Serizawa.Asahi': { R: 2, SR: 3, SSR: 4, UR: 1 },
  // å…¶ä»–è§’è‰²é»˜è®¤æ¯ä¸ªç¨€æœ‰åº¦1å¼ 
};
```

**æ–‡ä»¶**: `data/card-themes.ts`
```typescript
/**
 * å¡ç‰‡ä¸»é¢˜åç§°ï¼ˆå ä½ç‰ˆï¼‰
 */
export const CARD_THEMES: Record<string, Partial<Record<Rarity, string[]>>> = {
  'Sakuragi.Mano': {
    UR: ['é§…ç·šä¸Šã®æ—¥å¸¸', 'è¼ãã®èˆå°'],
    SSR: ['æ”¾èª²å¾Œã®ãƒ¡ãƒ¢ãƒªãƒ¼', 'æ˜Ÿç©ºã®ä¸‹ã§', 'å¤¢ã¸ã®ä¸€æ­©', 'ç¬‘é¡”ã®ç´„æŸ', 'ç…Œã‚ãæœªæ¥'],
    SR: ['æœã®æŒ¨æ‹¶', 'å…ƒæ°—ã„ã£ã±ã„', 'å‹é”ã¨ä¸€ç·’ã«'],
    R: ['ã‚¢ã‚¤ãƒ‰ãƒ«ã®åµ', 'åˆã‚ã¦ã®ãƒ¬ãƒƒã‚¹ãƒ³'],
  },
  'Kuno.Hiori': {
    SSR: ['é»’ç™¾åˆå‰ã§å¾…ã¡åˆã‚ã›', 'ã‚¯ãƒ¼ãƒ«ãªå¾®ç¬‘ã¿'],
  },
  // å…¶ä»–è§’è‰²ä½¿ç”¨é»˜è®¤ä¸»é¢˜
};

// é»˜è®¤ä¸»é¢˜
export const DEFAULT_THEMES: Record<Rarity, string[]> = {
  UR: ['å¤¢ã®èˆå°', 'è¼ãã®åˆ»', 'ç‰¹åˆ¥ãªæ—¥'],
  SSR: ['ã‚¢ã‚¤ãƒ‰ãƒ«ã®æ—¥ã€…', 'ç‰¹è¨“ã®æˆæœ', 'ç´ æ•µãªæ€ã„å‡º', 'å¤§åˆ‡ãªä»²é–“'],
  SR: ['ãƒ¬ãƒƒã‚¹ãƒ³ä¸­', 'ä¼‘æ†©æ™‚é–“', 'ä»²é–“ã¨å…±ã«'],
  R: ['ãƒ‡ãƒ“ãƒ¥ãƒ¼', 'åˆèˆå°', 'ç·´ç¿’é¢¨æ™¯'],
};
```

**æ–‡ä»¶**: `data/support-cards.ts`
```typescript
/**
 * æ”¯æ´å¡æ•°æ®ï¼ˆå ä½ç‰ˆï¼‰
 * ä½¿ç”¨å ä½å›¾ç‰‡URL
 */
export const SUPPORT_CARDS: Record<Rarity, Record<string, string[]>> = {
  UR: {
    'Sakuragi.Mano': ['placeholder-ur-01.jpg'],
    'Serizawa.Asahi': ['placeholder-ur-02.jpg'],
  },
  SSR: {
    'Sakuragi.Mano': ['placeholder-ssr-01.jpg', 'placeholder-ssr-02.jpg'],
    'Kuno.Hiori': ['placeholder-ssr-03.jpg'],
  },
  SR: {},
  R: {},
};
```

**å ä½å›¾ç‰‡**:
- åœ¨ GitHub Release ä¸Šä¼ 5å¼ æµ‹è¯•å›¾ç‰‡ï¼ˆå¯ä»¥æ˜¯çº¯è‰²+æ–‡å­—çš„å ä½å›¾ï¼‰
- å‘½å: `Sakuragi.Mano.SSR.01.jpg` (å†…å®¹: ç²‰è‰²èƒŒæ™¯ + "SSR æ¨±æœ¨çœŸä¹ƒ" æ–‡å­—)

---

### 1.4 æ ¸å¿ƒé€»è¾‘å®ç°

**æ—¶é—´**: Day 2-3

**æ–‡ä»¶**: `card-utils.ts`
```typescript
import { CARD_THEMES, DEFAULT_THEMES } from './data/card-themes';
import { CARD_IMAGE_BASE } from './constants';

/**
 * è·å–å®Œæ•´å¡ç‰‡åç§°
 */
export function getFullCardName(
  characterName: string,
  characterEn: string,
  rarity: Rarity,
  cardNumber: number
): string {
  const themes = CARD_THEMES[characterEn]?.[rarity];
  
  let theme: string;
  if (themes && themes[cardNumber - 1]) {
    theme = themes[cardNumber - 1];
  } else {
    const defaultThemes = DEFAULT_THEMES[rarity];
    theme = defaultThemes[(cardNumber - 1) % defaultThemes.length];
  }
  
  return `ã€${theme}ã€‘${characterName}`;
}

/**
 * æ„å»ºå¡ç‰‡å›¾ç‰‡URL
 */
export function buildCardImageUrl(
  characterEn: string,
  rarity: Rarity,
  cardNumber: number
): string {
  const paddedNumber = String(cardNumber).padStart(2, '0');
  return `${CARD_IMAGE_BASE}/${rarity}/${characterEn}.${rarity}.${paddedNumber}.jpg`;
}

/**
 * æ„å»ºå¡ç‰‡IDï¼ˆç”¨äºå»é‡ï¼‰
 */
export function buildCardId(
  characterEn: string,
  rarity: Rarity,
  cardNumber: number
): string {
  return `${characterEn}_${rarity}_${cardNumber}`;
}
```

**æ–‡ä»¶**: `probability.ts`
```typescript
import { BASE_RATES, PITY_CONFIG } from './constants';

/**
 * éšæœºç¨€æœ‰åº¦ï¼ˆè€ƒè™‘ä¿åº•ï¼‰
 */
export function rollRarity(
  ssrPity: number,
  urPity: number,
  forcePity?: Rarity
): Rarity {
  // å¼ºåˆ¶ä¿åº•
  if (forcePity) return forcePity;
  
  // URä¿åº•æ£€æŸ¥
  if (urPity >= PITY_CONFIG.UR_PITY) {
    return 'UR';
  }
  
  // SSRä¿åº•æ£€æŸ¥
  if (ssrPity >= PITY_CONFIG.SSR_PITY) {
    return 'SSR';
  }
  
  // æ­£å¸¸éšæœº
  const random = Math.random();
  let cumulative = 0;
  
  for (const [rarity, rate] of Object.entries(BASE_RATES)) {
    cumulative += rate;
    if (random < cumulative) {
      return rarity as Rarity;
    }
  }
  
  return 'R';
}

/**
 * æ›´æ–°ä¿åº•è®¡æ•°
 */
export function updatePityCount(
  userData: GachaUserData,
  rarity: Rarity
): void {
  userData.pity.totalPulls++;
  
  if (rarity === 'UR') {
    userData.pity.urPity = 0;
    userData.pity.ssrPity = 0;
  } else if (rarity === 'SSR') {
    userData.pity.ssrPity = 0;
    userData.pity.urPity++;
  } else {
    userData.pity.ssrPity++;
    userData.pity.urPity++;
  }
}
```

**æ–‡ä»¶**: `gacha-core.ts`
```typescript
import { CHARACTERS, RARITY_POOLS, CARD_COUNTS } from './data/characters';
import { rollRarity, updatePityCount } from './probability';
import { getFullCardName, buildCardImageUrl, buildCardId } from './card-utils';
import { STARDUST_CONVERSION } from './constants';

/**
 * æ‰§è¡Œå•æ¬¡æŠ½å¡
 */
export function performSinglePull(
  userData: GachaUserData,
  forcePity?: Rarity
): GachaResult {
  // 1. éšæœºç¨€æœ‰åº¦
  const rarity = rollRarity(
    userData.pity.ssrPity,
    userData.pity.urPity,
    forcePity
  );
  
  // 2. ä»è¯¥ç¨€æœ‰åº¦æ± ä¸­éšæœºè§’è‰²
  const pool = RARITY_POOLS[rarity];
  const characterIndex = pool[Math.floor(Math.random() * pool.length)];
  const character = CHARACTERS[characterIndex];
  
  // 3. éšæœºå¡ç‰‡ç¼–å·
  const cardCount = CARD_COUNTS[character.en]?.[rarity] || 1;
  const cardNumber = Math.floor(Math.random() * cardCount) + 1;
  
  // 4. æ„å»ºå®Œæ•´ä¿¡æ¯
  const cardId = buildCardId(character.en, rarity, cardNumber);
  const fullCardName = getFullCardName(
    character.name,
    character.en,
    rarity,
    cardNumber
  );
  const imageUrl = buildCardImageUrl(character.en, rarity, cardNumber);
  
  // 5. æ£€æŸ¥æ˜¯å¦å·²æ‹¥æœ‰
  const isNew = !userData.ownedCards[cardId];
  
  // 6. æ›´æ–°æ‹¥æœ‰è®°å½•
  if (isNew) {
    userData.ownedCards[cardId] = {
      fullName: fullCardName,
      obtainedAt: new Date().toISOString(),
      hasSkill: false,
    };
  } else {
    // é‡å¤å¡è½¬æ˜Ÿå°˜
    userData.stardust += STARDUST_CONVERSION[rarity];
  }
  
  // 7. æ›´æ–°ä¿åº•è®¡æ•°
  updatePityCount(userData, rarity);
  
  return {
    characterEn: character.en,
    characterName: character.name,
    rarity,
    cardNumber,
    fullCardName,
    imageUrl,
    isNew,
    stardust: isNew ? 0 : STARDUST_CONVERSION[rarity],
  };
}

/**
 * æ‰§è¡Œåè¿æŠ½å¡
 */
export function performTenPull(userData: GachaUserData): GachaResult[] {
  const results: GachaResult[] = [];
  
  // å‰9æŠ½
  for (let i = 0; i < 9; i++) {
    results.push(performSinglePull(userData));
  }
  
  // ç¬¬10æŠ½ï¼šä¿è¯è‡³å°‘1ä¸ªSR
  const hasSROrAbove = results.some(r => r.rarity !== 'R');
  const lastPull = performSinglePull(
    userData,
    hasSROrAbove ? undefined : 'SR'
  );
  results.push(lastPull);
  
  return results;
}
```

---

### 1.5 æ•°æ®æŒä¹…åŒ–

**æ—¶é—´**: Day 3

**æ–‡ä»¶**: `utils/storage.ts`
```typescript
const STORAGE_KEY = 'shinycolors_gacha_data';

/**
 * åŠ è½½ç”¨æˆ·æ•°æ®
 */
export function loadUserData(): GachaUserData {
  const saved = getVariables({ type: 'global' });
  
  if (saved && saved[STORAGE_KEY]) {
    return JSON.parse(saved[STORAGE_KEY]);
  }
  
  // è¿”å›åˆå§‹æ•°æ®
  return {
    gems: INITIAL_RESOURCES.gems,
    stardust: INITIAL_RESOURCES.stardust,
    level: INITIAL_RESOURCES.level,
    exp: INITIAL_RESOURCES.exp,
    ownedCards: {},
    pity: {
      totalPulls: 0,
      ssrPity: 0,
      urPity: 0,
    },
    history: [],
  };
}

/**
 * ä¿å­˜ç”¨æˆ·æ•°æ®
 */
export function saveUserData(userData: GachaUserData): void {
  const toSave = {
    [STORAGE_KEY]: JSON.stringify(userData),
  };
  replaceVariables(toSave, { type: 'global' });
}

/**
 * é‡ç½®ç”¨æˆ·æ•°æ®ï¼ˆå¼€å‘æµ‹è¯•ç”¨ï¼‰
 */
export function resetUserData(): void {
  const initial = {
    [STORAGE_KEY]: JSON.stringify({
      ...INITIAL_RESOURCES,
      ownedCards: {},
      pity: { totalPulls: 0, ssrPity: 0, urPity: 0 },
      history: [],
    }),
  };
  replaceVariables(initial, { type: 'global' });
  toastr.success('æ•°æ®å·²é‡ç½®');
}
```

---

### 1.6 Vueç»„ä»¶å¼€å‘

**æ—¶é—´**: Day 4-6

#### 1.6.1 èµ„æºæ ç»„ä»¶

**æ–‡ä»¶**: `components/ResourceBar.vue`
```vue
<template>
  <div class="resource-bar">
    <div class="resource-item gems">
      <i class="icon-gem"></i>
      <span class="label">ç¾½çŸ³</span>
      <span class="value">{{ gems.toLocaleString() }}</span>
    </div>
    
    <div class="resource-item stardust">
      <i class="icon-star"></i>
      <span class="label">æ˜Ÿå°˜</span>
      <span class="value">{{ stardust.toLocaleString() }}</span>
    </div>
    
    <div class="resource-item level">
      <span class="label">Lv.</span>
      <span class="value">{{ level }}</span>
    </div>
  </div>
</template>

<script setup lang="ts">
defineProps<{
  gems: number;
  stardust: number;
  level: number;
}>();
</script>

<style scoped lang="scss">
.resource-bar {
  display: flex;
  gap: 20px;
  padding: 15px 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.resource-item {
  display: flex;
  align-items: center;
  gap: 8px;
  color: white;
  font-weight: bold;
  
  .label {
    font-size: 14px;
    opacity: 0.9;
  }
  
  .value {
    font-size: 18px;
  }
}
</style>
```

#### 1.6.2 æŠ½å¡æŒ‰é’®ç»„ä»¶

**æ–‡ä»¶**: `components/GachaButton.vue`
```vue
<template>
  <button 
    class="gacha-button"
    :class="[type, { disabled: !canAfford }]"
    :disabled="!canAfford"
    @click="handleClick"
  >
    <div class="button-content">
      <span class="type-label">{{ label }}</span>
      <span class="cost">
        <i class="icon-gem"></i>
        {{ cost }}
      </span>
    </div>
  </button>
</template>

<script setup lang="ts">
import { computed } from 'vue';

const props = defineProps<{
  type: 'single' | 'ten';
  cost: number;
  gems: number;
}>();

const emit = defineEmits<{
  (e: 'click'): void;
}>();

const label = computed(() => props.type === 'single' ? 'å˜ç™º' : '10é€£');
const canAfford = computed(() => props.gems >= props.cost);

function handleClick() {
  if (canAfford.value) {
    emit('click');
  }
}
</script>

<style scoped lang="scss">
.gacha-button {
  padding: 20px 40px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s;
  
  &.single {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
  
  &.ten {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  }
  
  &:hover:not(.disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  }
  
  &.disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
}

.button-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  color: white;
  
  .type-label {
    font-size: 20px;
    font-weight: bold;
  }
  
  .cost {
    font-size: 16px;
  }
}
</style>
```

#### 1.6.3 ç»“æœå±•ç¤ºç»„ä»¶

**æ–‡ä»¶**: `components/ResultDisplay.vue`
```vue
<template>
  <div class="result-overlay" @click.self="$emit('close')">
    <div class="result-container">
      <h2 class="result-title">æŠ½å¡ç»“æœ</h2>
      
      <div class="result-grid" :class="{ 'ten-pull': results.length === 10 }">
        <CardItem
          v-for="(result, index) in results"
          :key="index"
          :result="result"
        />
      </div>
      
      <div class="result-actions">
        <button class="btn-again" @click="$emit('again')">
          ã‚‚ã†ä¸€åº¦å¼•ã
        </button>
        <button class="btn-ok" @click="$emit('close')">
          OK
        </button>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import CardItem from './CardItem.vue';

defineProps<{
  results: GachaResult[];
}>();

defineEmits<{
  (e: 'close'): void;
  (e: 'again'): void;
}>();
</script>

<style scoped lang="scss">
.result-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.result-container {
  background: white;
  border-radius: 20px;
  padding: 30px;
  max-width: 90vw;
  max-height: 90vh;
  overflow-y: auto;
}

.result-grid {
  display: grid;
  gap: 15px;
  margin: 20px 0;
  
  // å•æŠ½ï¼š1åˆ—
  grid-template-columns: 1fr;
  
  // åè¿ï¼š5åˆ—
  &.ten-pull {
    grid-template-columns: repeat(5, 1fr);
  }
}

.result-actions {
  display: flex;
  gap: 15px;
  justify-content: center;
  margin-top: 20px;
  
  button {
    padding: 12px 30px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s;
    
    &:hover {
      transform: translateY(-2px);
    }
  }
  
  .btn-again {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
  }
  
  .btn-ok {
    background: #e0e0e0;
    color: #333;
  }
}
</style>
```

#### 1.6.4 å•å¡å±•ç¤ºç»„ä»¶

**æ–‡ä»¶**: `components/CardItem.vue`
```vue
<template>
  <div class="card-item" :class="`rarity-${result.rarity}`">
    <div class="rarity-badge">{{ result.rarity }}</div>
    
    <div class="card-image-wrapper">
      <img 
        :src="result.imageUrl" 
        :alt="result.fullCardName"
        class="card-image"
        @error="handleImageError"
      />
    </div>
    
    <div class="card-name">{{ result.fullCardName }}</div>
    
    <div v-if="result.isNew" class="new-badge">NEW!</div>
    <div v-else class="stardust-badge">+{{ result.stardust }} æ˜Ÿå°˜</div>
  </div>
</template>

<script setup lang="ts">
const props = defineProps<{
  result: GachaResult;
}>();

function handleImageError(e: Event) {
  const img = e.target as HTMLImageElement;
  // å ä½å›¾
  img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg==';
}
</script>

<style scoped lang="scss">
.card-item {
  position: relative;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  transition: transform 0.3s;
  
  &:hover {
    transform: scale(1.05);
  }
  
  // ç¨€æœ‰åº¦è¾¹æ¡†
  &.rarity-UR {
    border: 3px solid gold;
  }
  &.rarity-SSR {
    border: 3px solid #ff69b4;
  }
  &.rarity-SR {
    border: 3px solid #9d5cff;
  }
  &.rarity-R {
    border: 2px solid #ccc;
  }
}

.rarity-badge {
  position: absolute;
  top: 10px;
  left: 10px;
  padding: 4px 12px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 14px;
  z-index: 10;
  
  .rarity-UR & {
    background: gold;
    color: #333;
  }
  .rarity-SSR & {
    background: #ff69b4;
    color: white;
  }
  .rarity-SR & {
    background: #9d5cff;
    color: white;
  }
  .rarity-R & {
    background: #999;
    color: white;
  }
}

.card-image-wrapper {
  aspect-ratio: 2 / 3;
  overflow: hidden;
  
  .card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
}

.card-name {
  padding: 10px;
  text-align: center;
  font-weight: bold;
  font-size: 14px;
  background: rgba(255, 255, 255, 0.95);
}

.new-badge {
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 4px 12px;
  background: #ff4444;
  color: white;
  border-radius: 20px;
  font-weight: bold;
  animation: pulse 1s infinite;
}

.stardust-badge {
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 4px 12px;
  background: rgba(255, 215, 0, 0.9);
  color: #333;
  border-radius: 20px;
  font-weight: bold;
  font-size: 12px;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}
</style>
```

---

### 1.7 ä¸»ç•Œé¢ç»„è£…

**æ—¶é—´**: Day 7

**æ–‡ä»¶**: `app.vue`
```vue
<template>
  <div class="gacha-system">
    <ResourceBar
      :gems="userData.gems"
      :stardust="userData.stardust"
      :level="userData.level"
    />
    
    <div class="gacha-main">
      <!-- å·¦ä¾§ï¼šå¡æ± é€‰æ‹©ï¼ˆæš‚æ—¶ç®€åŒ–ï¼‰ -->
      <div class="pool-selector">
        <div class="pool-item active">
          <div class="pool-name">å¸¸é§ã‚¬ã‚·ãƒ£</div>
        </div>
      </div>
      
      <!-- å³ä¾§ï¼šæŠ½å¡åŒºåŸŸ -->
      <div class="gacha-area">
        <div class="pool-info">
          <h2>å¸¸é§ã‚¬ã‚·ãƒ£</h2>
          <p>ã™ã¹ã¦ã®ã‚¢ã‚¤ãƒ‰ãƒ«ã‚«ãƒ¼ãƒ‰ãŒå‡ºç¾ã—ã¾ã™</p>
        </div>
        
        <div class="gacha-buttons">
          <GachaButton
            type="single"
            :cost="GACHA_COST.SINGLE"
            :gems="userData.gems"
            @click="handleSinglePull"
          />
          <GachaButton
            type="ten"
            :cost="GACHA_COST.TEN"
            :gems="userData.gems"
            @click="handleTenPull"
          />
        </div>
        
        <div class="pity-info">
          <div class="pity-item">
            SSRä¿åº•ã¾ã§: <strong>{{ 90 - userData.pity.ssrPity }}</strong> å›
          </div>
          <div class="pity-item">
            URä¿åº•ã¾ã§: <strong>{{ 200 - userData.pity.urPity }}</strong> å›
          </div>
        </div>
      </div>
    </div>
    
    <!-- ç»“æœå¼¹çª— -->
    <ResultDisplay
      v-if="showResult"
      :results="currentResults"
      @close="showResult = false"
      @again="handlePullAgain"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { loadUserData, saveUserData } from './utils/storage';
import { performSinglePull, performTenPull } from './gacha-core';
import { GACHA_COST } from './constants';
import ResourceBar from './components/ResourceBar.vue';
import GachaButton from './components/GachaButton.vue';
import ResultDisplay from './components/ResultDisplay.vue';

// ç”¨æˆ·æ•°æ®
const userData = ref(loadUserData());

// UIçŠ¶æ€
const showResult = ref(false);
const currentResults = ref<GachaResult[]>([]);
const lastPullType = ref<'single' | 'ten'>('single');

// å•æŠ½
function handleSinglePull() {
  if (userData.value.gems < GACHA_COST.SINGLE) {
    toastr.error('ç¾½çŸ³ä¸è¶³ï¼');
    return;
  }
  
  userData.value.gems -= GACHA_COST.SINGLE;
  const result = performSinglePull(userData.value);
  
  currentResults.value = [result];
  lastPullType.value = 'single';
  showResult.value = true;
  
  saveUserData(userData.value);
}

// åè¿
function handleTenPull() {
  if (userData.value.gems < GACHA_COST.TEN) {
    toastr.error('ç¾½çŸ³ä¸è¶³ï¼');
    return;
  }
  
  userData.value.gems -= GACHA_COST.TEN;
  const results = performTenPull(userData.value);
  
  currentResults.value = results;
  lastPullType.value = 'ten';
  showResult.value = true;
  
  saveUserData(userData.value);
}

// å†æŠ½ä¸€æ¬¡
function handlePullAgain() {
  showResult.value = false;
  if (lastPullType.value === 'single') {
    handleSinglePull();
  } else {
    handleTenPull();
  }
}

onMounted(() => {
  toastr.success('æŠ½å¡ç³»ç»ŸåŠ è½½æˆåŠŸï¼');
});
</script>

<style scoped lang="scss">
.gacha-system {
  padding: 20px;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.gacha-main {
  display: grid;
  grid-template-columns: 250px 1fr;
  gap: 20px;
  margin-top: 20px;
}

.pool-selector {
  background: white;
  border-radius: 10px;
  padding: 15px;
}

.gacha-area {
  background: white;
  border-radius: 10px;
  padding: 30px;
}

.pool-info {
  text-align: center;
  margin-bottom: 30px;
  
  h2 {
    font-size: 24px;
    margin-bottom: 10px;
  }
}

.gacha-buttons {
  display: flex;
  gap: 20px;
  justify-content: center;
  margin-bottom: 30px;
}

.pity-info {
  display: flex;
  gap: 30px;
  justify-content: center;
  padding: 15px;
  background: #f5f5f5;
  border-radius: 8px;
  
  .pity-item {
    font-size: 16px;
    
    strong {
      color: #ff4444;
      font-size: 20px;
    }
  }
}
</style>
```

---

### 1.8 æµ‹è¯•ä¸è°ƒè¯•

**æ—¶é—´**: Day 8

**æµ‹è¯•æ¸…å•**:
- [ ] å•æŠ½åŠŸèƒ½æ­£å¸¸
- [ ] åè¿åŠŸèƒ½æ­£å¸¸
- [ ] åè¿è‡³å°‘1ä¸ªSR
- [ ] ä¿åº•æœºåˆ¶è§¦å‘
- [ ] é‡å¤å¡è½¬æ˜Ÿå°˜
- [ ] æ•°æ®æŒä¹…åŒ–æ­£å¸¸
- [ ] å ä½å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºé»˜è®¤å›¾
- [ ] ç¾½çŸ³ä¸è¶³æ—¶æç¤º
- [ ] ç•Œé¢å“åº”å¼æ­£å¸¸

**è°ƒè¯•å·¥å…·**:
```typescript
// æ·»åŠ åˆ° app.vue
function devAddGems() {
  userData.value.gems += 10000;
  saveUserData(userData.value);
  toastr.success('å·²æ·»åŠ 10000ç¾½çŸ³ï¼ˆå¼€å‘æ¨¡å¼ï¼‰');
}

function devResetPity() {
  userData.value.pity.ssrPity = 89;  // ä¸‹ä¸€æŠ½å¿…å‡ºSSR
  saveUserData(userData.value);
  toastr.success('ä¿åº•å·²è®¾ç½®ä¸º89ï¼ˆå¼€å‘æ¨¡å¼ï¼‰');
}
```

---

## ğŸ“… Phase 2: æ•°æ®æ”¶é›†ä¸æ•´ç†

**æ—¶é—´**: Week 3

### 2.1 è§’è‰²æ•°æ®æ”¶é›†

**ä»»åŠ¡**: ä»é—ªè€€è‰²å½©wikiæ”¶é›†è§’è‰²åŸºç¡€ä¿¡æ¯

**ç›®æ ‡**: 30ä¸ªè§’è‰²çš„å®Œæ•´åˆ—è¡¨

**æ”¶é›†å†…å®¹**:
```csv
è§’è‰²åï¼ˆæ—¥è¯­ï¼‰, ç½—é©¬éŸ³, ç»„åˆ, å£°ä¼˜
æ«»æœ¨çœŸä¹ƒ, Sakuragi.Mano, Illumination STARS, é–¢æ ¹ç³
èŠ¹æ²¢ã‚ã•ã², Serizawa.Asahi, Straylight, ç”°ä¸­æœ‰ç´€
...
```

**è¾“å‡ºæ–‡ä»¶**: `è§’è‰²åˆ—è¡¨.csv`

---

### 2.2 å¡ç‰‡ä¸»é¢˜æ”¶é›†

**ä»»åŠ¡**: æ”¶é›†æ¯å¼ è§’è‰²å¡çš„ä¸»é¢˜åç§°

**æ”¶é›†æ–¹æ³•**:
1. è®¿é—®wikiè§’è‰²é¡µé¢
2. å¤åˆ¶ã€ä¸»é¢˜ã€‘éƒ¨åˆ†
3. æ•´ç†åˆ°è¡¨æ ¼

**æ ¼å¼**:
```csv
è§’è‰²ç½—é©¬éŸ³, ç¨€æœ‰åº¦, å¡ç‰‡åºå·, ä¸»é¢˜å
Sakuragi.Mano, UR, 1, é§…ç·šä¸Šã®æ—¥å¸¸
Sakuragi.Mano, UR, 2, è¼ãã®èˆå°
Sakuragi.Mano, SSR, 1, æ”¾èª²å¾Œã®ãƒ¡ãƒ¢ãƒªãƒ¼
...
```

**è¾“å‡ºæ–‡ä»¶**: `å¡ç‰‡ä¸»é¢˜åˆ—è¡¨.csv`

**æˆ‘æä¾›çš„å·¥å…·**: CSVè½¬TypeScriptè„šæœ¬

---

### 2.3 å›¾ç‰‡èµ„æºæ”¶é›†

**ä»»åŠ¡**: ä¸‹è½½è§’è‰²å¡å›¾ç‰‡

**æ¥æº**: é—ªè€€è‰²å½©wiki

**å‘½åè§„èŒƒ**: `{è§’è‰²ç½—é©¬éŸ³}.{ç¨€æœ‰åº¦}.{åºå·}.jpg`

**ç¤ºä¾‹**:
```
Sakuragi.Mano.UR.01.jpg
Sakuragi.Mano.UR.02.jpg
Sakuragi.Mano.SSR.01.jpg
...
```

**æ³¨æ„äº‹é¡¹**:
- å›¾ç‰‡å°ºå¯¸ï¼šå»ºè®®500x750æˆ–æ›´é«˜
- å›¾ç‰‡æ ¼å¼ï¼šJPG
- æ–‡ä»¶å¤§å°ï¼šæ¯å¼ 50-200KB

**æˆ‘æä¾›çš„å·¥å…·**: æ‰¹é‡é‡å‘½åè„šæœ¬

---

### 2.4 æ”¯æ´å¡å›¾ç‰‡æ”¶é›†

**ä»»åŠ¡**: ä¸‹è½½æ”¯æ´å¡å›¾ç‰‡

**å‘½åè§„èŒƒ**: `{è§’è‰²ç½—é©¬éŸ³}.{ç¨€æœ‰åº¦}.Support.{åºå·}.jpg`

**åˆ†ç±»æ•´ç†**:
```
æŒ‰ç¨€æœ‰åº¦åˆ†æ–‡ä»¶å¤¹ï¼š
UR/
  Sakuragi.Mano.UR.Support.01.jpg
  Sakuragi.Mano.UR.Support.02.jpg
SSR/
  Sakuragi.Mano.SSR.Support.01.jpg
...
```

---

### 2.5 æ•°æ®æ›¿æ¢

**ä»»åŠ¡**: ç”¨çœŸå®æ•°æ®æ›¿æ¢å ä½æ•°æ®

**æ­¥éª¤**:
1. ä½ æä¾›CSVæ–‡ä»¶
2. æˆ‘è¿è¡Œè½¬æ¢è„šæœ¬ç”ŸæˆTypeScript
3. æ›¿æ¢ `data/` ä¸‹çš„å ä½æ–‡ä»¶
4. ä¸Šä¼ å›¾ç‰‡åˆ°GitHub Release
5. æµ‹è¯•éªŒè¯

---

## ğŸ“… Phase 3: AIæŠ€èƒ½ç”Ÿæˆä¸ä¼˜åŒ–

**æ—¶é—´**: Week 4

### 3.1 AIæŠ€èƒ½ç”Ÿæˆå®ç°

**æ–‡ä»¶**: `skill-generator.ts`
```typescript
/**
 * ä¸ºè§’è‰²å¡ç”Ÿæˆç‹¬ç‰¹æŠ€èƒ½
 */
export async function generateUniqueSkill(
  cardId: string,
  fullCardName: string,
  characterName: string,
  rarity: Rarity
): Promise<UniqueSkill> {
  
  const prompt = buildSkillPrompt(fullCardName, characterName, rarity);
  
  try {
    // è°ƒç”¨SillyTavernçš„API
    const result = await triggerSlash(`/gen ${prompt}`);
    const parsed = parseSkillResponse(result);
    
    // åŒ¹é…æ”¯æ´å¡å›¾ç‰‡
    const supportImage = matchSupportCard(characterEn, rarity);
    
    const skill: UniqueSkill = {
      cardId,
      name: parsed.name,
      type: parsed.type,
      description: parsed.description,
      effect: parsed.effect,
      supportCardImage: supportImage,
      generatedAt: new Date().toISOString(),
    };
    
    // ä¿å­˜åˆ°ä¸–ç•Œä¹¦
    await saveSkillToWorldbook(skill);
    
    return skill;
  } catch (error) {
    console.error('æŠ€èƒ½ç”Ÿæˆå¤±è´¥:', error);
    return getDefaultSkill(cardId, rarity);
  }
}

function buildSkillPrompt(
  cardName: string,
  character: string,
  rarity: Rarity
): string {
  return `
ä½ æ˜¯ã€Šå¶åƒå¤§å¸ˆ é—ªè€€è‰²å½©ã€‹çš„æ¸¸æˆè®¾è®¡å¸ˆã€‚è¯·ä¸ºä»¥ä¸‹è§’è‰²å¡ç”Ÿæˆä¸€ä¸ªç‹¬ç‰¹æŠ€èƒ½å¡ç‰Œï¼š

ã€è§’è‰²å¡ä¿¡æ¯ã€‘
- å¡ç‰Œåï¼š${cardName}
- è§’è‰²ï¼š${character}
- ç¨€æœ‰åº¦ï¼š${rarity}

ã€è®¾è®¡è¦æ±‚ã€‘
1. æŠ€èƒ½åç§°è¦ç¬¦åˆ${character}çš„æ€§æ ¼å’Œ${cardName}çš„ä¸»é¢˜
2. ${rarity}çº§æŠ€èƒ½åº”è¯¥æœ‰ç›¸åº”çš„å¼ºåº¦ï¼ˆURæœ€å¼ºï¼ŒRæœ€å¼±ï¼‰
3. å‚è€ƒã€Šå­¦å›­å¶åƒå¤§å¸ˆã€‹çš„æŠ€èƒ½è®¾è®¡é£æ ¼
4. æŠ€èƒ½æ•ˆæœè¦å…·ä½“ä¸”å¹³è¡¡

ã€è¾“å‡ºæ ¼å¼ã€‘ï¼ˆä¸¥æ ¼æŒ‰JSONæ ¼å¼ï¼Œä¸è¦æœ‰å…¶ä»–æ–‡å­—ï¼‰
\`\`\`json
{
  "name": "æŠ€èƒ½åç§°ï¼ˆæ—¥è¯­ï¼‰",
  "type": "Vo/Da/Vi/Mental/Support",
  "description": "ç®€çŸ­çš„æŠ€èƒ½æè¿°ï¼ˆ1-2å¥è¯ï¼Œæ—¥è¯­ï¼‰",
  "effect": {
    "target": "è‡ªèº«/å…¨ä½“/å‰æ’/åæ’",
    "value": "+20%/+15ç‚¹",
    "duration": "3å›åˆ/æ°¸ä¹…/æœ¬åœº"
  }
}
\`\`\`
`.trim();
}
```

### 3.2 æŠ€èƒ½å±•ç¤ºç•Œé¢

**æ–‡ä»¶**: `components/SkillGenerator.vue`
```vue
<template>
  <div class="skill-generator">
    <div v-if="!skill" class="generate-prompt">
      <div class="question-mark">?</div>
      <button class="btn-generate" @click="handleGenerate">
        ã‚¹ã‚­ãƒ«ç”Ÿæˆ
      </button>
    </div>
    
    <div v-else class="skill-display">
      <div class="skill-image">
        <img :src="skill.supportCardImage" alt="æŠ€èƒ½å¡é¢" />
      </div>
      <div class="skill-info">
        <h3 class="skill-name">{{ skill.name }}</h3>
        <div class="skill-type">{{ skill.type }}</div>
        <p class="skill-desc">{{ skill.description }}</p>
        <div class="skill-effect">
          <div>å¯¾è±¡: {{ skill.effect.target }}</div>
          <div>åŠ¹æœ: {{ skill.effect.value }}</div>
          <div>æŒç¶š: {{ skill.effect.duration }}</div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import { generateUniqueSkill } from '../skill-generator';

const props = defineProps<{
  cardId: string;
  fullCardName: string;
  characterName: string;
  characterEn: string;
  rarity: Rarity;
}>();

const skill = ref<UniqueSkill | null>(null);
const generating = ref(false);

async function handleGenerate() {
  if (generating.value) return;
  
  generating.value = true;
  toastr.info('æŠ€èƒ½ç”Ÿæˆä¸­...', '', { timeOut: 0 });
  
  try {
    skill.value = await generateUniqueSkill(
      props.cardId,
      props.fullCardName,
      props.characterName,
      props.rarity
    );
    toastr.clear();
    toastr.success('æŠ€èƒ½ç”ŸæˆæˆåŠŸï¼');
  } catch (error) {
    toastr.clear();
    toastr.error('æŠ€èƒ½ç”Ÿæˆå¤±è´¥');
  } finally {
    generating.value = false;
  }
}
</script>
```

---

## ğŸ“… Phase 4: æµ‹è¯•ä¸å‘å¸ƒ

**æ—¶é—´**: Week 5

### 4.1 å…¨é¢æµ‹è¯•

**æ¦‚ç‡æµ‹è¯•**:
```typescript
// æµ‹è¯•å·¥å…·ï¼šæ¨¡æ‹Ÿ10000æ¬¡æŠ½å¡
function testProbability() {
  const results = { UR: 0, SSR: 0, SR: 0, R: 0 };
  const testData = loadUserData();
  
  for (let i = 0; i < 10000; i++) {
    const result = performSinglePull(testData);
    results[result.rarity]++;
  }
  
  console.log('10000æ¬¡æŠ½å¡ç»Ÿè®¡:');
  console.log('UR:', (results.UR / 10000 * 100).toFixed(2) + '%', '(ç†è®º0.50%)');
  console.log('SSR:', (results.SSR / 10000 * 100).toFixed(2) + '%', '(ç†è®º5.00%)');
  console.log('SR:', (results.SR / 10000 * 100).toFixed(2) + '%', '(ç†è®º16.00%)');
  console.log('R:', (results.R / 10000 * 100).toFixed(2) + '%', '(ç†è®º78.50%)');
}
```

**ä¿åº•æµ‹è¯•**:
- éªŒè¯90æŠ½SSRä¿åº•
- éªŒè¯200æŠ½URä¿åº•
- éªŒè¯åè¿è‡³å°‘1ä¸ªSR

**æ€§èƒ½æµ‹è¯•**:
- å•æŠ½å“åº”æ—¶é—´ < 100ms
- åè¿å“åº”æ—¶é—´ < 500ms
- å†…å­˜å ç”¨ < 50MB

---

### 4.2 æ–‡æ¡£ç¼–å†™

**ç”¨æˆ·æ–‡æ¡£**: `ä½¿ç”¨è¯´æ˜.md`
**å¼€å‘æ–‡æ¡£**: `æŠ€æœ¯æ–‡æ¡£.md`
**æ›´æ–°æ—¥å¿—**: `CHANGELOG.md`

---

### 4.3 æ„å»ºä¸å‘å¸ƒ

```bash
npm run build
```

**è¾“å‡º**: `dist/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/gacha/index.html`

---

## ğŸ“Š å¼€å‘æ—¶é—´çº¿

```
Week 1: Phase 1 å‰ç«¯å¼€å‘
â”œâ”€ Day 1-2: åŸºç¡€æ¶æ„ + å ä½æ•°æ®
â”œâ”€ Day 3-4: æ ¸å¿ƒé€»è¾‘å®ç°
â”œâ”€ Day 5-7: Vueç»„ä»¶å¼€å‘
â””â”€ Day 8: æµ‹è¯•è°ƒè¯•

Week 2: Phase 1 å®Œå–„
â”œâ”€ åŠ¨ç”»æ•ˆæœ
â”œâ”€ éŸ³æ•ˆæ·»åŠ ï¼ˆå¯é€‰ï¼‰
â””â”€ UIä¼˜åŒ–

Week 3: Phase 2 æ•°æ®æ”¶é›†
â”œâ”€ ä½ ï¼šæ”¶é›†è§’è‰²ã€ä¸»é¢˜ã€å›¾ç‰‡
â””â”€ æˆ‘ï¼šæä¾›è½¬æ¢å·¥å…·å’Œè„šæœ¬

Week 4: Phase 3 AIé›†æˆ
â”œâ”€ æŠ€èƒ½ç”Ÿæˆå®ç°
â”œâ”€ æ”¯æ´å¡åŒ¹é…
â””â”€ ä¸–ç•Œä¹¦å­˜å‚¨

Week 5: Phase 4 æµ‹è¯•å‘å¸ƒ
â”œâ”€ æ¦‚ç‡æµ‹è¯•
â”œâ”€ æ€§èƒ½ä¼˜åŒ–
â””â”€ æ–‡æ¡£ç¼–å†™
```

---

## ğŸ¯ å…³é”®é‡Œç¨‹ç¢‘

- [x] **é‡Œç¨‹ç¢‘1** (Day 8): å‰ç«¯ç³»ç»Ÿå¯è¿è¡Œï¼ˆä½¿ç”¨å ä½æ•°æ®ï¼‰
- [ ] **é‡Œç¨‹ç¢‘2** (Week 3): çœŸå®æ•°æ®æ›¿æ¢å®Œæˆ
- [ ] **é‡Œç¨‹ç¢‘3** (Week 4): AIæŠ€èƒ½ç”Ÿæˆå¯ç”¨
- [ ] **é‡Œç¨‹ç¢‘4** (Week 5): ç³»ç»Ÿæ­£å¼å‘å¸ƒ

---

## ğŸ› ï¸ æˆ‘æä¾›çš„å·¥å…·

### 1. CSVè½¬TypeScriptè„šæœ¬
```python
# å°†ä½ çš„CSVè½¬æ¢ä¸ºTypeScriptä»£ç 
python tools/csv_to_ts.py è§’è‰²åˆ—è¡¨.csv > data/characters.ts
python tools/csv_to_ts.py å¡ç‰‡ä¸»é¢˜åˆ—è¡¨.csv > data/card-themes.ts
```

### 2. å›¾ç‰‡æ‰¹é‡é‡å‘½åè„šæœ¬
```python
# æ‰¹é‡é‡å‘½åå›¾ç‰‡
python tools/rename_images.py --input å›¾ç‰‡æ–‡ä»¶å¤¹ --output æ•´ç†åæ–‡ä»¶å¤¹
```

### 3. å¼€å‘è°ƒè¯•å·¥å…·
- ç¾½çŸ³æ·»åŠ å™¨
- ä¿åº•æ¨¡æ‹Ÿå™¨
- æ¦‚ç‡æµ‹è¯•å™¨

---

## â“ FAQ

**Q: å¦‚æœæŸä¸ªè§’è‰²æ²¡æœ‰URå¡æ€ä¹ˆåŠï¼Ÿ**  
A: åœ¨ `RARITY_POOLS.UR` ä¸­ä¸åŒ…å«è¯¥è§’è‰²ç´¢å¼•å³å¯ã€‚

**Q: å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥æ€ä¹ˆåŠï¼Ÿ**  
A: ç»„ä»¶ä¸­å·²å®ç°è‡ªåŠ¨fallbackåˆ°å ä½å›¾ã€‚

**Q: å¦‚ä½•æ·»åŠ æ–°è§’è‰²ï¼Ÿ**  
A: åªéœ€åœ¨ `CHARACTERS` æ•°ç»„ä¸­æ·»åŠ ä¸€è¡Œï¼Œç³»ç»Ÿè‡ªåŠ¨å¤„ç†ã€‚

**Q: å¦‚ä½•è°ƒæ•´æ¦‚ç‡ï¼Ÿ**  
A: ä¿®æ”¹ `constants.ts` ä¸­çš„ `BASE_RATES`ã€‚

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ä½ ç¡®è®¤æ–¹æ¡ˆ** âœ…
2. **æˆ‘å¼€å§‹ Phase 1 å¼€å‘** (Day 1-8)
3. **ä½ å¼€å§‹æ”¶é›†æ•°æ®** (Week 3)
4. **æˆ‘ä»¬åä½œ Phase 2-4**

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025å¹´10æœˆ28æ—¥  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ28æ—¥



