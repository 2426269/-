# 提示词优化总结 - 培育计划特色强化与使用限制

## 📅 优化日期
2025-11-03

---

## 🎯 优化目标

根据用户反馈，解决两个关键问题：

1. ❌ **AI混用所有buff** - 没有遵循不同属性（培育计划）不同玩法的要求
2. ❌ **所有卡都是"训练中1回"** - 需要告诉AI有可重复使用的卡牌

---

## ✅ 已完成的优化

### 1. **强化培育计划特色要求（`提示词区.ts`）**

#### 修改 1：添加培育计划专属效果规则

**新增位置**：第95-105行

```markdown
### 3️⃣ 培育计划特色与核心机制（⚠️ 必须严格遵守）

**当前培育计划**：{{producePlan}}

{{producePlanMechanic}}

**⚠️ 重要规则**：
- **必须优先使用当前培育计划的专属效果**（如：感性用好调/集中，理性用好印象/干劲，非凡用全力/强气/温存）
- **禁止混用其他计划的核心效果**（如：感性卡不能用好印象/干劲，理性卡不能用好调/集中）
- **可以使用通用效果**（如：体力回复、元气增加、技能卡使用数追加等）
- **效果必须符合计划的玩法特点**（如：感性=爆发，理性=持续，非凡=灵活切换）
```

**作用**：
- 明确当前培育计划
- 强调必须使用专属效果
- 禁止跨计划混用buff
- 允许使用通用效果

---

#### 修改 2：添加卡牌使用限制说明

**新增位置**：第120-125行

```markdown
**使用限制说明（重要）**：
- **训练中1回 不可重复**：每次训练只能使用1次，用完后从牌库移除
- **训练中N回**：每次训练可使用N次，用完后从牌库移除
- **可重复使用**：可以在训练中多次打出（常见于低成本通用卡）
- **回合限制**：如"此效果期间，每回合1回"
- ⚠️ **不要所有卡都设计成"训练中1回"** - 根据稀有度和效果强度灵活设计
```

**作用**：
- 说明不同的使用限制类型
- 提醒AI不要所有卡都是"训练中1回"
- 鼓励根据稀有度和效果强度灵活设计

---

### 2. **强化思维链中的检查项（`思维链区.ts`）**

#### 修改：添加培育计划特色和使用限制检查

**修改位置**：第46-52行

```typescript
- 技能效果设计是否合理？
  - 效果类型是什么？（属性提升/Buff/得分/特殊效果/消耗）
  - 效果强度是否符合示例卡的平衡标准？
  - **是否优先使用了当前培育计划的专属效果？**（感性=好调/集中，理性=好印象/干劲，非凡=全力/强气/温存）
  - **是否避免了混用其他计划的核心效果？**
  - 强化后的提升是否明显但不失衡？
  - **使用限制是否合理？**（不要所有卡都是"训练中1回"）
```

**作用**：
- 在AI思考过程中强制检查培育计划特色
- 在AI思考过程中强制检查使用限制

---

### 3. **添加当前培育计划的完整机制说明（`AI生成助手.ts`）**

#### 修改 1：导入新函数

**修改位置**：第11行

```typescript
import { getProducePlanMechanicMarkdown, getFullMechanicExplanation } from './游戏机制数据库';
```

---

#### 修改 2：在系统提示词中添加完整机制说明

**修改位置**：第112-114行

```typescript
// 3. 完整的游戏机制说明（只包含当前培育计划的相关内容）
const fullMechanicExplanation = getFullMechanicExplanation(producePlan);
promptParts.push('\n\n# 游戏机制详细说明\n\n' + fullMechanicExplanation);
```

**作用**：
- 只传递当前培育计划的相关机制
- 只传递当前培育计划的相关Buff效果
- 避免AI看到其他计划的效果而混用

---

## 📊 getFullMechanicExplanation 函数说明

### 函数定义（`游戏机制数据库.ts` 第470-489行）

```typescript
export function getFullMechanicExplanation(plan: ProducePlan): string {
  let explanation = '';

  // 1. 当前培育计划的机制
  explanation += getProducePlanMechanicMarkdown(plan);
  explanation += '\n---\n\n';

  // 2. 当前计划的Buff效果
  explanation += getEffectsByPlanMarkdown(plan);
  explanation += '\n---\n\n';

  // 3. 效果类型分类
  explanation += getEffectCategoriesMarkdown();
  explanation += '\n---\n\n';

  // 4. 重要规则
  explanation += getImportantRulesMarkdown();

  return explanation;
}
```

### 包含的内容

1. **当前培育计划的机制** - 核心机制、关键效果、玩法特点、典型词汇
2. **当前计划的Buff效果** - 只包含当前计划和通用的Buff，不包含其他计划的
3. **效果类型分类** - 属性操作、Buff效果、特殊效果的分类说明
4. **重要规则** - 禁止事项、必须遵守、三维作用说明

---

## 📈 优化前后对比

### 优化前（❌ 问题）

#### 系统提示词结构：
```
1. 思维链
2. 提示词框架（含简单的培育计划说明）
3. 示例卡片
```

#### 培育计划说明：
```markdown
### 非凡（アノマリー，Anomaly）

**核心机制**: 通过灵活切换三种指针状态...
**关键效果**:
- 全力
- 坚决
- 温存
...
```

#### 问题：
- ❌ AI看得到所有培育计划的效果
- ❌ 没有明确禁止混用其他计划的效果
- ❌ 没有说明卡牌使用限制的多样性

---

### 优化后（✅ 改进）

#### 系统提示词结构：
```
1. 思维链（含培育计划特色检查）
2. 提示词框架（含强化的培育计划规则）
3. 完整的游戏机制说明（只包含当前培育计划）
4. 示例卡片
```

#### 培育计划说明：
```markdown
### 3️⃣ 培育计划特色与核心机制（⚠️ 必须严格遵守）

**当前培育计划**：非凡

### 非凡（アノマリー，Anomaly）
（详细机制说明）

**⚠️ 重要规则**：
- **必须优先使用当前培育计划的专属效果**
- **禁止混用其他计划的核心效果**
- **可以使用通用效果**
- **效果必须符合计划的玩法特点**

---

# 游戏机制详细说明

### 非凡计划相关效果

| 效果名       | 日文名 | 说明 | 类型 |
| ------------ | ------ | ---- | ---- |
| 全力         | 全力   | ...  | 正面 |
| 坚决         | 強気   | ...  | 正面 |
| 温存         | 温存   | ...  | 正面 |
| 热意         | 熱意   | ...  | 正面 |
| （通用效果） | ...    | ...  | ...  |

（不包含感性和理性的效果）
```

#### 改进：
- ✅ AI只看得到当前培育计划的效果
- ✅ 明确禁止混用其他计划的效果
- ✅ 添加了卡牌使用限制的说明
- ✅ 在思维链中强制检查

---

## 🎯 培育计划专属效果列表

### 感性（センス，Sense）

**专属效果**：
- 好调（状态良好）
- 集中
- 绝好调（状态绝佳）

**玩法特点**：爆发型得分流，通过堆叠Buff在关键回合打出高分

**典型词汇**：好調、集中、絶好調、輝き、情熱、感動、心、笑顔、幸せ、光、夢、希望

---

### 理性（ロジック，Logic）

**专属效果**：
- 好印象
- 有干劲（やる気）

**玩法特点**：稳定型持续流，通过被动效果持续积累分数和资源

**典型词汇**：好印象、やる気、論理、計算、努力、成長、積み重ね、戦略、冷静、分析

---

### 非凡（アノマリー，Anomaly）

**专属效果**：
- 全力
- 坚决（強気）
- 温存
- 热意

**玩法特点**：灵活型策略流，根据局势切换状态，兼具爆发、稳健、蓄力

**典型词汇**：全力、強気、温存、熱意、爆発、覚醒、限界、突破、奇跡、異常、特異、超越

---

### 通用效果

**可在所有计划中使用**：
- 体力回复/消耗体力减少
- 元气增加
- 技能卡使用数追加
- 回合数追加
- 低下状态无效
- 训练中强化
- 生成（直接获得技能卡）

---

## 🧪 测试案例

### 测试 1：感性培育计划

**应该生成**：
```
"effect": "数值+30 好调3回合 集中+5 ※训练中1回 不可重复"
```

**不应该生成**：
```
❌ "数值+30 好印象+3 干劲+2"  // 混用了理性的效果
❌ "数值+30 全力值+5"  // 混用了非凡的效果
```

---

### 测试 2：理性培育计划

**应该生成**：
```
"effect": "数值+20 好印象+4 干劲+3 ※可重复使用"  // 低成本卡可重复
```

**不应该生成**：
```
❌ "数值+20 好调2回合"  // 混用了感性的效果
❌ "数值+20 全力值+3"  // 混用了非凡的效果
```

---

### 测试 3：非凡培育计划

**应该生成**：
```
"effect": "数值+25 全力值+3 强气状态下数值额外+10 ※训练中2回"
```

**不应该生成**：
```
❌ "数值+25 好调2回合"  // 混用了感性的效果
❌ "数值+25 好印象+3"  // 混用了理性的效果
```

---

### 测试 4：使用限制多样性

**应该有多样性**：
```
✅ N卡: "可重复使用" 或 "训练中3回"
✅ R卡: "训练中2回" 或 "可重复使用"
✅ SR卡: "训练中1回 不可重复"
✅ SSR卡: "训练中1回 不可重复"
✅ UR卡: "训练中1回 不可重复" 或特殊限制
```

**不应该所有卡都是**：
```
❌ "训练中1回 不可重复"
```

---

## 📝 修改的文件列表

| 文件            | 修改内容         | 行数 |
| --------------- | ---------------- | ---- |
| `提示词区.ts`   | 添加培育计划规则 | +9行 |
| `提示词区.ts`   | 添加使用限制说明 | +6行 |
| `思维链区.ts`   | 强化检查项       | +3行 |
| `AI生成助手.ts` | 导入新函数       | +1行 |
| `AI生成助手.ts` | 添加完整机制说明 | +3行 |

**总计**：约 **22行代码**

---

## ✅ 优化验证

### 构建状态
- ✅ 编译成功，无错误
- ✅ TypeScript 类型检查通过

### 逻辑验证
- ✅ AI只会看到当前培育计划的效果
- ✅ 明确禁止混用其他计划的核心效果
- ✅ 添加了卡牌使用限制的多样性说明
- ✅ 在思维链中强制检查培育计划特色

---

## 🎉 预期效果

### 现在AI应该：

1. ✅ **严格遵守培育计划特色**
   - 感性卡只用好调/集中/绝好调
   - 理性卡只用好印象/干劲
   - 非凡卡只用全力/强气/温存/热意

2. ✅ **可以使用通用效果**
   - 体力回复、元气增加
   - 技能卡使用数追加
   - 回合数追加等

3. ✅ **使用限制多样化**
   - 不是所有卡都"训练中1回"
   - 低成本卡可重复使用
   - 高稀有度卡有限制

4. ✅ **效果符合玩法特点**
   - 感性=爆发（在关键回合打出高分）
   - 理性=持续（被动持续积累）
   - 非凡=灵活（切换状态适应局势）

---

## 🎯 下一步测试

现在可以重新测试AI生成功能，应该会看到：

1. ✅ 感性卡不再混用好印象/干劲
2. ✅ 理性卡不再混用好调/集中
3. ✅ 非凡卡不再混用其他计划的核心效果
4. ✅ 卡牌使用限制更加多样化

**推荐测试**：
- 生成一张感性SSR卡
- 生成一张理性R卡
- 生成一张非凡UR卡

查看它们的效果是否符合各自培育计划的特色！


