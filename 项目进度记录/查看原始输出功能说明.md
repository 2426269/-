# 查看 AI 原始输出功能说明

## 🎯 功能概述

为偶像图鉴的 AI 技能卡生成系统添加了"查看原始输出"功能，方便您调试和检查 SillyTavern AI 的实际响应内容。

---

## ✨ 功能特性

### 1. **自动保存原始输出**
- 每次调用 AI 生成技能卡时，自动保存 SillyTavern 的原始响应
- 无论生成成功或失败，都会保存原始输出
- 在控制台输出原始内容长度：`📄 AI 原始输出已保存，长度: XXXX 字符`

### 2. **查看原始输出按钮**
- 生成完成后，会出现"查看原始输出"按钮
- 点击后展开显示 AI 的完整响应
- 再次点击可隐藏

### 3. **美观的代码显示**
- 深色代码编辑器主题（类似 VS Code）
- 等宽字体（Consolas/Monaco）
- 自动换行和滚动条
- 最大高度 500px，超出可滚动

### 4. **一键复制功能**
- 原始输出区域右上角有"复制"按钮
- 点击即可将完整内容复制到剪贴板
- 复制成功会显示提示消息

---

## 📋 使用方法

### 步骤 1：生成技能卡
1. 打开偶像图鉴
2. 选择一张未生成技能的卡片
3. 点击"生成技能卡"按钮
4. 等待 AI 生成

### 步骤 2：查看原始输出
1. 生成完成后，在生成按钮下方会出现"查看原始输出"按钮
2. 点击按钮展开原始输出区域
3. 查看 AI 的完整响应内容

### 步骤 3：复制原始输出（可选）
1. 在原始输出区域右上角点击"复制"按钮
2. 内容已复制到剪贴板
3. 可以粘贴到记事本、Discord 等任何地方

---

## 🔍 调试指南

### 查看原始输出的目的

#### 1. **检查 AI 是否正确输出中文**
```
✅ 正确示例：
"数值+10 元气+3 体力回复2 ※训练中1回 不可重复"

❌ 错误示例（仍在输出日文）：
"パラメータ+10 元気+3 体力回復2 ※レッスン中1回 重複不可"
```

#### 2. **检查 AI 是否使用了示例卡**
- 查看原始输出中是否提到了示例技能卡
- 确认 AI 是否基于示例卡的强度来设计

#### 3. **检查 JSON 格式是否正确**
```json
{
  "id": "asuka_ssr_exclusive",
  "nameJP": "煌めく決意",
  "nameCN": "闪耀的决心",
  "type": "主动",
  "rarity": "SSR",
  "cost": 5,
  "producePlan": "感性",
  "effect": "数值+50 元气+3 好调2回合",
  "effectEnhanced": "数值+75 元气+5 绝好调3回合"
}
```

#### 4. **定位解析失败的原因**
- 如果生成失败，查看原始输出可以发现：
  - AI 是否输出了非 JSON 内容（如解释文字）
  - JSON 格式是否有语法错误
  - 字段名是否正确

---

## 🐛 常见问题与解决方案

### 问题 1：AI 仍然输出日文
**症状**：
```
"effect": "パラメータ+10 元気+3"
```

**解决方案**：
- 检查提示词中的术语翻译表是否正确
- 增强提示词中的中文要求
- 在 `提示词区.ts` 中添加更多强调

---

### 问题 2：AI 输出了多余的解释文字
**症状**：
```
根据您的要求，我为九条朝日设计了以下技能卡：

{
  "id": "asuka_ssr_exclusive",
  ...
}

这张卡的设计灵感来自...
```

**解决方案**：
- 在提示词中强调"**仅输出JSON，不要包含任何解释**"
- 修改 `parseSkillCardJSON` 方法，增强 JSON 提取能力

---

### 问题 3：JSON 字段缺失或错误
**症状**：
```
{
  "id": "asuka_ssr_exclusive",
  "name": "闪耀的决心",  // ❌ 缺少 nameJP 和 nameCN
  ...
}
```

**解决方案**：
- 检查 Zod Schema 定义
- 在提示词中明确所有必需字段
- 提供更清晰的输出示例

---

## 📊 调试流程建议

### 完整调试流程：

1. **生成技能卡**
   ```
   点击"生成技能卡"
   ```

2. **查看浏览器控制台**
   ```
   F12 → Console
   查找日志：
   - 📤 发送请求到AI...
   - 📥 AI响应长度: XXXX 字符
   - 📄 AI 原始输出已保存
   - ✅ 技能卡已生成
   ```

3. **查看原始输出**
   ```
   点击"查看原始输出"按钮
   检查 AI 实际输出的内容
   ```

4. **复制并分析**
   ```
   点击"复制"按钮
   粘贴到文本编辑器
   逐行分析问题
   ```

5. **根据问题修改提示词**
   ```
   如果是术语问题 → 修改 提示词区.ts
   如果是格式问题 → 修改 AI生成助手.ts
   如果是示例卡问题 → 修改 示例卡抽取区.ts
   ```

---

## 🎨 UI 设计说明

### 按钮样式
- **颜色**：蓝色渐变（#4a90e2 → #357abd）
- **大小**：14px 字体，10px 上边距
- **动画**：悬停时上移 2px
- **图标**：`fa-code`（查看时）/ `fa-eye-slash`（隐藏时）

### 原始输出区域样式
- **背景**：深色主题（#1e1e1e）
- **代码区域**：更深的背景（#0d0d0d）
- **文字颜色**：浅灰色（#dcdcdc）
- **滚动条**：蓝色渐变（#4a90e2）
- **动画**：`slideIn` 展开动画

---

## 🚀 后续优化建议

1. **添加语法高亮**
   - 使用 `highlight.js` 或 `prism.js`
   - 高亮 JSON 格式

2. **添加格式化按钮**
   - 自动格式化 JSON
   - 美化显示

3. **添加导出功能**
   - 导出为 `.txt` 或 `.json` 文件
   - 方便存档和分享

4. **添加历史记录**
   - 保存最近 10 次的原始输出
   - 方便对比不同生成结果

---

## ✅ 总结

通过这个功能，您现在可以：

1. ✅ **实时查看** SillyTavern AI 的原始响应
2. ✅ **快速复制** 原始内容到剪贴板
3. ✅ **调试问题** 定位 AI 生成失败的原因
4. ✅ **优化提示词** 根据实际输出改进提示词

**下一步**：可以开始测试 AI 生成功能，查看是否正确输出中文，并根据原始输出优化提示词！


