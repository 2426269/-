# æŠ€èƒ½å¡ç±»å‹ä¸åŒ¹é…ä¿®å¤æ€»ç»“

## ğŸ› é—®é¢˜æ ¹æº

**ç¤ºä¾‹æŠ€èƒ½å¡æœªèƒ½æ­£ç¡®æ˜¾ç¤º**ï¼Œæ‰€æœ‰å­—æ®µéƒ½æ˜¾ç¤ºä¸º `undefined`ã€‚

### é—®é¢˜åˆ†æ

é¡¹ç›®ä¸­å­˜åœ¨**ä¸¤å¥—ä¸å…¼å®¹çš„ SkillCard ç±»å‹å®šä¹‰**ï¼š

| ç³»ç»Ÿç±»å‹     | å­—æ®µå                                                          | ä½ç½®                       |
| ------------ | --------------------------------------------------------------- | -------------------------- |
| **æˆ˜æ–—ç³»ç»Ÿ** | `name`, `plan`, `cardType`, `effect_before/after`               | `æˆ˜æ–—/ç±»å‹/æŠ€èƒ½å¡ç±»å‹.ts`  |
| **AIç”Ÿæˆ**   | `nameJP/nameCN`, `producePlan`, `type`, `effect/effectEnhanced` | `ä¸–ç•Œä¹¦ç®¡ç†/AIç”ŸæˆåŠ©æ‰‹.ts` |

### ä¸åŒ¹é…çš„å­—æ®µå¯¹ç…§è¡¨

| æˆ˜æ–—ç³»ç»Ÿ                              | AIç”Ÿæˆ                                        | è¯´æ˜          |
| ------------------------------------- | --------------------------------------------- | ------------- |
| `name: string`                        | `nameJP: string, nameCN: string`              | åç§°æ ¼å¼ä¸åŒ  |
| `plan: ProducePlan`                   | `producePlan: ProducePlan`                    | å­—æ®µåä¸åŒ    |
| `cardType: 'A' \| 'M' \| 'T'`         | `type: 'ä¸»åŠ¨' \| 'ç²¾ç¥' \| 'é™·é˜±'`            | å­—æ®µå+å€¼ä¸åŒ |
| `effect_before: string`               | `effect: string`                              | å­—æ®µåä¸åŒ    |
| `effect_after: string`                | `effectEnhanced: string`                      | å­—æ®µåä¸åŒ    |
| `rarity: 'N' \| 'R' \| 'SR' \| 'SSR'` | `rarity: 'N' \| 'R' \| 'SR' \| 'SSR' \| 'UR'` | AIå¯ç”ŸæˆURçº§  |

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. **ç»Ÿä¸€ç±»å‹å®šä¹‰**

#### 1.1 æ·»åŠ  UR ç¨€æœ‰åº¦

```typescript
// æˆ˜æ–—/ç±»å‹/æŠ€èƒ½å¡ç±»å‹.ts
export type SkillCardRarity = 'N' | 'R' | 'SR' | 'SSR' | 'UR';
```

#### 1.2 åˆ›å»º AI ç”Ÿæˆä¸“ç”¨ç±»å‹

```typescript
// ä¸–ç•Œä¹¦ç®¡ç†/AIç”ŸæˆåŠ©æ‰‹.ts
const AIGeneratedSkillCardSchema = z.object({
  id: z.string(),
  nameJP: z.string(),
  nameCN: z.string(),
  type: z.enum(['ä¸»åŠ¨', 'ç²¾ç¥', 'é™·é˜±']),
  rarity: z.enum(['N', 'R', 'SR', 'SSR', 'UR']),
  cost: z.string(),
  producePlan: z.enum(['æ„Ÿæ€§', 'ç†æ€§', 'éå‡¡', 'è‡ªç”±']),
  effect: z.string(),
  effectEnhanced: z.string(),
  flavor: z.string().optional(),
});

type AIGeneratedSkillCard = z.infer<typeof AIGeneratedSkillCardSchema>;
```

### 2. **ä¿®å¤ç¤ºä¾‹å¡æ ¼å¼åŒ–**

#### 2.1 ä¿®å¤ `formatCardTable()` æ–¹æ³•

```typescript
// ç¤ºä¾‹å¡æŠ½å–åŒº.ts
private static formatCardTable(cards: SkillCard[], title: string): string {
  // ...
  cards.forEach(card => {
    // âœ… ä½¿ç”¨æˆ˜æ–—ç³»ç»Ÿçš„å­—æ®µ
    const cardTypeText = card.cardType === 'A' ? 'ä¸»åŠ¨' : card.cardType === 'M' ? 'ç²¾ç¥' : 'é™·é˜±';
    table += `| ${card.id} | ${card.name} | ${cardTypeText} | ${card.cost} | ${card.plan} | ${card.effect_before} |\n`;
  });
  return table;
}
```

### 3. **åˆ›å»ºç±»å‹è½¬æ¢å‡½æ•°**

#### 3.1 AIç”Ÿæˆ â†’ æˆ˜æ–—ç³»ç»Ÿ

```typescript
// AIç”ŸæˆåŠ©æ‰‹.ts
private convertToSkillCard(aiCard: AIGeneratedSkillCard, characterName: string): SkillCard {
  // ç±»å‹æ˜ å°„
  const cardType: SkillCard['cardType'] =
    aiCard.type === 'ä¸»åŠ¨' ? 'A' : aiCard.type === 'ç²¾ç¥' ? 'M' : 'T';

  return {
    id: aiCard.id,
    name: `${aiCard.nameJP} / ${aiCard.nameCN}`, // â† åˆå¹¶ä¸ºå•ä¸€nameå­—æ®µ
    rarity: aiCard.rarity as SkillCardRarity,
    plan: aiCard.producePlan as ProducePlan, // â† è½¬æ¢å­—æ®µå
    cardType, // â† è½¬æ¢å­—æ®µåå’Œå€¼
    cost: aiCard.cost,
    effect_before: aiCard.effect, // â† è½¬æ¢å­—æ®µå
    effect_after: aiCard.effectEnhanced, // â† è½¬æ¢å­—æ®µå
    enhanced: false,
    isExclusive: true,
    bindingCardId: characterName,
  };
}
```

### 4. **ä¿®å¤ç”Ÿæˆæµç¨‹**

#### 4.1 ä¿®æ”¹ `generateSkillCard()` æ–¹æ³•

```typescript
// AIç”ŸæˆåŠ©æ‰‹.ts
async generateSkillCard(options: SkillCardGenerationOptions): Promise<GenerationResult> {
  // ...

  // 3. è§£æJSON
  const aiCard = this.parseSkillCardJSON(aiOutput); // AIGeneratedSkillCard

  // 4. éªŒè¯AIç”Ÿæˆçš„æŠ€èƒ½å¡
  const validatedAICard = this.validateSkillCard(aiCard); // AIGeneratedSkillCard

  // 5. è½¬æ¢ä¸ºæˆ˜æ–—ç³»ç»Ÿçš„SkillCardæ ¼å¼
  const skillCard = this.convertToSkillCard(validatedAICard, characterName); // SkillCard

  return {
    success: true,
    skillCard: skillCard, // â† è¿”å›æˆ˜æ–—ç³»ç»Ÿæ ¼å¼
    rawOutput: aiOutput,
  };
}
```

### 5. **ä¿®å¤å‰ç«¯ç»„ä»¶**

#### 5.1 ä¿®æ”¹å¶åƒå›¾é‰´ä¿å­˜é€»è¾‘

```typescript
// å›¾é‰´/ç•Œé¢/å¶åƒå›¾é‰´.vue
if (result.success && result.skillCard) {
  const skillCard = result.skillCard; // ç°åœ¨æ˜¯ SkillCard ç±»å‹

  localStorage.setItem(skillKey, JSON.stringify({
    name: skillCard.name, // âœ… ç›´æ¥ä½¿ç”¨name
    effect: skillCard.effect_before, // âœ… ä½¿ç”¨effect_before
    effectEnhanced: skillCard.effect_after, // âœ… ä½¿ç”¨effect_after
    description: 'é—ªè€€çš„å¶åƒä¹‹åŠ›',
  }));

  selectedCard.value.skill = {
    name: skillCard.name, // âœ… ç›´æ¥ä½¿ç”¨name
    effect: skillCard.effect_before, // âœ… ä½¿ç”¨effect_before
    description: 'é—ªè€€çš„å¶åƒä¹‹åŠ›',
  };
}
```

---

## ğŸ“Š æ•°æ®æµå¯¹ç…§

### ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰ï¼š

```
æŠ€èƒ½å¡åº“ (SkillCard)
  â†“
ç¤ºä¾‹å¡æŠ½å– â†’ è®¿é—® card.nameJP âŒ â†’ undefined
  â†“
æç¤ºè¯ â†’ å…¨æ˜¯ undefined
  â†“
AI å›°æƒ‘ â†’ è¾“å‡ºé”™è¯¯
```

### ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰ï¼š

```
æŠ€èƒ½å¡åº“ (SkillCard: name, plan, cardType, effect_before/after)
  â†“
ç¤ºä¾‹å¡æŠ½å– â†’ è®¿é—® card.name, card.plan âœ… â†’ æ­£ç¡®å€¼
  â†“
æç¤ºè¯ â†’ å®Œæ•´çš„ç¤ºä¾‹å¡è¡¨æ ¼
  â†“
AI ç”Ÿæˆ â†’ AIGeneratedSkillCard (nameJP/nameCN, producePlan, type, effect/effectEnhanced)
  â†“
ç±»å‹è½¬æ¢ â†’ SkillCard
  â†“
å‰ç«¯ä¿å­˜/æ˜¾ç¤º â†’ ä½¿ç”¨ SkillCard æ ¼å¼
```

---

## ğŸ‰ ä¿®å¤æ•ˆæœ

### ç¤ºä¾‹å¡ç°åœ¨ä¼šæ­£ç¡®æ˜¾ç¤ºï¼š

```markdown
### SSRçº§ç¤ºä¾‹ï¼ˆè®¾è®¡å‚è€ƒï¼‰

| ID      | åç§°           | ç±»å‹   | æˆæœ¬      | åŸ¹è‚²è®¡åˆ’ | æ•ˆæœï¼ˆæœªå¼ºåŒ–ï¼‰  |
| ------- | -------------- | ------ | --------- | -------- | --------------- |
| æ„Ÿæ€§_18 | æ†§ã‚Œã®ã‚¢ã‚¤ãƒ‰ãƒ« | ä¸»åŠ¨   | ä½“åŠ›æ¶ˆè€—2 | æ„Ÿæ€§     | ã‚¹ã‚³ã‚¢+100ã€‚... |
| æ„Ÿæ€§_21 | ......         | ...... | ......    | ......   | ......          |
```

### AI ç”Ÿæˆçš„æŠ€èƒ½å¡ä¼šæ­£ç¡®è½¬æ¢ï¼š

```json
// AI è¾“å‡º (AIGeneratedSkillCard)
{
  "id": "skill_xxx",
  "nameJP": "ç…Œã‚ãæ±ºæ„",
  "nameCN": "é—ªè€€çš„å†³å¿ƒ",
  "type": "ä¸»åŠ¨",
  ...
}

// è½¬æ¢åå­˜å‚¨ (SkillCard)
{
  "id": "skill_xxx",
  "name": "ç…Œã‚ãæ±ºæ„ / é—ªè€€çš„å†³å¿ƒ",
  "cardType": "A",
  ...
}
```

---

## ğŸ“ æ€»ç»“

1. âœ… **ä¿®å¤äº†æŠ€èƒ½å¡åº“ç±»å‹å®šä¹‰**
   - ç»Ÿä¸€ä½¿ç”¨ `SkillCard` ç±»å‹
   - æ·»åŠ  UR ç¨€æœ‰åº¦æ”¯æŒ

2. âœ… **ä¿®å¤äº†ç¤ºä¾‹å¡æ ¼å¼åŒ–**
   - æ­£ç¡®ä½¿ç”¨ `name`, `plan`, `cardType`, `effect_before`
   - ç¤ºä¾‹å¡ç°åœ¨ä¼šæ­£ç¡®æ˜¾ç¤ºåœ¨æç¤ºè¯ä¸­

3. âœ… **åˆ›å»ºäº†ç±»å‹è½¬æ¢ç³»ç»Ÿ**
   - AIç”Ÿæˆ â†’ æˆ˜æ–—ç³»ç»Ÿ
   - ç¡®ä¿ç±»å‹ä¸€è‡´æ€§

4. âœ… **ä¿®å¤äº†å‰ç«¯ç»„ä»¶**
   - æ­£ç¡®ä¿å­˜å’Œæ˜¾ç¤ºæŠ€èƒ½å¡
   - ä½¿ç”¨æˆ˜æ–—ç³»ç»Ÿçš„å­—æ®µå

---

## ğŸ§ª æµ‹è¯•å»ºè®®

1. **é‡æ–°æµ‹è¯• AI ç”Ÿæˆ**
   - Consoleåº”è¯¥æ˜¾ç¤ºå®Œæ•´çš„ç¤ºä¾‹å¡è¡¨æ ¼
   - AI åº”è¯¥è¿”å›æ­£ç¡®æ ¼å¼çš„ JSON

2. **æ£€æŸ¥ Console è¾“å‡º**
   ```
   ğŸ“š æŠ€èƒ½å¡åº“åŠ è½½å®Œæˆ:
     - æ€»å¡æ•°: 40
     - æŒ‰ç¨€æœ‰åº¦: SSR=10, SR=10, R=10, N=10

   ğŸ“Š [ä¸»ç¤ºä¾‹] æŠ½å– 6 å¼  SSR å¡ä½œä¸ºè®¾è®¡å‚è€ƒ
   ğŸ“Š [å¼ºåº¦ä¸‹é™] æŠ½å– 2 å¼  SR å¡æé†’è®¾è®¡å¼ºåº¦ä¸‹é™
   ğŸ“Š [å¼ºåº¦ä¸Šé™] æŠ½å– 2 å¼  UR å¡æé†’è®¾è®¡å¼ºåº¦ä¸Šé™
   ```

3. **éªŒè¯ç”Ÿæˆçš„æŠ€èƒ½å¡**
   - åº”è¯¥åŒ…å« `name` (æ—¥æ–‡/ä¸­æ–‡)
   - åº”è¯¥åŒ…å« `effect_before` å’Œ `effect_after`
   - åº”è¯¥æ­£ç¡®ä¿å­˜åˆ° `localStorage`


