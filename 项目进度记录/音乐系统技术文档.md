# 音乐系统技术文档

## 快速维护指南

### 添加新歌曲

#### 1. 准备音频文件
```bash
# 如果是日语歌名，先转换为罗马音
# 例如: 夢の種.mp3 → Yume.no.Tane.mp3
```

#### 2. 上传到对应的 GitHub Release
- 个人曲 → `personal-songs-v1.0`
- 组合曲 → `group-songs-v1.0`
- 全体曲 → `music-v1.0`

#### 3. 更新 `songs.ts`
```typescript
{
  id: 195, // 递增 ID
  title: '歌曲名（日语）',
  artist: '演唱者',
  voiceActor: '声优名',
  unit: '组合名',
  album: '专辑名',
  releaseDate: '2025/12/31',
  type: '个人曲', // 或 组合曲、全体曲
  lyrics: '作词者',
  music: '作曲者',
  audioUrl: `${AUDIO_BASE}/Romanized.Filename.mp3`,
  albumCover: `${ALBUM_COVER_BASE}/Album.Name.jpg`,
},
```

#### 4. 注意事项
- `audioUrl` 和 `albumCover` 的文件名**必须使用点号分隔**，不能有空格
- ID 不能重复
- 确保 Release 中的文件名与代码中的完全一致

---

### 添加新专辑封面

#### 1. 准备图片
- 格式: JPG
- 建议尺寸: 500x500 或更高
- 文件名: 使用点号分隔，如 `New.Album.Name.jpg`

#### 2. 上传到 GitHub Release
- Release tag: `歌曲图片`

#### 3. 更新 `songs.ts` 中对应歌曲的 `albumCover`
```typescript
albumCover: `${ALBUM_COVER_BASE}/New.Album.Name.jpg`
```

---

### 修改播放器功能

#### 播放模式相关
**位置**: `src/偶像大师闪耀色彩/music-player.ts`

```typescript
// 添加新的播放模式
export type PlaybackMode = 'single' | 'sequence' | 'random' | 'new-mode';

// 在 STATE.audio.addEventListener('ended', ...) 中添加逻辑
```

#### UI 控制相关
**位置**: `src/偶像大师闪耀色彩/app.vue`

```typescript
// 播放模式切换
const togglePlaybackMode = () => {
  // 添加新模式逻辑
};

// 上一曲/下一曲
const prevSong = () => { /* ... */ };
const nextSong = () => { /* ... */ };
```

---

### 修改 CDN 路径

**位置**: `src/偶像大师闪耀色彩/constants.ts`

```typescript
// 修改图片 CDN
export const ALBUM_COVER_BASE = 'https://新的CDN地址/歌曲图片';

// 修改音频 Release
export const AUDIO_BASE_PERSONAL = 'https://新的Release地址/personal-songs-v2.0';
```

---

### 样式修改

**位置**: `src/偶像大师闪耀色彩/app.vue` 的 `<style>` 部分

```scss
// 修改主题色
.music-player {
  background: linear-gradient(135deg, #新颜色1 0%, #新颜色2 100%);
}

// 修改播放器尺寸
.player-container {
  max-width: 新宽度;
}
```

---

## 常见问题排查

### 图片无法显示
1. 检查 Release 中文件是否存在
2. 检查文件名是否与代码中一致（**空格 vs 点号**）
3. 检查 `ALBUM_COVER_BASE` 路径是否正确
4. 打开浏览器开发者工具查看网络请求

### 音频无法播放
1. 检查 Release 中文件是否存在
2. 检查文件格式是否为浏览器支持的格式
3. 检查 `audioUrl` 路径是否正确
4. 查看浏览器控制台错误信息

### 搜索不工作
1. 检查 `filteredSongs` 计算属性逻辑
2. 确认搜索关键词是否正确绑定到 `searchQuery`
3. 查看控制台是否有 JavaScript 错误

---

## 代码规范

### 命名规范
- **文件名**: 使用点号分隔罗马音 (`Song.Name.mp3`)
- **变量名**: 驼峰命名 (`currentSongIndex`)
- **常量名**: 大写下划线 (`AUDIO_BASE_PERSONAL`)
- **组件名**: 帕斯卡命名 (`MusicPlayer`)

### TypeScript 类型
```typescript
// 始终为函数参数和返回值添加类型
function playSong(index: number): void {
  // ...
}

// 使用接口定义数据结构
interface Song {
  id: number;
  title: string;
  // ...
}
```

### 注释规范
```typescript
/**
 * 播放指定索引的歌曲
 * @param index - 歌曲在列表中的索引
 */
function playSong(index: number): void {
  // 实现代码
}
```

---

## 构建和部署

### 开发环境
```bash
# 安装依赖
pnpm install

# 开发模式（自动重载）
pnpm run dev

# 构建生产版本
pnpm run build
```

### 生产环境
```bash
# 构建
npm run build

# 输出位置
dist/偶像大师闪耀色彩/index.html
```

---

## 文件路径映射

### 资源路径结构
```
GitHub Release: 歌曲图片
├── COLORFUL.FE@THERS.-Stella-.jpg
├── BRILLI@NT.WING.01.Spread.the.Wings.jpg
├── BRILLI@NT.WING.02.jpg
└── ...

GitHub Release: personal-songs-v1.0
├── Arittake.no.Kagayaki.de.mp3
├── Hoshi.wo.Mezashite.mp3
└── ...

GitHub Release: group-songs-v1.0
├── Hikari.no.destination.mp3
├── Niji.ni.Nare.mp3
└── ...

GitHub Release: music-v1.0
├── Spread.the.Wings.flac
├── Multicolored.Sky.flac
└── ...
```

### 代码中的路径常量
```typescript
// constants.ts
ALBUM_COVER_BASE → Release: 歌曲图片
AUDIO_BASE_PERSONAL → Release: personal-songs-v1.0
AUDIO_BASE_GROUP → Release: group-songs-v1.0
AUDIO_BASE_ALL → Release: music-v1.0
```

---

## 性能监控

### 关键指标
- **首次加载时间**: < 3 秒
- **歌曲列表渲染**: < 100ms
- **搜索响应**: < 50ms
- **歌曲切换**: < 500ms

### 监控方法
```javascript
// 在浏览器控制台
console.time('songListRender');
// ... 渲染代码 ...
console.timeEnd('songListRender');
```

---

## 版本历史

### v1.0.0 (2025-10-28)
- ✅ 初始版本发布
- ✅ 194 首歌曲完整收录
- ✅ 3 种播放模式
- ✅ 搜索和筛选功能
- ✅ 响应式设计

---

## 备份和恢复

### 数据备份
定期备份以下文件：
1. `src/偶像大师闪耀色彩/songs.ts` - 歌曲数据
2. `src/偶像大师闪耀色彩/constants.ts` - 配置常量
3. GitHub Release 中的所有音频和图片文件

### 恢复步骤
1. 从备份恢复 `songs.ts` 和 `constants.ts`
2. 重新上传 Release 文件（如有丢失）
3. 运行 `npm run build` 重新构建

---

## 联系和支持

如有问题，请检查：
1. 本技术文档
2. 完整开发记录
3. 代码注释
4. Git 提交历史

---

**文档版本**: v1.0  
**最后更新**: 2025年10月28日




