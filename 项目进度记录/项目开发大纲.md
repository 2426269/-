# å¶åƒå¤§å¸ˆé—ªè€€è‰²å½© - é¡¹ç›®å¼€å‘å¤§çº²

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025-10-30  
**é¢„è®¡å®Œæˆæ—¶é—´**: 5-6ä¸ªæœˆï¼ˆåˆ†5ä¸ªPhaseï¼‰

---

## ğŸ“‹ ç›®å½•

1. [Phase 1: åŸºç¡€æ¶æ„](#phase-1-åŸºç¡€æ¶æ„å·²å®Œæˆ60)
2. [Phase 2: æ ¸å¿ƒç©æ³•](#phase-2-æ ¸å¿ƒç©æ³•æœªå¼€å§‹)
3. [Phase 3: AIå™äº‹é›†æˆ](#phase-3-aiå™äº‹é›†æˆæœªå¼€å§‹)
4. [Phase 4: å†…å®¹å¡«å……](#phase-4-å†…å®¹å¡«å……æœªå¼€å§‹)
5. [Phase 5: ä¼˜åŒ–ä¸å®Œå–„](#phase-5-ä¼˜åŒ–ä¸å®Œå–„æœªå¼€å§‹)

---

## Phase 1: åŸºç¡€æ¶æ„ï¼ˆå·²å®Œæˆ60%ï¼‰

**ç›®æ ‡**: å»ºç«‹é¡¹ç›®åŸºç¡€ï¼Œå®ç°ä¸»è¦çš„ç‹¬ç«‹ç³»ç»Ÿ  
**é¢„è®¡æ—¶é—´**: 4å‘¨  
**å½“å‰è¿›åº¦**: âœ… 3å‘¨ / ğŸŸ¡ 1å‘¨å¾…å®Œæˆ

### 1.1 é¡¹ç›®åˆå§‹åŒ– âœ…
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰

- [x] Vue + TypeScript + Webpacké…ç½®
- [x] é¡¹ç›®æ–‡ä»¶ç»“æ„è®¾è®¡
- [x] åŸºç¡€å¸¸é‡å®šä¹‰ï¼ˆCDNè·¯å¾„ã€æ¸¸æˆå¸¸æ•°ï¼‰
- [x] ç±»å‹å®šä¹‰ï¼ˆTypeScript .d.tsæ–‡ä»¶ï¼‰

**äº¤ä»˜ç‰©**:
- âœ… `webpack.config.js`
- âœ… `tsconfig.json`
- âœ… `@types/` æ–‡ä»¶å¤¹

---

### 1.2 ä¸»é¡µé¢ç³»ç»Ÿ ğŸŸ¡
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰

- [x] **åˆ¶ä½œäººä¿¡æ¯å±•ç¤º**
  - [x] åˆ¶ä½œäººç­‰çº§
  - [x] ç»éªŒå€¼è¿›åº¦æ¡
  - [x] è§’è‰²åç§°

- [x] **èµ„æºæ˜¾ç¤º**
  - [x] ç¾½çŸ³æ•°é‡
  - [x] ç²‰ä¸æ€»æ•°
  - [x] åŠ¨æ€æ›´æ–°

- [x] **åŠŸèƒ½å¯¼èˆª**
  - [x] æŠ½å¡æŒ‰é’®
  - [x] éŸ³ä¹æŒ‰é’®
  - [ ] âŒ åŸ¹è‚²æŒ‰é’®
  - [ ] âŒ å¶åƒåˆ—è¡¨æŒ‰é’®
  - [ ] âŒ å¥½æ„Ÿåº¦æŒ‰é’®

- [x] **è®¾ç½®ç³»ç»Ÿ**
  - [x] å…¨å±æ¨¡å¼åˆ‡æ¢ï¼ˆæŒ‰é’®/åŒå‡»ï¼‰
  - [x] å¼€å‘å·¥å…·é¢æ¿
  - [x] æ— é™ç¾½çŸ³å¼€å…³
  - [x] è§£é”å…¨è§’è‰²
  - [x] ç­‰çº§ç¬é—´æ»¡çº§

- [ ] **å¶åƒå±•ç¤º**
  - [ ] âŒ æ‹¥æœ‰çš„å¶åƒåˆ—è¡¨
  - [ ] âŒ å¶åƒå¡ç‰‡UI
  - [ ] âŒ å¥½æ„Ÿåº¦ç®€è¦æ˜¾ç¤º
  - [ ] âŒ ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…

**äº¤ä»˜ç‰©**:
- âœ… `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/app.vue`ï¼ˆä¸»ç•Œé¢ï¼‰
- âœ… `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/constants.ts`ï¼ˆå¸¸é‡ï¼‰
- âŒ `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/components/IdolList.vue`ï¼ˆå¾…å¼€å‘ï¼‰

---

### 1.3 æŠ½å¡ç³»ç»Ÿ âœ…
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰

- [x] **UIç•Œé¢**
  - [x] èµ„æºæ ï¼ˆç¾½çŸ³ã€æ˜Ÿå°˜ï¼‰
  - [x] å¡æ± é€‰æ‹©ä¾§è¾¹æ 
  - [x] å¡æ± é¢„è§ˆï¼ˆUPè§’è‰²å¡é¢å±•ç¤ºï¼‰
  - [x] å•æŠ½/åè¿æŒ‰é’®
  - [x] æŠ½å¡æ¦‚ç‡å¼¹çª—

- [x] **æ ¸å¿ƒé€»è¾‘**
  - [x] æ¦‚ç‡ç³»ç»Ÿï¼ˆUR 0.5%, SSR 5%, SR 16%, R 78.5%ï¼‰
  - [x] ä¿åº•æœºåˆ¶ï¼ˆSSR 90æŠ½ï¼ŒUR 200æŠ½ï¼‰
  - [x] æ˜Ÿå°˜è½¬æ¢ï¼ˆé‡å¤å¡ç‰Œï¼‰
  - [x] ç¾½çŸ³æ‰£é™¤

- [x] **æ•°æ®ç®¡ç†**
  - [x] 200å¼ çœŸå®è§’è‰²å¡æ•°æ®
  - [x] è§’è‰²è¡¨éªŒè¯ï¼ˆ125 SSR + 44 SR + 3 UR + 28 Rï¼‰
  - [x] æ‹¥æœ‰å¡ç‰Œè®°å½•ï¼ˆlocalStorageï¼‰
  - [x] æŠ½å¡å†å²è®°å½•

- [x] **ç»“æœå±•ç¤º**
  - [x] ç»“æœå¼¹çª—
  - [x] ç¨€æœ‰åº¦åŠ¨ç”»
  - [x] å¡ç‰Œè¯¦æƒ…å±•ç¤º
  - [x] æ–°å¡æ ‡è®°

**äº¤ä»˜ç‰©**:
- âœ… `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©-gacha/` å®Œæ•´æ–‡ä»¶å¤¹
- âœ… `data/real-cards.ts`ï¼ˆ200å¼ å¡ç‰‡æ•°æ®ï¼‰
- âœ… `gacha-core-real.ts`ï¼ˆæŠ½å¡æ ¸å¿ƒé€»è¾‘ï¼‰
- âœ… `components/` å®Œæ•´UIç»„ä»¶

---

### 1.4 éŸ³ä¹æ’­æ”¾ç³»ç»Ÿ âœ…
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰

- [x] **æ’­æ”¾å™¨æ ¸å¿ƒ**
  - [x] HTMLAudioElementå°è£…
  - [x] æ’­æ”¾/æš‚åœæ§åˆ¶
  - [x] éŸ³é‡æ§åˆ¶
  - [x] è¿›åº¦æ¡æ‹–åŠ¨
  - [x] æ’­æ”¾æ¨¡å¼ï¼ˆå•æ›²å¾ªç¯/é¡ºåº/éšæœºï¼‰

- [x] **æ­Œæ›²æ•°æ®**
  - [x] 194é¦–å®Œæ•´æ­Œæ›²æ•°æ®
  - [x] ä¸ªäººæ›²ï¼ˆ30é¦–ï¼‰
  - [x] ç»„åˆæ›²ï¼ˆ141é¦–ï¼‰
  - [x] å…¨ä½“æ›²ï¼ˆ23é¦–ï¼‰
  - [x] ä¸“è¾‘å°é¢URL
  - [x] éŸ³é¢‘æ–‡ä»¶URL

- [x] **UIç•Œé¢**
  - [x] ä¸“è¾‘å°é¢æ˜¾ç¤º
  - [x] æ­Œæ›²ä¿¡æ¯å±•ç¤º
  - [x] æ’­æ”¾æ§åˆ¶æŒ‰é’®
  - [x] è¿›åº¦æ¡
  - [x] æ­Œè¯æ»šåŠ¨ï¼ˆåŸæ–‡+ç¿»è¯‘ï¼‰

- [x] **é«˜çº§åŠŸèƒ½**
  - [x] è·¨æ ‡ç­¾é¡µåŒæ­¥ï¼ˆBroadcastChannelï¼‰
  - [x] çŠ¶æ€æŒä¹…åŒ–ï¼ˆlocalStorageï¼‰
  - [x] æ­Œè¯åŒæ­¥æ˜¾ç¤º

**äº¤ä»˜ç‰©**:
- âœ… `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/music-player.ts`
- âœ… `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/songs.ts`ï¼ˆ194é¦–æ­Œæ›²ï¼‰
- âœ… éŸ³ä¹UIï¼ˆåµŒå…¥`app.vue`ï¼‰

---

### 1.5 æ•°æ®æŒä¹…åŒ–ï¼ˆIndexedDB + localStorageï¼‰âœ…
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰

**æ ¸å¿ƒç†å¿µ**: IndexedDBæ˜¯**å”¯ä¸€çš„æ•°æ®æº**ï¼ˆSingle Source of Truthï¼‰ï¼Œå®Œå…¨ä¸ä¾èµ–SillyTavernçš„MVUæˆ–ä¸–ç•Œä¹¦ã€‚localStorageä»…ç”¨äºè½»é‡çº§é…ç½®ã€‚

#### IndexedDBæ¶æ„

- [x] **æ•°æ®åº“è®¾è®¡**
  ```typescript
  // æ•°æ®åº“å: ShinyColorsDB
  // ç‰ˆæœ¬: 1
  
  // ObjectStore 1: resourcesï¼ˆèµ„æºæ•°æ®ï¼‰
  {
    id: 'main',
    featherStones: 999999999,  // ç¾½çŸ³
    fans: 0,                    // ç²‰ä¸
    producerLevel: 1,           // åˆ¶ä½œäººç­‰çº§
    producerExp: 0              // ç»éªŒå€¼
  }
  
  // ObjectStore 2: gachaï¼ˆæŠ½å¡æ•°æ®ï¼‰
  {
    id: 'main',
    stardust: 0,                // æ˜Ÿå°˜
    ownedCards: {},             // æ‹¥æœ‰çš„å¡ç‰Œ
    pity: {
      totalPulls: 0,
      ssrPity: 0,
      urPity: 0
    },
    history: []                 // æŠ½å¡å†å²
  }
  
  // ObjectStore 3: affectionï¼ˆå¥½æ„Ÿåº¦æ•°æ®ï¼‰
  {
    idolId: 'mano',            // ä¸»é”®
    level: 0,                   // å¥½æ„Ÿåº¦ç­‰çº§ï¼ˆ0-1850ï¼‰
    stories: []                 // å·²è§£é”çš„å‰§æƒ…ID
  }
  
  // ObjectStore 4: produceï¼ˆåŸ¹è‚²æ•°æ®ï¼‰
  {
    id: string,                 // åŸ¹è‚²ä¼šè¯ID
    idolId: string,
    scenario: string,
    currentTurn: number,
    stats: { vo, da, vi, stamina },
    skillDeck: SkillCard[],
    pDrinks: PDrink[],
    history: []
  }
  
  // ObjectStore 5: skillCardsï¼ˆæŠ€èƒ½å¡æ•°æ®åº“ï¼‰
  {
    id: string,                 // å¡ç‰ŒID
    name: string,
    rarity: 'N' | 'R' | 'SR' | 'SSR',
    type: 'A' | 'M' | 'T',
    cost: number,
    effect: {...},
    source: 'ai' | 'official'   // AIç”Ÿæˆ æˆ– å®˜æ–¹æ•°æ®
  }
  
  // ObjectStore 6: storiesï¼ˆå‰§æƒ…è®°å½•ï¼‰
  {
    id: string,                 // å‰§æƒ…ID
    type: 'training' | 'activity' | 'affection' | 'ending',
    idolId: string,
    timestamp: number,
    content: string,            // AIç”Ÿæˆçš„å‰§æƒ…æ–‡æœ¬
    rewards: {...}
  }
  ```

- [x] **IndexedDBå°è£…**
  ```typescript
  // src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/db.ts
  class ShinyColorsDB {
    private db: IDBDatabase;
    
    async init(): Promise<void> {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open('ShinyColorsDB', 1);
        
        request.onupgradeneeded = (event) => {
          const db = (event.target as IDBOpenDBRequest).result;
          
          // åˆ›å»ºObjectStores
          if (!db.objectStoreNames.contains('resources')) {
            db.createObjectStore('resources', { keyPath: 'id' });
          }
          if (!db.objectStoreNames.contains('gacha')) {
            db.createObjectStore('gacha', { keyPath: 'id' });
          }
          if (!db.objectStoreNames.contains('affection')) {
            db.createObjectStore('affection', { keyPath: 'idolId' });
          }
          if (!db.objectStoreNames.contains('produce')) {
            db.createObjectStore('produce', { keyPath: 'id' });
          }
          if (!db.objectStoreNames.contains('skillCards')) {
            db.createObjectStore('skillCards', { keyPath: 'id' });
          }
          if (!db.objectStoreNames.contains('stories')) {
            db.createObjectStore('stories', { keyPath: 'id', autoIncrement: true });
          }
        };
        
        request.onsuccess = () => {
          this.db = request.result;
          resolve();
        };
        
        request.onerror = () => reject(request.error);
      });
    }
    
    // CRUDæ–¹æ³•
    async get(storeName: string, key: string): Promise<any> { /*...*/ }
    async put(storeName: string, data: any): Promise<void> { /*...*/ }
    async delete(storeName: string, key: string): Promise<void> { /*...*/ }
    async getAll(storeName: string): Promise<any[]> { /*...*/ }
  }
  
  // å…¨å±€å•ä¾‹
  export const db = new ShinyColorsDB();
  ```

- [x] **æ•°æ®è¿ç§»ï¼ˆä»localStorageåˆ°IndexedDBï¼‰**
  ```typescript
  // é¦–æ¬¡å¯åŠ¨æ—¶ï¼Œæ£€æŸ¥localStorageæ˜¯å¦æœ‰æ—§æ•°æ®
  async function migrateFromLocalStorage() {
    const oldData = localStorage.getItem('shinycolors_resources');
    if (oldData) {
      const data = JSON.parse(oldData);
      await db.put('resources', { id: 'main', ...data });
      localStorage.removeItem('shinycolors_resources');
    }
    // ... è¿ç§»å…¶ä»–æ•°æ®
  }
  ```

#### localStorageï¼ˆè½»é‡çº§é…ç½®ï¼‰

- [x] **ä»…ç”¨äºå¿«é€Ÿè®¿é—®çš„é…ç½®**
  ```typescript
  localStorage.setItem('shinycolors_settings', JSON.stringify({
    fullscreenMode: 'button',   // å…¨å±æ¨¡å¼
    volume: 0.7,                // éŸ³é‡
    devMode: {
      infiniteGems: false,
      maxFavorability: false
    }
  }));
  ```

#### å“åº”å¼æ•°æ®åŒæ­¥

- [x] **Vueå“åº”å¼æ•°æ®ä¸IndexedDBåŒæ­¥**
  ```typescript
  // ä½¿ç”¨watchEffectç›‘å¬Vueæ•°æ®å˜åŒ–ï¼Œè‡ªåŠ¨å†™å…¥IndexedDB
  import { watchEffect } from 'vue';
  import { klona } from 'klona';
  
  // èµ„æºæ•°æ®åŒæ­¥
  watchEffect(async () => {
    const data = klona(resources.value);  // å»é™¤proxy
    await db.put('resources', { id: 'main', ...data });
  });
  
  // æŠ½å¡æ•°æ®åŒæ­¥
  watchEffect(async () => {
    const data = klona(gachaData.value);
    await db.put('gacha', { id: 'main', ...data });
  });
  ```

**äº¤ä»˜ç‰©**:
- âœ… IndexedDBå°è£…ç±»ï¼ˆ`db.ts`ï¼‰
- âœ… æ•°æ®è¿ç§»è„šæœ¬
- âœ… å“åº”å¼æ•°æ®åŒæ­¥é€»è¾‘

**é‡è¦è¯´æ˜**: âŒ **ä¸å†ä½¿ç”¨MVUï¼ˆSillyTavernå˜é‡ç³»ç»Ÿï¼‰**ã€‚æ‰€æœ‰å˜é‡ï¼ˆåŒ…æ‹¬å¥½æ„Ÿåº¦ç­‰å™äº‹å˜é‡ï¼‰éƒ½å­˜å‚¨åœ¨IndexedDBä¸­ï¼Œå¹¶é€šè¿‡"æç¤ºè¯åŠ å·¥å‚"åŠ¨æ€æ’å…¥åˆ°æç¤ºè¯ä¸­ã€‚

---

### 1.6 iframeç›‘å¬ä¸æ‹¦æˆªç³»ç»Ÿ âŒ
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰+ åç«¯ï¼ˆSillyTavernï¼‰

**é‡è¦æ€§**: ğŸ”´ **æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ŒPhase 2å¿…é¡»å®Œæˆï¼**

**æ ¸å¿ƒç†å¿µ**: è¿™æ˜¯ä¸€ä¸ª**åŒå‘ç›‘å¬ä¸æ‹¦æˆªç³»ç»Ÿ**ï¼Œè´Ÿè´£ï¼š
1. ç›‘å¬Vueå‰ç«¯äº‹ä»¶ â†’ ç»„è£…æç¤ºè¯ â†’ å‘é€ç»™SillyTavern AI
2. æ‹¦æˆªSillyTavern AIå›å¤ â†’ è§£ææ•°æ® â†’ æ³¨å…¥åˆ°Vueå‰ç«¯ï¼ˆGalgameæ¨¡å¼ï¼‰
3. ç‰¹æ®Šå¤„ç†ï¼šæŠ€èƒ½å¡ç”Ÿæˆã€å‰§æƒ…ç”Ÿæˆã€æ•°æ®æŒä¹…åŒ–

#### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Vue å‰ç«¯ç•Œé¢                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ æŠ½å¡ç³»ç»Ÿ   â”‚  â”‚ åŸ¹è‚²ç³»ç»Ÿ   â”‚  â”‚ éŸ³ä¹æ’­æ”¾å™¨ â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚        â”‚               â”‚                                      â”‚
â”‚        â”‚    äº‹ä»¶è§¦å‘   â”‚                                      â”‚
â”‚        â–¼               â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   Communication Module (é€šä¿¡æ¨¡å—)      â”‚                 â”‚
â”‚  â”‚  Â· ç›‘å¬å‰ç«¯äº‹ä»¶                         â”‚                 â”‚
â”‚  â”‚  Â· ç»„è£…å®Œæ•´æç¤ºè¯ï¼ˆPromptFactoryï¼‰      â”‚                 â”‚
â”‚  â”‚  Â· å‘é€postMessage                      â”‚                 â”‚
â”‚  â”‚  Â· æ¥æ”¶AIå›å¤                           â”‚                 â”‚
â”‚  â”‚  Â· è§£ææ•°æ®å†™å…¥IndexedDB                â”‚                 â”‚
â”‚  â”‚  Â· æ³¨å…¥Galgameå‰§æƒ…ç•Œé¢                  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚              â”‚ postMessage                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ iframe boundary
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SillyTavern (Loader)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   idolmaster_loader.html                â”‚                 â”‚
â”‚  â”‚  Â· ç›‘å¬Vueçš„postMessage                 â”‚                 â”‚
â”‚  â”‚  Â· å‘é€æç¤ºè¯ç»™AI                       â”‚                 â”‚
â”‚  â”‚  Â· æ‹¦æˆªAIå›å¤ï¼ˆchat:receivedï¼‰          â”‚                 â”‚
â”‚  â”‚  Â· é™é»˜å¤„ç†ï¼ˆä¸æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢ï¼‰         â”‚                 â”‚
â”‚  â”‚  Â· è½¬å‘å›Vue                            â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚              â”‚                                                 â”‚
â”‚              â–¼                                                 â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚      â”‚   AI Model   â”‚                                         â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åŠŸèƒ½1: ç›‘å¬å‰ç«¯äº‹ä»¶å¹¶å‘é€AIè¯·æ±‚

**å‰ç«¯ç›‘å¬å™¨ï¼ˆVueï¼‰**

- [ ] **ç›‘å¬æŠ½å¡äº‹ä»¶ â†’ ç”ŸæˆæŠ€èƒ½å¡**
  ```typescript
  // src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/communication.ts
  import { db } from './db';
  import { PromptFactory } from './prompt-factory/PromptFactory';
  
  // ç›‘å¬æŠ½å¡äº‹ä»¶
  eventBus.on('CARD_PULLED', async (card: ProduceCard) => {
    if (!card.unique_skill) {
      // ç»„è£…æŠ€èƒ½å¡ç”Ÿæˆæç¤ºè¯
      const prompt = PromptFactory.assemblePrompt('GENERATE_SKILL', {
        persona: LORE[card.characterId],
        rarity: card.rarity,
        attribute: card.attribute,
        theme: card.theme
      });
      
      // å‘é€ç»™SillyTavern
      sendToSillyTavern({
        type: 'GENERATE_SKILL_CARD',
        payload: {
          prompt: prompt,
          cardId: card.id,
          bot_name: 'Card Generation Bot'
        }
      });
    }
  });
  ```

- [ ] **ç›‘å¬åŸ¹è‚²äº‹ä»¶ â†’ ç”Ÿæˆå‰§æƒ…**
  ```typescript
  // ç›‘å¬è®­ç»ƒå®Œæˆäº‹ä»¶
  eventBus.on('TRAINING_COMPLETE', async (result: TrainingResult) => {
    // ç»„è£…è®­ç»ƒåå‰§æƒ…æç¤ºè¯
    const bondLevel = await db.get('affection', result.idolId);
    const prompt = PromptFactory.assemblePrompt('TRAINING_STORY', {
      persona: LORE[result.idolId],
      lesson: result.type,
      result: result.evaluation,
      stat_gain: result.statGain,
      bond_level: bondLevel.level,
      bond_behavior: getBondBehavior(bondLevel.level)
    });
    
    // å‘é€ç»™SillyTavern
    sendToSillyTavern({
      type: 'GENERATE_STORY',
      payload: {
        prompt: prompt,
        storyType: 'training',
        metadata: {
          idolId: result.idolId,
          turn: result.currentTurn
        }
      }
    });
  });
  
  // ç›‘å¬è‡ªç”±æ´»åŠ¨äº‹ä»¶
  eventBus.on('FREE_ACTIVITY_START', async (data: ActivityData) => {
    const bondLevel = await db.get('affection', data.idolId);
    const prompt = PromptFactory.assemblePrompt('FREE_ACTIVITY', {
      persona: LORE[data.idolId],
      location_lore: LORE_LOCATIONS[data.locationId],
      bond_level: bondLevel.level,
      bond_behavior: getBondBehavior(bondLevel.level)
    });
    
    sendToSillyTavern({
      type: 'GENERATE_STORY',
      payload: {
        prompt: prompt,
        storyType: 'activity',
        metadata: {
          idolId: data.idolId,
          locationId: data.locationId
        }
      }
    });
  });
  ```

- [ ] **ç›‘å¬æ¯”èµ›ç»“æŸäº‹ä»¶ â†’ ç”Ÿæˆç»“å±€**
  ```typescript
  // ç›‘å¬æœ€ç»ˆæ¯”èµ›ç»“æŸ
  eventBus.on('FINAL_EXAM_COMPLETE', async (result: ExamResult) => {
    const bondLevel = await db.get('affection', result.idolId);
    const prompt = PromptFactory.assemblePrompt('ENDING_STORY', {
      persona: LORE[result.idolId],
      rank: result.rank,
      evaluation: result.grade,
      finalStats: result.finalStats,
      bond_level: bondLevel.level,
      bond_behavior: getBondBehavior(bondLevel.level)
    });
    
    sendToSillyTavern({
      type: 'GENERATE_STORY',
      payload: {
        prompt: prompt,
        storyType: 'ending',
        metadata: {
          idolId: result.idolId,
          produceId: result.produceId
        }
      }
    });
  });
  ```

#### åŠŸèƒ½2: æ‹¦æˆªAIå›å¤å¹¶å¤„ç†

**å‰ç«¯æ‹¦æˆªå™¨ï¼ˆVueï¼‰**

- [ ] **æ‹¦æˆªæŠ€èƒ½å¡ç”Ÿæˆç»“æœ â†’ å†™å…¥IndexedDB**
  ```typescript
  // ç›‘å¬SillyTavernçš„AIå›å¤
  window.addEventListener('message', async (event) => {
    if (event.data.type === 'AI_SKILL_CARD_RESPONSE') {
      const { cardId, skillData } = event.data.payload;
      
      try {
        // è§£æAIè¿”å›çš„JSON
        const skill = JSON.parse(skillData);
        
        // éªŒè¯æ•°æ®
        const validatedSkill = SkillCardSchema.parse(skill);
        
        // å†™å…¥IndexedDB
        await db.put('skillCards', {
          id: `skill_${cardId}`,
          ...validatedSkill,
          source: 'ai',
          timestamp: Date.now()
        });
        
        // æ›´æ–°På¡çš„æŠ€èƒ½å¼•ç”¨
        const card = await db.get('gacha', 'ownedCards');
        card.ownedCards[cardId].unique_skill_id = `skill_${cardId}`;
        await db.put('gacha', card);
        
        // æ˜¾ç¤ºæˆåŠŸæç¤º
        toastr.success(`âœ¨ ${skill.name} æŠ€èƒ½å¡ç”ŸæˆæˆåŠŸï¼`);
        
        // è§¦å‘UIæ›´æ–°
        eventBus.emit('SKILL_CARD_UPDATED', cardId);
      } catch (error) {
        console.error('æŠ€èƒ½å¡æ•°æ®è§£æå¤±è´¥:', error);
        toastr.error('æŠ€èƒ½å¡ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    }
  });
  ```

- [ ] **æ‹¦æˆªå‰§æƒ…ç”Ÿæˆç»“æœ â†’ æ³¨å…¥Galgameç•Œé¢**
  ```typescript
  window.addEventListener('message', async (event) => {
    if (event.data.type === 'AI_STORY_RESPONSE') {
      const { storyType, storyText, metadata } = event.data.payload;
      
      // è§£æå‰§æƒ…æ–‡æœ¬å’Œå¥–åŠ±
      const parsed = parseStoryText(storyText);
      
      // å†™å…¥IndexedDBï¼ˆå‰§æƒ…è®°å½•ï¼‰
      await db.put('stories', {
        type: storyType,
        idolId: metadata.idolId,
        timestamp: Date.now(),
        content: parsed.text,
        rewards: parsed.rewards
      });
      
      // æ³¨å…¥åˆ°Galgameå¯¹è¯ç•Œé¢
      await showGalDialogue({
        character: metadata.idolId,
        text: parsed.text,
        expression: parsed.expression || 'default',
        background: metadata.locationId || 'default'
      });
      
      // åº”ç”¨å¥–åŠ±
      if (parsed.rewards) {
        await applyRewards(parsed.rewards, metadata.idolId);
      }
      
      // ç»§ç»­æ¸¸æˆæµç¨‹
      eventBus.emit('STORY_COMPLETE', { storyType, metadata });
    }
  });
  ```

- [ ] **å‰§æƒ…æ–‡æœ¬è§£æå™¨**
  ```typescript
  interface ParsedStory {
    text: string;           // çº¯æ–‡æœ¬å‰§æƒ…
    expression?: string;    // è§’è‰²è¡¨æƒ…
    rewards?: {             // å¥–åŠ±æ•°æ®
      stamina?: number;
      love?: number;
      stats?: { vo?, da?, vi? };
    };
  }
  
  function parseStoryText(rawText: string): ParsedStory {
    // æå–<reward>æ ‡ç­¾
    const rewardMatch = rawText.match(/<reward>(.*?)<\/reward>/s);
    let rewards = null;
    if (rewardMatch) {
      try {
        rewards = JSON.parse(rewardMatch[1]);
      } catch (e) {
        console.warn('å¥–åŠ±æ•°æ®è§£æå¤±è´¥:', e);
      }
    }
    
    // æå–<expression>æ ‡ç­¾
    const expressionMatch = rawText.match(/<expression>(.*?)<\/expression>/);
    const expression = expressionMatch ? expressionMatch[1] : undefined;
    
    // å»é™¤æ‰€æœ‰æ ‡ç­¾ï¼Œä¿ç•™çº¯æ–‡æœ¬
    const text = rawText
      .replace(/<reward>.*?<\/reward>/s, '')
      .replace(/<expression>.*?<\/expression>/, '')
      .trim();
    
    return { text, expression, rewards };
  }
  ```

#### åŠŸèƒ½3: SillyTavernç«¯æ‹¦æˆªä¸è½¬å‘

**Loaderè„šæœ¬ï¼ˆSillyTavernï¼‰**

- [ ] **åˆ›å»ºloaderè„šæœ¬**
  ```html
  <!-- idolmaster_loader.html -->
  <div id="game-container">
    <iframe id="game-iframe" src="YOUR_DIST_URL/index.html"></iframe>
  </div>
  
  <script>
    const iframe = document.getElementById('game-iframe');
    let iframeWindow = null;
    let currentRequestType = null;
    let currentMetadata = null;
    
    // ç­‰å¾…iframeåŠ è½½å®Œæˆ
    iframe.addEventListener('load', () => {
      iframeWindow = iframe.contentWindow;
      console.log('[Loader] Vueå‰ç«¯å·²åŠ è½½');
    });
    
    // ç›‘å¬Vueå‘æ¥çš„æ¶ˆæ¯
    window.addEventListener('message', (event) => {
      if (event.source !== iframeWindow) return;
      
      const { type, payload } = event.data;
      
      switch (type) {
        case 'GENERATE_SKILL_CARD':
          currentRequestType = 'SKILL_CARD';
          currentMetadata = { cardId: payload.cardId };
          
          // åˆ‡æ¢åˆ°ä¸“ç”¨Bot
          if (payload.bot_name) {
            triggerSlash(`/switchchar ${payload.bot_name}`);
          }
          
          // å‘é€æç¤ºè¯ç»™AIï¼ˆé™é»˜æ¨¡å¼ï¼‰
          triggerSlash(`/send ${payload.prompt}`, true);
          break;
        
        case 'GENERATE_STORY':
          currentRequestType = 'STORY';
          currentMetadata = payload.metadata;
          
          // å‘é€æç¤ºè¯ç»™AIï¼ˆé™é»˜æ¨¡å¼ï¼‰
          triggerSlash(`/send ${payload.prompt}`, true);
          break;
      }
    });
    
    // æ‹¦æˆªAIå›å¤
    eventOn(tavern_events.MESSAGE_RECEIVED, (messageId) => {
      if (!currentRequestType || !iframeWindow) return;
      
      const message = SillyTavern.chat[messageId];
      const aiText = message.mes;
      
      // è½¬å‘å›Vue
      if (currentRequestType === 'SKILL_CARD') {
        iframeWindow.postMessage({
          type: 'AI_SKILL_CARD_RESPONSE',
          payload: {
            cardId: currentMetadata.cardId,
            skillData: aiText
          }
        }, '*');
      } else if (currentRequestType === 'STORY') {
        iframeWindow.postMessage({
          type: 'AI_STORY_RESPONSE',
          payload: {
            storyType: currentMetadata.storyType || 'generic',
            storyText: aiText,
            metadata: currentMetadata
          }
        }, '*');
      }
      
      // é™é»˜å¤„ç†ï¼ˆåˆ é™¤æ¶ˆæ¯ï¼Œä¸æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢ï¼‰
      SillyTavern.chat.splice(messageId, 1);
      SillyTavern.saveChatConditional();
      
      // é‡ç½®çŠ¶æ€
      currentRequestType = null;
      currentMetadata = null;
    });
  </script>
  ```

#### åŠŸèƒ½4: Galgameå‰§æƒ…ç•Œé¢

**Vueç»„ä»¶ï¼ˆGalgameå¯¹è¯æ¡†ï¼‰**

- [ ] **GalDialogue.vue**
  ```vue
  <template>
    <div class="gal-dialogue-overlay" v-if="isVisible">
      <!-- èƒŒæ™¯è™šåŒ– -->
      <div class="background" :style="{ backgroundImage: `url(${backgroundUrl})` }"></div>
      
      <!-- è§’è‰²ç«‹ç»˜ -->
      <div class="character-sprite">
        <img :src="characterImageUrl" :class="`expression-${expression}`" />
      </div>
      
      <!-- å¯¹è¯æ¡† -->
      <div class="dialogue-box">
        <div class="character-name">{{ characterName }}</div>
        <div class="dialogue-text" ref="textContainer">
          {{ displayedText }}
        </div>
        <div class="continue-hint" v-if="isTextComplete">â–¼ ç‚¹å‡»ç»§ç»­</div>
      </div>
    </div>
  </template>
  
  <script setup lang="ts">
  import { ref, onMounted } from 'vue';
  import gsap from 'gsap';
  
  const isVisible = ref(false);
  const displayedText = ref('');
  const isTextComplete = ref(false);
  
  // æ‰“å­—æœºæ•ˆæœ
  function typewriterEffect(fullText: string) {
    displayedText.value = '';
    isTextComplete.value = false;
    
    gsap.to(displayedText, {
      duration: fullText.length * 0.05,
      onUpdate: function() {
        const progress = this.progress();
        const length = Math.floor(fullText.length * progress);
        displayedText.value = fullText.substring(0, length);
      },
      onComplete: () => {
        isTextComplete.value = true;
      }
    });
  }
  
  // æš´éœ²ç»™å¤–éƒ¨è°ƒç”¨
  defineExpose({
    show(data: {
      character: string;
      text: string;
      expression?: string;
      background?: string;
    }) {
      isVisible.value = true;
      characterName.value = getCharacterName(data.character);
      characterImageUrl.value = getCharacterImageUrl(data.character, data.expression);
      backgroundUrl.value = getBackgroundUrl(data.background);
      expression.value = data.expression || 'default';
      
      typewriterEffect(data.text);
    },
    
    hide() {
      isVisible.value = false;
    }
  });
  </script>
  ```

#### æµ‹è¯•

- [ ] **é€šä¿¡æµ‹è¯•**
  - [ ] Vue â†’ ST æŠ€èƒ½å¡ç”Ÿæˆè¯·æ±‚
  - [ ] ST â†’ Vue æŠ€èƒ½å¡æ•°æ®è¿”å›
  - [ ] Vue â†’ ST å‰§æƒ…ç”Ÿæˆè¯·æ±‚
  - [ ] ST â†’ Vue å‰§æƒ…æ–‡æœ¬è¿”å›

- [ ] **æ•°æ®æŒä¹…åŒ–æµ‹è¯•**
  - [ ] æŠ€èƒ½å¡æ­£ç¡®å†™å…¥IndexedDB
  - [ ] å‰§æƒ…è®°å½•æ­£ç¡®å†™å…¥IndexedDB
  - [ ] å¥½æ„Ÿåº¦å˜åŒ–æ­£ç¡®æ›´æ–°

- [ ] **UIæµ‹è¯•**
  - [ ] Galgameå¯¹è¯æ¡†æ­£ç¡®æ˜¾ç¤º
  - [ ] æ‰“å­—æœºæ•ˆæœæµç•…
  - [ ] å¥–åŠ±æ­£ç¡®åº”ç”¨

**äº¤ä»˜ç‰©**:
- âŒ `idolmaster_loader.html`ï¼ˆSillyTavernç«¯ï¼‰
- âŒ `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/communication.ts`ï¼ˆé€šä¿¡æ¨¡å—ï¼‰
- âŒ `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/components/GalDialogue.vue`ï¼ˆGalgameå¯¹è¯æ¡†ï¼‰
- âŒ `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/story-parser.ts`ï¼ˆå‰§æƒ…è§£æå™¨ï¼‰
- âŒ é€šä¿¡åè®®æ–‡æ¡£

**æ ¸å¿ƒä¼˜åŠ¿**:
âœ… **è‡ªåŠ¨åŒ–æµç¨‹**ï¼šæŠ½å¡ â†’ ç”ŸæˆæŠ€èƒ½å¡ â†’ å†™å…¥æ•°æ®åº“ï¼Œå…¨è‡ªåŠ¨  
âœ… **æ²‰æµ¸å¼ä½“éªŒ**ï¼šæ‰€æœ‰å‰§æƒ…ä»¥Galgameå½¢å¼å±•ç°ï¼Œè€Œä¸æ˜¯èŠå¤©æ°”æ³¡  
âœ… **æ•°æ®æŒä¹…åŒ–**ï¼šæ‰€æœ‰AIç”Ÿæˆå†…å®¹éƒ½ä¿å­˜åœ¨IndexedDBï¼Œå¯å›æ”¾  
âœ… **å®Œå…¨é™é»˜**ï¼šç”¨æˆ·çœ‹ä¸åˆ°SillyTavernçš„èŠå¤©ç•Œé¢ï¼Œåªçœ‹åˆ°æ¸¸æˆå‰ç«¯

---

## Phase 2: æ ¸å¿ƒç©æ³•ï¼ˆæœªå¼€å§‹ï¼‰

**ç›®æ ‡**: å®ç°æ¸¸æˆçš„æ ¸å¿ƒæœºåˆ¶â€”â€”æç¤ºè¯åŠ å·¥å‚ã€æ‰“ç‰Œå’ŒåŸ¹è‚²  
**é¢„è®¡æ—¶é—´**: 8-10å‘¨  
**å‰ç½®æ¡ä»¶**: Phase 1å®Œæˆï¼Œå°¤å…¶æ˜¯iframeé€šä¿¡ç³»ç»Ÿ

### 2.0 æç¤ºè¯åŠ å·¥å‚ç³»ç»Ÿ âŒ
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰

**æ ¸å¿ƒç†å¿µ**: è¿™æ˜¯æ¸¸æˆçš„"å¤§è„‘"å’Œ"é¦–å¸­ç¼–å‰§"ã€‚Vueåº”ç”¨åŒ…å«ä¸€ä¸ªå®Œæ•´çš„"æç¤ºè¯å·¥ç¨‹æ¶æ„"ï¼Œè´Ÿè´£æ ¹æ®æ¸¸æˆçŠ¶æ€åŠ¨æ€ç»„è£…é«˜è´¨é‡æç¤ºè¯ï¼Œè€Œä¸æ˜¯ä¾èµ–SillyTavernçš„é™æ€ä¸–ç•Œä¹¦ã€‚

#### ä¸–ç•Œä¹¦åŒºï¼ˆLore Databaseï¼‰

è¿™æ˜¯æ•°æ®å±‚ï¼Œå­˜å‚¨æ‰€æœ‰æ¨¡å—åŒ–çš„å†…å®¹ï¼š

- [ ] **è§’è‰²äººè®¾æ¨¡å—**
  ```typescript
  // lore/characters/*.ts
  export const LORE_MANO = `æ¨±æœ¨çœŸä¹ƒæ˜¯...`;
  export const LORE_HIORI = `é£é‡ç¯ç»‡æ˜¯...`;
  // ... 28ä¸ªå¶åƒ
  ```

- [ ] **å¡ç‰Œæœºåˆ¶æ¨¡å—**
  ```typescript
  // lore/card-mechanics/*.ts
  export const MECHANIC_VOCAL = `Vocalå¡ç‰Œï¼š...`;
  export const MECHANIC_DANCE = `Danceå¡ç‰Œï¼š...`;
  export const MECHANIC_VISUAL = `Visualå¡ç‰Œï¼š...`;
  ```

- [ ] **å¡ç‰Œç¤ºä¾‹æ¨¡å—ï¼ˆæŒ‰ç¨€æœ‰åº¦ï¼‰**
  ```typescript
  // lore/card-examples/*.ts
  export const EXAMPLE_R_VOCAL = `{ç¤ºä¾‹Rå¡}`;
  export const EXAMPLE_SR_VOCAL = `{ç¤ºä¾‹SRå¡}`;
  export const EXAMPLE_SSR_VOCAL = `{ç¤ºä¾‹SSRå¡}`;
  export const EXAMPLE_UR_VOCAL = `{ç¤ºä¾‹URå¡}`;
  ```

- [ ] **å¥½æ„Ÿåº¦è¡¨ç°æ¨¡å—ï¼ˆ1-10çº§ï¼‰**
  ```typescript
  // lore/affection-behaviors/*.ts
  export const BOND_LVL_1 = `[AIè¡¨ç°ï¼šç¤¼è²Œã€ç–è¿œã€ç§°å‘¼"åˆ¶ä½œäºº"]`;
  export const BOND_LVL_5 = `[AIè¡¨ç°ï¼šç†Ÿæ‚‰ã€å‹å¥½ã€ç§°å‘¼"åˆ¶ä½œäººå…ˆç”Ÿ"]`;
  export const BOND_LVL_10 = `[AIè¡¨ç°ï¼šäº²å¯†ã€ä¾èµ–ã€ç§°å‘¼"P-chan"ï¼Œä¼šæ’’å¨‡]`;
  ```

- [ ] **åœ°ç‚¹æ¨¡å—**
  ```typescript
  // lore/locations/*.ts
  export const LORE_BEACH = `[åœ°ç‚¹ï¼šæµ·æ»©ã€‚æè¿°ï¼š...]`;
  export const LORE_CAFE = `[åœ°ç‚¹ï¼šå’–å•¡å…ã€‚æ°›å›´ï¼š...]`;
  export const LORE_LIBRARY = `[åœ°ç‚¹ï¼šå›¾ä¹¦é¦†ã€‚...]`;
  // ... æ›´å¤šåœ°ç‚¹
  ```

- [ ] **å‰§æƒ…ä¸»é¢˜æ¨¡å—**
  ```typescript
  // lore/themes/*.ts
  export const THEME_SUMMER = `[ä¸»é¢˜ï¼šå¤æ—¥ã€‚å…³é”®è¯ï¼šæµ·è¾¹ã€é˜³å…‰ã€æ¸…å‡‰...]`;
  export const THEME_WINTER = `[ä¸»é¢˜ï¼šå†¬å­£ã€‚å…³é”®è¯ï¼šé›ªã€æ¸©æš–ã€åœ£è¯...]`;
  ```

#### æç¤ºè¯åŠ å·¥å‚ï¼ˆPrompt Factoryï¼‰

è¿™æ˜¯é€»è¾‘å±‚ï¼ŒåŒ…å«å„ç§"å¸¦ç•™ç™½çš„æç¤ºè¯æ¨¡æ¿"ï¼š

- [ ] **PromptFactory.tsæ ¸å¿ƒæ¨¡å—**
  ```typescript
  // prompt-factory/PromptFactory.ts
  export class PromptFactory {
    // ä»localStorageè¯»å–å½“å‰çŠ¶æ€
    private getGameState() {
      return {
        bondLevel: localStorage.getItem('current_bond_level'),
        scenario: localStorage.getItem('current_scenario'),
        turn: localStorage.getItem('current_turn'),
        // ...
      };
    }
    
    // æ ¹æ®è¯·æ±‚ç±»å‹ï¼Œé€‰æ‹©æ¨¡æ¿å¹¶å¡«å……
    public assemblePrompt(type: PromptType, params: any): string {
      const state = this.getGameState();
      
      switch(type) {
        case 'GENERATE_SKILL':
          return this.assembleSkillPrompt(params, state);
        case 'FREE_ACTIVITY':
          return this.assembleActivityPrompt(params, state);
        case 'TRAINING_STORY':
          return this.assembleTrainingPrompt(params, state);
        // ...
      }
    }
  }
  ```

- [ ] **å†™å¡æç¤ºè¯æ¨¡æ¿**
  ```typescript
  // prompt-factory/templates/card-generation.ts
  export const CARD_GENERATION_TEMPLATE = `
  [System: ä½ çš„ä»»åŠ¡æ˜¯è®¾è®¡å¡ç‰Œæ¸¸æˆæŠ€èƒ½ã€‚
  
  ã€è§’è‰²äººè®¾ã€‘ï¼š\${persona}
  ã€å¹³è¡¡è§„åˆ™ã€‘ï¼š\${mechanics}
  ã€å¼ºåº¦ç¤ºä¾‹ï¼ˆRï¼‰ã€‘ï¼š\${example_r}
  ã€å¼ºåº¦ç¤ºä¾‹ï¼ˆSRï¼‰ã€‘ï¼š\${example_sr}
  ã€å¼ºåº¦ç¤ºä¾‹ï¼ˆSSRï¼‰ã€‘ï¼š\${example_ssr}
  ã€å¼ºåº¦ç¤ºä¾‹ï¼ˆURï¼‰ã€‘ï¼š\${example_ur}
  
  ã€ä½ çš„ä»»åŠ¡ã€‘ï¼šè¯·ä¸º [ç¨€æœ‰åº¦:\${rarity}, å±æ€§:\${attribute}, ä¸»é¢˜:\${theme}] è®¾è®¡ä¸€å¼ æ–°å¡ã€‚
  ã€è¾“å‡ºæ ¼å¼ã€‘ï¼šä¸¥æ ¼éµå®ˆJSONæ ¼å¼...
  ]`;
  ```

- [ ] **è‡ªç”±æ´»åŠ¨æç¤ºè¯æ¨¡æ¿**
  ```typescript
  // prompt-factory/templates/free-activity.ts
  export const ACTIVITY_TEMPLATE = `
  [System: è¿™æ˜¯ä¸€æ®µè§’è‰²æ‰®æ¼”å‰§æƒ…ã€‚
  
  ã€è§’è‰²äººè®¾ã€‘ï¼š\${persona}
  ã€åœ°ç‚¹æè¿°ã€‘ï¼š\${location_lore}
  ã€å¥½æ„Ÿåº¦ç­‰çº§ã€‘ï¼š\${bond_level}
  ã€AIè¡¨ç°æŒ‡å¯¼ã€‘ï¼š\${bond_behavior}
  ã€å½“å‰å›åˆã€‘ï¼š\${turn} / \${max_turns}
  
  ã€ä½ çš„ä»»åŠ¡ã€‘ï¼šæ ¹æ®ä»¥ä¸Šæƒ…æ™¯ï¼Œç”Ÿæˆä¸€æ®µç®€çŸ­å¯¹è¯ï¼ˆ100å­—å†…ï¼‰ã€‚
  ã€å¥–åŠ±æ ¼å¼ã€‘ï¼šæœ€åé™„ä¸Š <reward>{ "stamina": æ•°å­—, "love": æ•°å­— }</reward>
  ]`;
  ```

- [ ] **è®­ç»ƒåå‰§æƒ…æ¨¡æ¿**
  ```typescript
  // prompt-factory/templates/training-story.ts
  export const TRAINING_STORY_TEMPLATE = `
  [System: è®­ç»ƒåå‰§æƒ…ç”Ÿæˆã€‚
  
  ã€è§’è‰²äººè®¾ã€‘ï¼š\${persona}
  ã€è®­ç»ƒç±»å‹ã€‘ï¼š\${lesson_type}ï¼ˆVocal/Dance/Visualï¼‰
  ã€è®­ç»ƒç»“æœã€‘ï¼š\${result}ï¼ˆå¤§æˆåŠŸ/æˆåŠŸ/å¤±è´¥ï¼‰
  ã€å±æ€§å¢é•¿ã€‘ï¼š\${stat_gain}
  ã€å¥½æ„Ÿåº¦ã€‘ï¼š\${bond_level}
  ã€AIè¡¨ç°ã€‘ï¼š\${bond_behavior}
  
  ã€ä½ çš„ä»»åŠ¡ã€‘ï¼šç”Ÿæˆ50å­—å†…çš„ç®€çŸ­ååº”ï¼Œè¡¨ç°å¶åƒå¯¹è¿™æ¬¡è®­ç»ƒçš„æ€åº¦ã€‚
  ]`;
  ```

- [ ] **WINGç»“å±€å‰§æƒ…æ¨¡æ¿**
  ```typescript
  // prompt-factory/templates/scenario-ending.ts
  export const WING_ENDING_TEMPLATE = `
  [System: WINGå‰§æœ¬ç»“å±€ç”Ÿæˆã€‚
  
  ã€è§’è‰²äººè®¾ã€‘ï¼š\${persona}
  ã€æ¯”èµ›åæ¬¡ã€‘ï¼š\${rank}
  ã€æœ€ç»ˆè¯„ä»·ã€‘ï¼š\${evaluation}ï¼ˆS/A/B/Cï¼‰
  ã€æœ€ç»ˆä¸‰ç»´ã€‘ï¼šVo:\${vo}, Da:\${da}, Vi:\${vi}
  ã€å¥½æ„Ÿåº¦ã€‘ï¼š\${bond_level}
  ã€AIè¡¨ç°ã€‘ï¼š\${bond_behavior}
  
  ã€ä½ çš„ä»»åŠ¡ã€‘ï¼šç”Ÿæˆ200å­—å·¦å³çš„æ„Ÿäººç»“å±€å‰§æƒ…ï¼Œè¡¨ç°å¶åƒçš„æˆé•¿å’Œå¯¹åˆ¶ä½œäººçš„æ„Ÿæ¿€ã€‚
  ]`;
  ```

#### é›†æˆç¤ºä¾‹

- [ ] **å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹**
  ```typescript
  // ç¤ºä¾‹ï¼šç©å®¶ç‚¹å‡»"è‡ªç”±æ´»åŠ¨ - æµ·æ»©"
  async function handleFreeActivity(location: 'beach') {
    // 1. ä»localStorageè¯»å–çŠ¶æ€
    const bondLevel = localStorage.getItem('mano_bond'); // 15
    const currentTurn = localStorage.getItem('current_turn'); // 10
    
    // 2. ä»ä¸–ç•Œä¹¦åŒºè¯»å–æ¨¡å—
    const persona = LORE_MANO;
    const locationLore = LORE_BEACH;
    const bondBehavior = getBondBehavior(bondLevel); // è‡ªåŠ¨åŒ¹é… BOND_LVL_10
    
    // 3. ä½¿ç”¨PromptFactoryç»„è£…
    const factory = new PromptFactory();
    const fullPrompt = factory.assemblePrompt('FREE_ACTIVITY', {
      persona,
      location_lore: locationLore,
      bond_level: bondLevel,
      bond_behavior: bondBehavior,
      turn: currentTurn,
      max_turns: 30
    });
    
    // 4. å‘é€ç»™SillyTavern
    postMessage({
      type: 'SEND_PROMPT',
      payload: { full_prompt: fullPrompt }
    });
    
    // 5. æ¥æ”¶AIå›å¤
    // ... è§£æ <reward> æ ‡ç­¾ï¼Œæ›´æ–°localStorage
  }
  ```

#### ä¼˜åŠ¿æ€»ç»“

âœ… **é›¶è®¾ç½®/æ˜“åˆ†å‘**ï¼šç”¨æˆ·åªéœ€å¯¼å…¥ä¸€ä¸ªHTMLï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®ä¸–ç•Œä¹¦  
âœ… **åŠ¨æ€æç¤ºè¯**ï¼šæ ¹æ®æ¸¸æˆçŠ¶æ€æ™ºèƒ½ç»„è£…ï¼Œè€Œä¸æ˜¯é™æ€è§¦å‘  
âœ… **å¥½æ„Ÿåº¦å˜"é²œæ´»"**ï¼šæ¯æ¬¡AIäº¤äº’éƒ½èƒ½ä½“ç°å¥½æ„Ÿåº¦å˜åŒ–ï¼Œè€Œä¸æ˜¯åªåœ¨ç‰¹æ®Šå‰§æƒ…é‡Œ  
âœ… **Tokené«˜æ•ˆ**ï¼šæ¯æ¬¡éƒ½æ˜¯"ä¸€æ¬¡æ€§"ä¸Šä¸‹æ–‡ï¼Œä¸ä¼šç§¯ç´¯æ— ç”¨èŠå¤©è®°å½•  
âœ… **é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰"å¤§è„‘"éƒ½åœ¨ä¸€ä¸ªä»“åº“ï¼Œæ˜“äºç»´æŠ¤å’Œæ›´æ–°

**äº¤ä»˜ç‰©**:
- âŒ `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/lore/`ï¼ˆä¸–ç•Œä¹¦åŒºæ–‡ä»¶å¤¹ï¼‰
- âŒ `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©/prompt-factory/`ï¼ˆæç¤ºè¯å·¥å‚æ–‡ä»¶å¤¹ï¼‰
- âŒ `PromptFactory.ts`ï¼ˆæ ¸å¿ƒå·¥å‚ç±»ï¼‰
- âŒ å„ç±»æç¤ºè¯æ¨¡æ¿æ–‡ä»¶

---

### 2.1 å¡ç‰Œæˆ˜æ–—ç³»ç»Ÿï¼ˆå­¦å›­å¶åƒå¤§å¸ˆå¼ï¼‰âŒ
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰

**æ ¸å¿ƒç†å¿µ**: å‚è€ƒå­¦å›­å¶åƒå¤§å¸ˆçš„æ‰“ç‰Œæœºåˆ¶ï¼Œç»“åˆé—ªè€€è‰²å½©çš„è§’è‰²æ•°æ®ã€‚è¯¦ç»†æœºåˆ¶è§ `E:\å¶åƒå¤§å¸ˆ\é—ªè€€è‰²å½©å¡ç‰Œæœºåˆ¶è¯´æ˜.txt`

#### UIç»„ä»¶

- [ ] **CardGame.vueï¼ˆä¸»ç•Œé¢ï¼‰**
  - [ ] å·¦ä¾§buffæ ï¼ˆæ˜¾ç¤ºæ‰€æœ‰æ­£é¢/è´Ÿé¢æ•ˆæœï¼‰
  - [ ] ä¸­å¤®æˆ˜åœºï¼ˆæ‰‹ç‰ŒåŒºã€ç‰Œå †ã€å¼ƒç‰Œå †ã€é™¤å¤–å †ï¼‰
  - [ ] å³ä¾§ä¿¡æ¯æ ï¼ˆä½“åŠ›ã€å…ƒæ°”ã€ç›®æ ‡å¾—åˆ†ã€å½“å‰å¾—åˆ†ï¼‰
  - [ ] å›åˆæŒ‡ç¤ºå™¨ï¼ˆå½“å‰å›åˆ/æ€»å›åˆæ•°ï¼‰
  - [ ] è·³è¿‡å‡ºç‰ŒæŒ‰é’®ï¼ˆå›å¤2ç‚¹ä½“åŠ›ï¼‰

- [ ] **SkillCard.vueï¼ˆæŠ€èƒ½å¡ç»„ä»¶ï¼‰**
  - [ ] å¡ç‰Œå¤–æ¡†ï¼ˆAç±»å…­è¾¹å½¢/Mç±»åœ†å½¢/Tç±»æ–¹å½¢ï¼‰
  - [ ] å¡ç‰Œæ¨¡æ¿ï¼ˆCostã€åç§°ã€æ•ˆæœæè¿°ï¼‰
  - [ ] ç¨€æœ‰åº¦æ ‡è¯†ï¼ˆN/R/SR/SSRï¼‰
  - [ ] å¼ºåŒ–æ ‡è®°ï¼ˆ"+"ï¼‰
  - [ ] å¡ç‰Œæ‹–æ‹½/ç‚¹å‡»ä½¿ç”¨
  - [ ] å¡ç‰ŒåŠ¨ç”»ï¼ˆæ‰“å‡ºã€å¼ƒç‰Œã€é™¤å¤–ï¼‰
  - [ ] ä½“åŠ›æ¶ˆè´¹å›¾æ ‡ï¼ˆç»¿è‰²/çº¢è‰²ï¼‰

- [ ] **BuffBar.vueï¼ˆbuffæ ç»„ä»¶ï¼‰**
  - [ ] buffå›¾æ ‡ï¼ˆä»GitåŠ è½½ï¼‰
  - [ ] buffå±‚æ•°æ˜¾ç¤º
  - [ ] buffå‰©ä½™å›åˆæ•°
  - [ ] buffæ‚¬åœæç¤ºï¼ˆæ˜¾ç¤ºè¯¦ç»†æ•ˆæœï¼‰
  - [ ] buffåŠ¨ç”»ï¼ˆè·å¾—/æ¶ˆå¤±ï¼‰

- [ ] **StatsBar.vueï¼ˆçŠ¶æ€æ ï¼‰**
  - [ ] ä½“åŠ›å€¼è¿›åº¦æ¡ï¼ˆå½“å‰/ä¸Šé™ï¼‰
  - [ ] å…ƒæ°”å€¼æ˜¾ç¤º
  - [ ] ç›®æ ‡å¾—åˆ†æ˜¾ç¤º
  - [ ] å½“å‰å¾—åˆ†æ˜¾ç¤ºï¼ˆå®æ—¶æ›´æ–°ï¼‰
  - [ ] å®Œæˆç¨‹åº¦ï¼ˆClear/Perfectï¼‰

- [ ] **SupportEffect.vueï¼ˆåº”æ´æ•ˆæœï¼‰**
  - [ ] åº”æ´æ•ˆæœæè¿°
  - [ ] å€’è®¡æ—¶ï¼ˆæŒ‡å®šå›åˆæ•°ï¼‰
  - [ ] è¾¾æˆ/æœªè¾¾æˆå¥–åŠ±é¢„è§ˆ

#### æ ¸å¿ƒé€»è¾‘

- [ ] **æŠ€èƒ½å¡æ•°æ®ç»“æ„**
  ```typescript
  interface SkillCard {
    id: string;
    name: string;
    rarity: 'N' | 'R' | 'SR' | 'SSR';
    type: 'A' | 'M' | 'T';  // Active/Mental/Trap
    cost: number;           // ä½“åŠ›æ¶ˆè€—ï¼ˆ1-6ï¼‰
    costType: 'normal' | 'stamina_only';  // ç»¿è‰²å›¾æ ‡/çº¢è‰²å›¾æ ‡
    unique: boolean;        // æ˜¯å¦"é‡å¤ä¸å¯"
    enhanced: boolean;      // æ˜¯å¦å·²å¼ºåŒ–
    effect: {
      // å¾—åˆ†ç›¸å…³
      score?: {
        attribute: 'vocal' | 'dance' | 'visual';
        multiplier: number;  // åˆ†æ•°å€ç‡ï¼ˆå¦‚3.0è¡¨ç¤º [Vocal] Ã— 3.0ï¼‰
      };
      
      // å…ƒæ°”ç›¸å…³
      stamina?: number;       // å›å¤ä½“åŠ›
      genki?: number;         // è·å¾—å…ƒæ°”
      
      // buffç›¸å…³
      addBuff?: {
        type: string;         // buffç±»å‹ï¼ˆå¦‚"å¥½èª¿"ã€"é›†ä¸­"ï¼‰
        stacks: number;       // å±‚æ•°
      }[];
      
      // å…¶ä»–æ•ˆæœ
      draw?: number;          // æŠ½ç‰Œæ•°
      extraTurn?: number;     // é¢å¤–å›åˆæ•°
      extraUse?: number;      // æŠ€èƒ½å¡ä½¿ç”¨æ•°è¿½åŠ 
      // ... æ›´å¤šæ•ˆæœ
    };
    description: string;      // æ•ˆæœæè¿°
  }
  ```

- [ ] **æ‰“ç‰Œè§„åˆ™ï¼ˆè®­ç»ƒæ¨¡å¼ï¼‰**
  - [ ] ç›®æ ‡å¾—åˆ†ç³»ç»Ÿï¼ˆClear = 1x, Perfect = 2xï¼‰
  - [ ] å›åˆåˆ¶ï¼ˆæ¯å›åˆé»˜è®¤æŠ½3å¼ æ‰‹ç‰Œï¼‰
  - [ ] ä½“åŠ›/å…ƒæ°”ç³»ç»Ÿï¼ˆå…ƒæ°”ä¼˜å…ˆæ¶ˆè€—ï¼‰
  - [ ] æ‰‹ç‰Œä¸Šé™ï¼ˆæœ€å¤š5å¼ ï¼‰
  - [ ] å‡ºç‰Œæ¬¡æ•°ï¼ˆé»˜è®¤æ¯å›åˆ1æ¬¡ï¼Œå¯é€šè¿‡buffå¢åŠ ï¼‰
  - [ ] è·³è¿‡å‡ºç‰Œï¼ˆå›å¤2ç‚¹ä½“åŠ›ï¼‰
  - [ ] å¼ƒç‰Œå †é‡ç»„ï¼ˆç‰Œå †ä¸è¶³æ—¶æ´—ç‰Œï¼‰
  - [ ] åº”æ´æ•ˆæœï¼ˆç‰¹å®šå›åˆå†…è¾¾æˆè¦æ±‚ï¼‰

- [ ] **æ‰“ç‰Œè§„åˆ™ï¼ˆæ¯”èµ›æ¨¡å¼ï¼‰**
  - [ ] å±æ€§å›åˆç³»ç»Ÿï¼ˆæ ¹æ®å®¡æŸ¥åŸºå‡†åˆ†é…Vo/Da/Viå›åˆï¼‰
  - [ ] åˆ†æ•°åŠ æˆå€ç‡ï¼ˆå±æ€§å€¼è¶Šé«˜ï¼Œå€ç‡è¶Šé«˜ï¼‰
  - [ ] æœ€åä¸‰å›åˆå±æ€§å›ºå®šï¼ˆæŒ‰å®¡æŸ¥åŸºå‡†é«˜ä½æ’åºï¼‰
  - [ ] æ— å¾—åˆ†ä¸Šé™ï¼ˆä¸­é—´æ¯”èµ›é™¤å¤–ï¼‰
  - [ ] æ’åç³»ç»Ÿï¼ˆæ ¹æ®å¾—åˆ†è®¡ç®—åæ¬¡ï¼‰

- [ ] **åŸ¹è‚²è®¡åˆ’æœºåˆ¶**
  - [ ] **æ„Ÿæ€§ï¼ˆã‚»ãƒ³ã‚¹ï¼‰**
    - [ ] "å¥½èª¿"æ•ˆæœï¼ˆå¾—åˆ†+50%ï¼‰
    - [ ] "é›†ä¸­"æ•ˆæœï¼ˆæ¯å±‚+Nç‚¹å¾—åˆ†ï¼‰
    - [ ] "çµ¶å¥½èª¿"æ•ˆæœï¼ˆå¼ºåŒ–"å¥½èª¿"ï¼‰
  
  - [ ] **ç†æ€§ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ï¼‰**
    - [ ] "å¥½å°è±¡"æ•ˆæœï¼ˆå›åˆç»“æŸç›´æ¥å¾—åˆ†ï¼‰
    - [ ] "æœ‰å¹²åŠ²"æ•ˆæœï¼ˆå…ƒæ°”è·å–é‡å¢åŠ ï¼‰
  
  - [ ] **éå‡¡ï¼ˆã‚¢ãƒãƒãƒªãƒ¼ï¼‰**
    - [ ] å…¨åŠ›å€¼ç³»ç»Ÿï¼ˆç§¯ç´¯è‡³10ç‚¹è½¬åŒ–ï¼‰
    - [ ] å…¨åŠ›çŠ¶æ€ï¼ˆåˆ†æ•°+200%ï¼‰
    - [ ] åšå†³çŠ¶æ€ï¼ˆä¸€ã€äºŒé˜¶æ®µï¼‰
    - [ ] æ¸©å­˜çŠ¶æ€ï¼ˆä¸€ã€äºŒé˜¶æ®µï¼‰
    - [ ] æŒ‡é’ˆè½¬åŒ–å¡

- [ ] **buff/debuffç³»ç»Ÿ**
  - [ ] å±‚æ•°ç®¡ç†ï¼ˆæ¯å›åˆå¼€å§‹æ—¶-1ï¼‰
  - [ ] æ•ˆæœç»“ç®—é¡ºåºï¼ˆé›†ä¸­â†’çŠ¶æ€è‰¯å¥½&çŠ¶æ€ç»ä½³ï¼›å‡å°‘â†’å¢åŠ â†’å‰Šå‡ï¼‰
  - [ ] buffå›¾æ ‡æ˜¾ç¤ºï¼ˆä»Git CDNåŠ è½½ï¼‰
  - [ ] buffæ‚¬åœæç¤º
  - [ ] buffåŠ¨ç”»æ•ˆæœ

- [ ] **å¯¹æˆ˜è€…æ¨¡æ‹Ÿï¼ˆæ¯”èµ›æ¨¡å¼ï¼‰**
  ```typescript
  interface Rival {
    name: string;
    stats: { vo: number, da: number, vi: number };
    difficulty: number;  // éš¾åº¦ç³»æ•°
  }
  
  // AIå¯¹æ‰‹åˆ†æ•° = (åŸºç¡€å±æ€§ Ã— åŠ æˆå€ç‡ Ã— éš¾åº¦) + éšæœºå€¼
  function calculateRivalScore(
    rival: Rival, 
    turn: number, 
    attribute: 'vocal' | 'dance' | 'visual'
  ): number {
    const baseStat = rival.stats[attribute === 'vocal' ? 'vo' : attribute === 'dance' ? 'da' : 'vi'];
    const multiplier = calculateMultiplier(rival.stats);
    const random = Math.random() * 200;
    return baseStat * multiplier * rival.difficulty + random;
  }
  ```

- [ ] **è®­ç»ƒ/æ¯”èµ›ç»“æœåˆ¤å®š**
  - [ ] æ ¹æ®å¾—åˆ†è®¡ç®—è¯„ä»·ï¼ˆPerfect/Clear/Failï¼‰
  - [ ] Perfectå¥–åŠ±ï¼šå¤šä½™å›åˆè½¬æ¢ä¸ºä½“åŠ›å›å¤
  - [ ] Clearå¥–åŠ±ï¼šPç‚¹æ•°ã€Pé¥®æ–™ã€æŠ€èƒ½å¡
  - [ ] Failæƒ©ç½šï¼šæ— æ³•è·å¾—é¥®æ–™å’ŒæŠ€èƒ½å¡
  - [ ] æ¯”èµ›æ’ååˆ¤å®šï¼šæ ¹æ®å¾—åˆ†ä¸å¯¹æ‰‹æ¯”è¾ƒ

#### æ•°å€¼å¹³è¡¡

- [ ] **æŠ€èƒ½å¡å¹³è¡¡è¡¨ï¼ˆæŒ‰ç¨€æœ‰åº¦ï¼‰**
  
  **æ³¨æ„**ï¼šæŠ€èƒ½å¡ä¸ç›´æ¥æå‡Vocal/Dance/Visualä¸‰ç»´ï¼Œè€Œæ˜¯æ“ä½œå…ƒæ°”ã€å¹²åŠ²ã€ä¸“æ³¨ç­‰å±æ€§å’ŒBuff
  
  ```typescript
  const CARD_BALANCE = {
    R: { 
      cost: [-5, -2],
      frameColor: 'white',  // ç™½è‰²å¤–æ¡†
      effectPower: 'weak',
      examples: [
        'æ‹æ‰‹ï¼ˆ-5è´¹ï¼ŒRï¼‰ï¼šæå‡å¥½å°è±¡150%çš„æ•°å€¼ï¼Œè¯¾ç¨‹ä¸­é™1æ¬¡',
        'å…ƒæ°”+10',
        'å¥½å°è±¡+6'
      ]
    },
    SR: { 
      cost: [-5, -2],
      frameColor: 'yellow',  // é»„è‰²å¤–æ¡†
      effectPower: 'medium',
      examples: [
        'å¤§å®¶éƒ½å–œæ¬¢ï¼ˆ-3è´¹ï¼ŒSRï¼‰ï¼šå¹²åŠ²æ¶ˆè€—3ï¼Œæå‡å¥½å°è±¡90%çš„åˆ†æ•°ï¼ŒæŠ€èƒ½å¡ä½¿ç”¨æ•°+1ï¼Œä¸å¯é‡å¤',
        'åº”æ´å£°æµªï¼ˆ-3è´¹ï¼ŒSRï¼‰ï¼šä¸“æ³¨æ¶ˆè€—3ï¼Œæ•°å€¼+6ï¼ŒçŠ¶æ€è‰¯å¥½+2å›åˆï¼ŒæŠ€èƒ½å¡ä½¿ç”¨æ•°+1ï¼Œä¸å¯é‡å¤',
        'å¹¸ç¦æ—¶å…‰ï¼ˆ-5è´¹ï¼ŒSRï¼‰ï¼šå¥½å°è±¡+6ï¼ˆå¼ºåŒ–ï¼š+8ï¼‰',
        'ç«Ÿå°”ä¸€ç¬‘ï¼ˆ-2è´¹ï¼ŒSRï¼‰ï¼šå¥½å°è±¡+3ï¼Œè‹¥æ­¤æ—¶å¥½å°è±¡ä¸å°äº3ï¼Œé¢å¤–è·å¾—å¹²åŠ²+2',
        'ç¥ç¦ï¼ˆ-4è´¹ï¼ŒSRï¼‰ï¼šæ¶ˆè€—ä½“åŠ›4ï¼Œæ•°å€¼+26ï¼ŒçŠ¶æ€è‰¯å¥½+1å›åˆï¼Œè¯¾ç¨‹ä¸­é™1æ¬¡',
        'å¿ƒè·³ä¸åœï¼ˆ-3è´¹ï¼ŒSRï¼‰ï¼šå¹²åŠ²+3ï¼›éšåï¼Œæ¯æ¬¡ä½¿ç”¨Mç±»æŠ€èƒ½å¡ï¼Œå¹²åŠ²+1ï¼Œè¯¾ç¨‹ä¸­é™ä¸€æ¬¡ï¼Œä¸å¯é‡å¤'
      ]
    },
    SSR: { 
      cost: [-5, -1],
      frameColor: 'rainbow',  // å½©è‰²å¤–æ¡†
      effectPower: 'strong',
      examples: [
        'å›½æ°‘çš„å¶åƒï¼ˆ-1è´¹ï¼ŒSSRï¼‰ï¼šæ¶ˆè€—çŠ¶æ€è‰¯å¥½1å›åˆï¼Œä¸‹ä¸€å¼ å¡æ•ˆæœå‘åŠ¨2æ¬¡ï¼ŒæŠ€èƒ½å¡ä½¿ç”¨æ•°+1ï¼Œè¯¾ç¨‹ä¸­é™1æ¬¡ï¼Œä¸å¯é‡å¤',
        'å¤©èµ‹ä¹‹æ‰ï¼ˆ-5è´¹ï¼ŒSSRï¼‰ï¼šæ¶ˆè€—5ä½“åŠ›ï¼Œå¥½è°ƒ+3å›åˆï¼Œé›†ä¸­+2ï¼Œå°†3å¼ SSRç§»è‡³ç‰Œå †é¡¶ï¼Œä¸‹å›åˆæŠ€èƒ½å¡ä½¿ç”¨æ•°+1',
        'é­…æƒ‘è§†çº¿ï¼ˆ-3è´¹ï¼ŒSSRï¼‰ï¼šæ¶ˆè€—ä¸“æ³¨3ï¼ŒçŠ¶æ€ç»ä½³+5å›åˆï¼Œä½“åŠ›æ¶ˆè€—å‡å°‘+5å›åˆï¼ŒæŠ€èƒ½å¡ä½¿ç”¨æ•°+1ï¼Œè¯¾ç¨‹ä¸­é™1æ¬¡ï¼Œä¸å¯é‡å¤',
        'è§‰é†’ï¼ˆ-3è´¹ï¼ŒSSRï¼‰ï¼šçŠ¶æ€è‰¯å¥½æ¶ˆè€—1å›åˆï¼Œæ•°å€¼+3ï¼ˆ2æ¬¡ï¼‰ï¼Œä¸“æ³¨+4ï¼Œä¸å¯é‡å¤'
      ]
    },
    UR: { 
      cost: [-6, -1],
      frameColor: 'special',  // ç‰¹æ®Šå¤–æ¡†ï¼ˆéœ€è‡ªè¡Œè®¾è®¡ï¼‰
      effectPower: 'overwhelming',
      examples: [
        'ï¼ˆéœ€è‡ªè¡Œåˆ›é€ ï¼‰',
        'å‚è€ƒæ€è·¯1ï¼šSSRæ•ˆæœçš„2å€å¼ºåº¦',
        'å‚è€ƒæ€è·¯2ï¼šæ”¹å˜è§„åˆ™çš„ç‹¬ç‰¹æœºåˆ¶ï¼ˆå¦‚ï¼šå›åˆæ•°+2ã€å¤åˆ¶æ‰‹ç‰Œä¸­æ‰€æœ‰å¡ã€å…¨å±æ€§BuffåŒæ—¶è§¦å‘ï¼‰',
        'å‚è€ƒæ€è·¯3ï¼šæå…¶å¤æ‚çš„å¤šé‡æ¡ä»¶+è¶…å¼ºæ•ˆæœç»„åˆ'
      ]
    },
    
    // éå‡¡ç³»ç»Ÿä¸“å±ï¼ˆç‰¹æ®Šæœºåˆ¶ï¼‰
    Anomaly_Special: {
      cost: [-5, -1],
      examples: [
        'æ±—ä¸æˆé•¿ï¼ˆ-1è´¹ï¼Œéå‡¡ï¼‰ï¼šè‹¥å¤„äºå…¨åŠ›çŠ¶æ€ï¼Œæ‰èƒ½ä½¿ç”¨ã€‚æ•°å€¼+37ï¼Œè¯¾ç¨‹ä¸­é™1æ¬¡',
        'å·åœŸé‡æ¥ï¼ˆ-1è´¹ï¼Œéå‡¡ï¼‰ï¼šæ¶ˆè€—1å…¨åŠ›å€¼ï¼Œåˆ‡æ¢è‡³æ¸©å­˜çŠ¶æ€ï¼Œçƒ­æ„å€¼å¢åŠ é‡+3ï¼Œæ‰€æœ‰æŠ€èƒ½å¡çš„æ¶ˆè€—å€¼-1',
        'æŸSSRå¡ï¼ˆ-5è´¹ï¼Œéå‡¡ï¼‰ï¼šä»…å¯åœ¨åˆ‡æ¢æ¸©å­˜çŠ¶æ€ä¸¤æ¬¡åŠä»¥ä¸Šæ—¶ä½¿ç”¨ï¼›åˆ‡æ¢è‡³æ¸©å­˜çŠ¶æ€ï¼›æŠ€èƒ½å¡ä½¿ç”¨æ•°+1ï¼›Aç±»æŠ€èƒ½å¡çš„æ•°å€¼+14ï¼Œä½“åŠ›æ¶ˆè€—+1'
      ]
    }
  };
  
  // æŠ€èƒ½å¡æ•ˆæœç±»å‹
  const SKILL_CARD_EFFECT_TYPES = {
    // å±æ€§æ“ä½œ
    ATTRIBUTE: ['å…ƒæ°”', 'å¹²åŠ²', 'ç²¾åŠ›', 'ä¸“æ³¨', 'é›†ä¸­', 'æ´»åŠ›', 'å…¨åŠ›å€¼'],
    
    // Buffæ•ˆæœ
    BUFF: ['çŠ¶æ€è‰¯å¥½', 'å¥½è°ƒ', 'çŠ¶æ€ç»ä½³', 'å¥½å°è±¡', 'ä½“åŠ›æ¶ˆè€—å‡å°‘', 'æ¸©å­˜', 'åšå†³'],
    
    // æ•°å€¼å¢å¹…
    AMPLIFY: ['æ•°å€¼ä¸Šå‡é‡å¢åŠ X%', 'å¥½å°è±¡å¢åŠ ä¸ºXå€', 'å¾—åˆ†+X'],
    
    // ç‰¹æ®Šæ•ˆæœ
    SPECIAL: [
      'æŠ€èƒ½å¡ä½¿ç”¨æ•°+1', 
      'ä¸‹ä¸€å¼ å¡æ•ˆæœå‘åŠ¨2æ¬¡',
      'å°†Xå¼ SSRç§»è‡³ç‰Œå †é¡¶',
      'æ‰‹ç‰Œ+X',
      'å›åˆæ•°+1'
    ],
    
    // æ¶ˆè€—æœºåˆ¶
    COST: ['æ¶ˆè€—ä½“åŠ›X', 'æ¶ˆè€—ä¸“æ³¨X', 'æ¶ˆè€—å…¨åŠ›å€¼X', 'æ¶ˆè€—çŠ¶æ€è‰¯å¥½Xå›åˆ']
  };
  ```

- [ ] **è®­ç»ƒæ”¶ç›Šå¹³è¡¡**
  ```typescript
  const TRAINING_REWARDS = {
    perfect: { 
      vo: 40,  // Vocalè®­ç»ƒç¤ºä¾‹
      p_points: 50,
      p_drink: 1,
      skill_card: 1
    },
    clear: { 
      vo: 25, 
      p_points: 30,
      p_drink: 1,
      skill_card: 1
    },
    fail: { 
      vo: 10, 
      p_points: 10,
      p_drink: 0,
      skill_card: 0
    }
  };
  ```

- [ ] **Pé¥®æ–™æ•ˆæœé…ç½®**
  ```typescript
  const P_DRINKS = {
    // é€šç”¨
    'åˆæ˜Ÿæ°´': { score: 10 },
    'ä¹Œé¾™èŒ¶': { genki: 7 },
    'å›å¤é¥®æ–™': { stamina: 6 },
    
    // æ„Ÿæ€§ä¸“å±
    'ç»´ç”Ÿç´ é¥®æ–™': { buff: { type: 'å¥½èª¿', stacks: 3 } },
    'å†°å’–å•¡': { buff: { type: 'é›†ä¸­', stacks: 3 } },
    
    // ç†æ€§ä¸“å±
    'è·¯æ˜“æ³¢å£«èŒ¶': { buff: { type: 'å¥½å°è±¡', stacks: 3 } },
    'çƒ­å’–å•¡': { buff: { type: 'æœ‰å¹²åŠ²', stacks: 3 } },
    
    // éå‡¡ä¸“å±
    'å§œæ±æ±½æ°´': { transform: 'åšå†³', allPower: 1 },
    'ç„™èŒ¶': { transform: 'æ¸©å­˜', allPower: 2 },
    
    // ... æ›´å¤šé¥®æ–™
  };
  ```

#### èµ„æºå‡†å¤‡

- [ ] **buffå›¾æ ‡**
  - [ ] å‡†å¤‡æ‰€æœ‰æ­£é¢/è´Ÿé¢æ•ˆæœçš„å›¾æ ‡ï¼ˆPNG/SVGï¼‰
  - [ ] å‹ç¼©ä¸ºWebPæ ¼å¼
  - [ ] ä¸Šä¼ åˆ°Git CDNï¼ˆ`ç»„åˆå°å›¾æ ‡` åŒçº§ç›®å½•ï¼Œæ–°å»º `buffå›¾æ ‡` æ–‡ä»¶å¤¹ï¼‰

- [ ] **æŠ€èƒ½å¡ç¤ºä¾‹æ•°æ®**
  - [ ] åˆ›å»ºåŸºæœ¬æŠ€èƒ½å¡æ•°æ®ï¼ˆNç¨€æœ‰åº¦ï¼‰
  - [ ] ä¸º28ä¸ªå¶åƒå‡†å¤‡ä¸“å±æŠ€èƒ½å¡ï¼ˆå¾…AIç”Ÿæˆï¼‰
  - [ ] åˆ›å»ºé€šç”¨æŠ€èƒ½å¡æ± ï¼ˆR/SR/SSRï¼‰

**äº¤ä»˜ç‰©**:
- âŒ `E:\å¶åƒå¤§å¸ˆ\é—ªè€€è‰²å½©å¡ç‰Œæœºåˆ¶è¯´æ˜.txt`ï¼ˆâœ… å·²å®Œæˆï¼‰
- âŒ `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©-cardgame/` å®Œæ•´æ–‡ä»¶å¤¹
- âŒ `CardGame.vue`ï¼ˆä¸»ç•Œé¢ï¼‰
- âŒ `SkillCard.vue`ï¼ˆæŠ€èƒ½å¡ç»„ä»¶ï¼‰
- âŒ `BuffBar.vue`ï¼ˆbuffæ ç»„ä»¶ï¼‰
- âŒ `card-logic.ts`ï¼ˆæ‰“ç‰Œé€»è¾‘ï¼‰
- âŒ `buff-system.ts`ï¼ˆbuffç³»ç»Ÿï¼‰
- âŒ `plan-mechanics.ts`ï¼ˆåŸ¹è‚²è®¡åˆ’æœºåˆ¶ï¼‰
- âŒ `rival-simulator.ts`ï¼ˆå¯¹æ‰‹æ¨¡æ‹Ÿï¼‰
- âŒ `balance-config.ts`ï¼ˆæ•°å€¼å¹³è¡¡é…ç½®ï¼‰
- âŒ buffå›¾æ ‡èµ„æºï¼ˆä¸Šä¼ åˆ°Gitï¼‰

---

### 2.2 P-ProduceåŸ¹è‚²ç³»ç»Ÿæ¡†æ¶ âŒ
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰

#### æ ¸å¿ƒç»„ä»¶

- [ ] **ProduceHost.vueï¼ˆåŸ¹è‚²æ€»æ§ï¼‰**
  - [ ] å›åˆæ•°ç®¡ç†ï¼ˆcurrentTurn / maxTurnsï¼‰
  - [ ] å¶åƒå±æ€§ç®¡ç†ï¼ˆvo, da, vi, staminaï¼‰
  - [ ] è¡ŒåŠ¨é€‰æ‹©ç•Œé¢
  - [ ] åœºæ™¯åˆ‡æ¢é€»è¾‘

- [ ] **ScenarioLoader.vueï¼ˆå‰§æœ¬åŠ è½½å™¨ï¼‰**
  - [ ] ä»JSONåŠ è½½å‰§æœ¬é…ç½®
  - [ ] å‰§æœ¬é€‰æ‹©ç•Œé¢
  - [ ] å‰§æœ¬ä¿¡æ¯å±•ç¤º

- [ ] **ActionSelector.vueï¼ˆè¡ŒåŠ¨é€‰æ‹©å™¨ï¼‰**
  - [ ] è®­ç»ƒæŒ‰é’®ï¼ˆè¿æ¥CardGameï¼‰
  - [ ] è‡ªç”±æ´»åŠ¨æŒ‰é’®ï¼ˆè¿æ¥Mapï¼‰
  - [ ] ä¼‘æ¯æŒ‰é’®
  - [ ] æ¯”èµ›æŒ‰é’®ï¼ˆç‰¹å®šå›åˆï¼‰

- [ ] **StatsDisplay.vueï¼ˆå±æ€§å±•ç¤ºï¼‰**
  - [ ] ä¸‰ç»´å±æ€§æ¡
  - [ ] ä½“åŠ›å€¼
  - [ ] å›åˆå€’è®¡æ—¶
  - [ ] å¥½æ„Ÿåº¦ç®€è¦æ˜¾ç¤º

#### å‰§æœ¬ç³»ç»Ÿ

- [ ] **å‰§æœ¬JSONæ ¼å¼**
  ```json
  {
    "id": "wing",
    "name": "W.I.N.G.å‡†ä¼˜èƒœ",
    "description": "283äº‹åŠ¡æ‰€çš„å‡ºé“èµ›",
    "turns": 18,
    "difficulty": ["Regular", "Pro", "Master"],
    "initialStats": { 
      "vo": 100, 
      "da": 100, 
      "vi": 100,
      "stamina": 60
    },
    "specialRules": {
      "turn1": "å¼ºåˆ¶è®­ç»ƒ",
      "turn9": "ä¸­é—´æ¯”èµ›",
      "turn8": "è¿½åŠ è®­ç»ƒï¼ˆæ¯”èµ›å‰ä¸€å‘¨ï¼‰",
      "turn17": "è¿½åŠ è®­ç»ƒï¼ˆæ¯”èµ›å‰ä¸€å‘¨ï¼‰",
      "turn18": "æœ€ç»ˆæ¯”èµ›"
    },
    "rivals": [
      { 
        "name": "å¯¹æ‰‹A", 
        "stats": { "vo": 500, "da": 200, "vi": 100 },
        "difficulty": 1.0
      },
      { 
        "name": "å¯¹æ‰‹B", 
        "stats": { "vo": 200, "da": 500, "vi": 100 },
        "difficulty": 1.2
      },
      { 
        "name": "å¯¹æ‰‹C", 
        "stats": { "vo": 300, "da": 300, "vi": 600 },
        "difficulty": 1.5
      }
    ],
    "availableActivities": {
      "1-10": ["beach", "library"],
      "11-20": ["beach", "library", "cafe", "studio"],
      "21-30": ["beach", "library", "cafe", "studio", "park", "office"]
    },
    "examCriteria": {
      "mano": { "vo": 0.5, "da": 0.3, "vi": 0.2 },  // æ¨±æœ¨çœŸä¹ƒï¼šVoä¸»å¯¼
      "hiori": { "vo": 0.2, "da": 0.3, "vi": 0.5 }  // é£é‡ç¯ç»‡ï¼šViä¸»å¯¼
      // ... 28ä¸ªå¶åƒçš„å®¡æŸ¥åŸºå‡†
    }
  }
  ```

- [ ] **å‰§æœ¬æ•°æ®åº“ï¼ˆæ”¹ç¼–è‡ªå­¦å›­ï¼Œä½¿ç”¨é—ªè€€è‰²å½©å‰§æœ¬åï¼‰**
  - [ ] **W.I.N.G.å‡†ä¼˜èƒœ**ï¼ˆ18å›åˆï¼‰
    - [ ] éš¾åº¦ï¼šRegular/Pro/Master
    - [ ] ä¸»é¢˜ï¼š283äº‹åŠ¡æ‰€çš„å‡ºé“èµ›
    - [ ] ç‰¹ç‚¹ï¼šåŸºç¡€å‰§æœ¬ï¼Œæ–°äººå‹å¥½
  
  - [ ] **æ„Ÿè°¢ç¥­**ï¼ˆ20å›åˆï¼‰
    - [ ] éš¾åº¦ï¼šPro/Master
    - [ ] ä¸»é¢˜ï¼šç²‰ä¸å›é¦ˆè¡¨æ¼”
    - [ ] ç‰¹ç‚¹ï¼šæ›´æ³¨é‡Visualçš„æ¯”èµ›
  
  - [ ] **GRADæ¯•ä¸šå…¸ç¤¼**ï¼ˆ26å›åˆï¼‰
    - [ ] éš¾åº¦ï¼šPro/Master
    - [ ] ä¸»é¢˜ï¼šæ¯•ä¸šæ¼”å‡º
    - [ ] ç‰¹ç‚¹ï¼šæœ€é•¿å‰§æœ¬ï¼Œæ›´å¼ºçš„å¯¹æ‰‹
  
  - [ ] **Landing Point**ï¼ˆ22å›åˆï¼‰
    - [ ] éš¾åº¦ï¼šPro/Master
    - [ ] ä¸»é¢˜ï¼šé™è½ç‚¹
    - [ ] ç‰¹ç‚¹ï¼šç‰¹æ®Šæœºåˆ¶ï¼ˆéœ€è¦ç®¡ç†ä½“åŠ›ï¼‰
  
  - [ ] **STEP**ï¼ˆ20å›åˆï¼‰
    - [ ] éš¾åº¦ï¼šPro/Master
    - [ ] ä¸»é¢˜ï¼šå°é˜¶
    - [ ] ç‰¹ç‚¹ï¼šé˜¶æ®µæ€§ç›®æ ‡
  
  - [ ] **Say Hello**ï¼ˆ13å›åˆï¼‰
    - [ ] éš¾åº¦ï¼šRegular/Pro
    - [ ] ä¸»é¢˜ï¼šé—®å€™
    - [ ] ç‰¹ç‚¹ï¼šæ–°äººå‹å¥½å‰§æœ¬ï¼ˆæœ€çŸ­ï¼Œå¿«é€Ÿä½“éªŒï¼‰

#### å›åˆåˆ¶é€»è¾‘

- [ ] **å›åˆæ¨è¿›**
  ```typescript
  class ProduceSession {
    currentTurn: number = 1;
    maxTurns: number = 18;  // é»˜è®¤W.I.N.G.å‰§æœ¬ï¼Œ13-26å›åˆå¯é€‰
    currentIdol: ProduceCard;  // å½“å‰åŸ¹è‚²çš„På¡
    currentStats: {
      vo: number;
      da: number;
      vi: number;
      stamina: number;
      maxStamina: number;
    };
    pPoints: number = 0;  // Pç‚¹æ•°
    pDrinks: PDrink[] = [];  // Pé¥®æ–™ï¼ˆæœ€å¤š3ä¸ªï¼‰
    pItems: PItem[] = [];  // Pé“å…·
    skillCardDeck: SkillCard[] = [];  // æŠ€èƒ½å¡ç»„
    bondLevel: number = 0;  // å½“å‰å¥½æ„Ÿåº¦
    
    nextTurn() {
      this.currentTurn++;
      this.checkSpecialEvents();  // æ£€æŸ¥ç‰¹æ®Šäº‹ä»¶
      this.updateAvailableActions();  // æ›´æ–°å¯ç”¨è¡ŒåŠ¨
      this.triggerRandomEvents();  // è§¦å‘éšæœºäº‹ä»¶ï¼ˆå¦‚åº”æ´æ•ˆæœï¼‰
    }
    
    checkSpecialEvents() {
      const scenario = getCurrentScenario();
      
      // æ£€æŸ¥æ˜¯å¦éœ€è¦è§¦å‘è¿½åŠ è®­ç»ƒ
      if (scenario.specialRules[`turn${this.currentTurn}`] === 'è¿½åŠ è®­ç»ƒ') {
        this.triggerExtraTraining();
      }
      
      // æ£€æŸ¥æ˜¯å¦éœ€è¦è§¦å‘ä¸­é—´æ¯”èµ›
      if (scenario.specialRules[`turn${this.currentTurn}`] === 'ä¸­é—´æ¯”èµ›') {
        this.triggerMidExam();
      }
      
      // æ£€æŸ¥æ˜¯å¦éœ€è¦è§¦å‘æœ€ç»ˆæ¯”èµ›
      if (this.currentTurn === this.maxTurns) {
        this.triggerFinalExam();
      }
    }
  }
  ```

- [ ] **è¡ŒåŠ¨å¤„ç†ï¼ˆè®­ç»ƒï¼‰**
  ```typescript
  async function handleTraining(lesson: 'Vocal' | 'Dance' | 'Visual') {
    // 1. è¿›å…¥æ‰“ç‰Œç•Œé¢
    const result = await openCardGame({ 
      mode: 'training', 
      type: lesson,
      initialStamina: this.currentStats.stamina,
      maxStamina: this.currentStats.maxStamina,
      currentStats: this.currentStats,
      skillDeck: this.skillCardDeck,
      planType: this.currentIdol.planType  // æ„Ÿæ€§/ç†æ€§/éå‡¡
    });
    
    // 2. è®¡ç®—å±æ€§å¢é•¿
    const statGain = calculateStatGain(result.score, result.evaluation);
    this.currentStats[lesson.toLowerCase()] += statGain;
    
    // 3. æ›´æ–°ä½“åŠ›
    this.currentStats.stamina = result.finalStamina;
    
    // 4. è·å¾—å¥–åŠ±ï¼ˆPç‚¹æ•°ã€Pé¥®æ–™ã€æŠ€èƒ½å¡ï¼‰
    if (result.evaluation !== 'fail') {
      this.pPoints += result.rewards.pPoints;
      if (result.rewards.pDrink) {
        this.addPDrink(result.rewards.pDrink);
      }
      if (result.rewards.skillCard) {
        this.addSkillCard(result.rewards.skillCard);
      }
    }
    
    // 5. è¯·æ±‚AIå‰§æƒ…ï¼ˆä½¿ç”¨PromptFactoryï¼‰
    const story = await PromptFactory.assemblePrompt('TRAINING_STORY', {
      persona: LORE[this.currentIdol.characterId],
      lesson: lesson,
      result: result.evaluation,  // perfect/clear/fail
      stat_gain: statGain,
      bond_level: this.bondLevel,
      bond_behavior: getBondBehavior(this.bondLevel),
      turn: this.currentTurn
    });
    
    // 6. æ˜¾ç¤ºå‰§æƒ…
    await showDialogue(story);
    
    // 7. ä¸‹ä¸€å›åˆ
    this.nextTurn();
  }
  ```

- [ ] **è¡ŒåŠ¨å¤„ç†ï¼ˆè‡ªç”±æ´»åŠ¨ï¼‰**
  ```typescript
  async function handleFreeActivity() {
    // 1. æ˜¾ç¤ºåœ°å›¾ï¼Œè§£é”3ä¸ªéšæœºåœ°ç‚¹
    const availableLocations = getRandomLocations(3);
    const selectedLocation = await showLocationMap(availableLocations);
    
    // 2. è¯·æ±‚AIå‰§æƒ…ï¼ˆä½¿ç”¨PromptFactoryï¼‰
    const story = await PromptFactory.assemblePrompt('FREE_ACTIVITY', {
      persona: LORE[this.currentIdol.characterId],
      location_lore: LORE_LOCATIONS[selectedLocation.id],
      bond_level: this.bondLevel,
      bond_behavior: getBondBehavior(this.bondLevel),
      turn: this.currentTurn,
      max_turns: this.maxTurns
    });
    
    // 3. æ˜¾ç¤ºå‰§æƒ…å¹¶è§£æå¥–åŠ±
    const dialogue = await showDialogue(story);
    const rewards = parseRewards(dialogue);  // ä»<reward>æ ‡ç­¾è§£æ
    
    // 4. åº”ç”¨å¥–åŠ±
    if (rewards.stamina) {
      this.currentStats.stamina = Math.min(
        this.currentStats.stamina + rewards.stamina,
        this.currentStats.maxStamina
      );
    }
    if (rewards.love) {
      this.bondLevel += rewards.love;
    }
    if (rewards.stats) {
      this.currentStats.vo += rewards.stats.vo || 0;
      this.currentStats.da += rewards.stats.da || 0;
      this.currentStats.vi += rewards.stats.vi || 0;
    }
    
    // 5. ä¸‹ä¸€å›åˆ
    this.nextTurn();
  }
  ```

- [ ] **è¡ŒåŠ¨å¤„ç†ï¼ˆæ¯”èµ›ï¼‰**
  ```typescript
  async function handleExam(isFinal: boolean) {
    // 1. è®¡ç®—å®¡æŸ¥åŸºå‡†ï¼ˆå†³å®šå±æ€§å›åˆåˆ†é…ï¼‰
    const examCriteria = getCurrentScenario().examCriteria[this.currentIdol.characterId];
    
    // 2. è¿›å…¥æ‰“ç‰Œç•Œé¢ï¼ˆæ¯”èµ›æ¨¡å¼ï¼‰
    const result = await openCardGame({ 
      mode: 'exam', 
      isFinal: isFinal,
      examCriteria: examCriteria,
      initialStamina: this.currentStats.stamina,
      maxStamina: this.currentStats.maxStamina,
      currentStats: this.currentStats,
      skillDeck: this.skillCardDeck,
      planType: this.currentIdol.planType
    });
    
    // 3. è®¡ç®—å¯¹æ‰‹åˆ†æ•°
    const rivals = getCurrentScenario().rivals;
    const rivalScores = rivals.map(rival => 
      calculateRivalTotalScore(rival, examCriteria, result.rounds)
    );
    
    // 4. åˆ¤å®šæ’å
    const allScores = [result.totalScore, ...rivalScores];
    const rank = allScores.filter(s => s > result.totalScore).length + 1;
    
    // 5. åˆ¤å®šæ˜¯å¦åˆæ ¼
    const passed = rank <= 3;
    
    if (!passed) {
      // æ¯”èµ›ä¸åˆæ ¼ï¼Œç›´æ¥è¿›å…¥ç»“å±€
      await triggerEnding('fail');
      return;
    }
    
    // 6. ä¸­é—´æ¯”èµ›ï¼šç»™äºˆå¥–åŠ±
    if (!isFinal) {
      this.pPoints += calculateExamReward(rank);
      if (rank === 1 && getCurrentScenario().difficulty !== 'Regular') {
        // ProåŠä»¥ä¸Šéš¾åº¦ï¼Œç¬¬1åè·å¾—é€šç”¨Pé“å…·
        this.addPItem(getRandomPItem());
      }
    }
    
    // 7. æœ€ç»ˆæ¯”èµ›ï¼šè®¡ç®—åŸ¹è‚²è¯„ä»·
    if (isFinal) {
      const evaluation = calculateFinalEvaluation({
        rank: rank,
        finalScore: result.totalScore,
        finalStats: this.currentStats,
        scenario: getCurrentScenario().id
      });
      
      // è¯·æ±‚AIç»“å±€å‰§æƒ…ï¼ˆä½¿ç”¨PromptFactoryï¼‰
      const story = await PromptFactory.assemblePrompt('WING_ENDING', {
        persona: LORE[this.currentIdol.characterId],
        rank: rank,
        evaluation: evaluation,
        vo: this.currentStats.vo,
        da: this.currentStats.da,
        vi: this.currentStats.vi,
        bond_level: this.bondLevel,
        bond_behavior: getBondBehavior(this.bondLevel)
      });
      
      // æ˜¾ç¤ºç»“å±€å‰§æƒ…
      await showDialogue(story);
      
      // ç”Ÿæˆå›å¿†å¡
      await generateMemoryCard(evaluation);
      
      // å‘æ”¾å¥–åŠ±
      await distributeRewards(evaluation);
      
      return;
    }
    
    // 8. ä¸‹ä¸€å›åˆ
    this.nextTurn();
  }
  ```

#### è¯„ä»·ç³»ç»Ÿ

- [ ] **æ€»è¯„ä»·è®¡ç®—**ï¼ˆåŸºäºå­¦å›­å¶åƒå¤§å¸ˆæ ‡å‡†ï¼‰
  ```typescript
  function calculateFinalEvaluation(data: {
    rank: number,        // æ¯”èµ›åæ¬¡ (1-6)
    finalScore: number,  // æœ€ç»ˆæ¯”èµ›åˆ†æ•°
    finalStats: { vo: number, da: number, vi: number },  // æœ€ç»ˆä¸‰ç»´
    scenario: string     // å‰§æœ¬ID
  }): { grade: string, points: number } {
    let points = 0;
    
    // 1. æœ€ç»ˆæ¯”èµ›æ’åè¯„ä»·åˆ†
    const rankPoints = {
      1: 1700,
      2: 900,
      3: 500,
      4: 0,
      5: 0,
      6: 0
    };
    points += rankPoints[data.rank] || 0;
    
    // 2. æœ€ç»ˆæ¯”èµ›åˆ†æ•°è¯„ä»·åˆ†
    const X = data.finalScore;
    let scorePoints = 0;
    if (X <= 5000) {
      scorePoints = 0.3 * X;
    } else if (X <= 10000) {
      scorePoints = 0.15 * X + 750;
    } else if (X <= 20000) {
      scorePoints = 0.08 * X + 1450;
    } else if (X <= 30000) {
      scorePoints = 0.04 * X + 2250;
    } else if (X <= 40000) {
      scorePoints = 0.02 * X + 2850;
    } else {
      scorePoints = 0.01 * X + 3250;
    }
    points += Math.floor(scorePoints);
    
    // 3. å±æ€§å€¼è¯„ä»·åˆ†
    const totalStats = data.finalStats.vo + data.finalStats.da + data.finalStats.vi;
    points += Math.floor(totalStats * 2.3);
    
    // 4. è®¡ç®—è¯„çº§
    const grade = getGradeFromPoints(points);
    
    return { grade, points };
  }
  
  function getGradeFromPoints(points: number): string {
    if (points >= 18000) return 'SS+';
    if (points >= 16000) return 'SS';
    if (points >= 14500) return 'S+';
    if (points >= 13000) return 'S';
    if (points >= 11500) return 'A+';
    if (points >= 10000) return 'A';
    if (points >= 8000) return 'B+';
    if (points >= 6000) return 'B';
    if (points >= 4000) return 'C+';
    if (points >= 3000) return 'C';
    if (points >= 2000) return 'D';
    if (points >= 1000) return 'E';
    return 'F';
  }
  ```

- [ ] **è¯„ä»·ç­‰çº§å¯¹ç…§è¡¨**
  ```typescript
  const EVALUATION_THRESHOLDS = {
    'SS+': 18000,
    'SS':  16000,
    'S+':  14500,
    'S':   13000,
    'A+':  11500,
    'A':   10000,
    'B+':  8000,
    'B':   6000,
    'C+':  4000,
    'C':   3000,
    'D':   2000,
    'E':   1000,
    'F':   0
  };
  ```

- [ ] **å¥–åŠ±å‘æ”¾**
  ```typescript
  const EVALUATION_REWARDS = {
    'SS+': { gems: 3000, fans: 200000, exp: 800 },
    'SS':  { gems: 2500, fans: 150000, exp: 700 },
    'S+':  { gems: 2000, fans: 120000, exp: 600 },
    'S':   { gems: 1700, fans: 100000, exp: 500 },
    'A+':  { gems: 1400, fans: 80000, exp: 400 },
    'A':   { gems: 1000, fans: 50000, exp: 300 },
    'B+':  { gems: 700, fans: 30000, exp: 200 },
    'B':   { gems: 500, fans: 20000, exp: 150 },
    'C+':  { gems: 300, fans: 10000, exp: 100 },
    'C':   { gems: 200, fans: 5000, exp: 50 },
    'D':   { gems: 100, fans: 2000, exp: 30 },
    'E':   { gems: 50, fans: 1000, exp: 20 },
    'F':   { gems: 20, fans: 500, exp: 10 }
  };
  
  async function distributeRewards(evaluation: { grade: string, points: number }) {
    const rewards = EVALUATION_REWARDS[evaluation.grade];
    
    // å‘æ”¾å¥–åŠ±
    await giveRewards({
      gems: rewards.gems,
      fans: rewards.fans,
      exp: rewards.exp
    });
    
    // æ˜¾ç¤ºå¥–åŠ±UI
    await showRewardsScreen({
      grade: evaluation.grade,
      points: evaluation.points,
      rewards: rewards
    });
  }
  ```

**äº¤ä»˜ç‰©**:
- âŒ `src/å¶åƒå¤§å¸ˆé—ªè€€è‰²å½©-produce/` å®Œæ•´æ–‡ä»¶å¤¹
- âŒ `ProduceHost.vue`ï¼ˆæ€»æ§ç»„ä»¶ï¼‰
- âŒ `scenarios/*.json`ï¼ˆå‰§æœ¬æ•°æ®ï¼‰
- âŒ `produce-logic.ts`ï¼ˆåŸ¹è‚²é€»è¾‘ï¼‰
- âŒ `evaluation.ts`ï¼ˆè¯„ä»·ç³»ç»Ÿï¼‰

---

## Phase 3: AIå™äº‹é›†æˆï¼ˆæœªå¼€å§‹ï¼‰

**ç›®æ ‡**: å°†AIå®Œæ•´æ¥å…¥æ¸¸æˆï¼Œå®ç°åŠ¨æ€å‰§æƒ…ç”Ÿæˆ  
**é¢„è®¡æ—¶é—´**: 3å‘¨ï¼ˆç§»é™¤MVUåç®€åŒ–ï¼‰  
**å‰ç½®æ¡ä»¶**: Phase 1.6ï¼ˆiframeé€šä¿¡ï¼‰+ Phase 2.0ï¼ˆæç¤ºè¯åŠ å·¥å‚ï¼‰å®Œæˆ

### 3.1 å‰§æƒ…ç”Ÿæˆç³»ç»Ÿ âŒ
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰+ åç«¯ï¼ˆSillyTavernï¼‰

**æ ¸å¿ƒç†å¿µ**: Vueä½¿ç”¨æç¤ºè¯åŠ å·¥å‚ç»„è£…å®Œæ•´æç¤ºè¯ï¼ŒSTä½œä¸ºçº¯ç²¹çš„ä¼ è¯ç­’ã€‚

#### å‰§æƒ…è§¦å‘ç‚¹è®¾è®¡

- [ ] **è®­ç»ƒåå‰§æƒ…**
  ```typescript
  // Vueç«¯ï¼šä½¿ç”¨PromptFactoryç»„è£…
  const bondLevel = localStorage.getItem('mano_bond');
  const prompt = PromptFactory.assemblePrompt('TRAINING_STORY', {
    persona: LORE_MANO,
    lesson: 'Vocal',
    result: 'great_success',
    stat_gain: 40,
    bond_level: bondLevel,
    bond_behavior: getBondBehavior(bondLevel),
    turn: 5
  });
  
  // å‘é€å®Œæ•´æç¤ºè¯
  postMessage({
    type: 'SEND_PROMPT',
    payload: { full_prompt: prompt }
  });
  ```

- [ ] **è‡ªç”±æ´»åŠ¨å‰§æƒ…**
  ```typescript
  // Vueç«¯ï¼šç»„è£…å®Œæ•´æç¤ºè¯
  const bondLevel = localStorage.getItem('mano_bond');
  const prompt = PromptFactory.assemblePrompt('FREE_ACTIVITY', {
    persona: LORE_MANO,
    location_lore: LORE_BEACH,
    bond_level: bondLevel,
    bond_behavior: getBondBehavior(bondLevel),
    turn: 10,
    max_turns: 30
  });
  
  // å‘é€
  postMessage({
    type: 'SEND_PROMPT',
    payload: { full_prompt: prompt }
  });
  ```

- [ ] **æ¯”èµ›ç»“å±€å‰§æƒ…**
  ```typescript
  // Vueç«¯ï¼šç»„è£…å®Œæ•´æç¤ºè¯
  const bondLevel = localStorage.getItem('mano_bond');
  const prompt = PromptFactory.assemblePrompt('WING_ENDING', {
    persona: LORE_MANO,
    rank: 1,
    evaluation: 'S',
    vo: 600,
    da: 500,
    vi: 400,
    bond_level: bondLevel,
    bond_behavior: getBondBehavior(bondLevel)
  });
  
  // å‘é€
  postMessage({
    type: 'SEND_PROMPT',
    payload: { full_prompt: prompt }
  });
  ```

#### å‰§æƒ…å±•ç¤ºç»„ä»¶

- [ ] **GalDialogue.vueï¼ˆGALå¯¹è¯æ¡†ï¼‰**
  - [ ] è§’è‰²ç«‹ç»˜
  - [ ] å¯¹è¯æ°”æ³¡
  - [ ] æ–‡å­—æ‰“å­—æœºæ•ˆæœ
  - [ ] ç‚¹å‡»ç»§ç»­
  - [ ] èƒŒæ™¯è™šåŒ–

- [ ] **StoryParser.tsï¼ˆå‰§æƒ…è§£æå™¨ï¼‰**
  - [ ] è§£æAIè¿”å›çš„æ–‡æœ¬
  - [ ] æå–`<reward>`æ ‡ç­¾
  - [ ] æå–è§’è‰²åå’Œå¯¹è¯
  - [ ] é”™è¯¯å¤„ç†

**äº¤ä»˜ç‰©**:
- âŒ `GalDialogue.vue`ï¼ˆå¯¹è¯æ¡†ç»„ä»¶ï¼‰
- âŒ `story-parser.ts`ï¼ˆå‰§æƒ…è§£æï¼‰
- âŒ `story-request.ts`ï¼ˆå‰§æƒ…è¯·æ±‚å°è£…ï¼‰

---

### 3.2 AIå¡ç‰Œç”Ÿæˆç³»ç»Ÿ âŒ
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰+ åç«¯ï¼ˆSillyTavernï¼‰

#### ä¸“ç”¨Botè®¾ç½®

- [ ] **åˆ›å»º"Card Generation Bot"è§’è‰²å¡**
  ```
  è§’è‰²å: Card Generation Bot
  
  è§’è‰²è®¾å®š:
  [System: ä½ çš„ä»»åŠ¡æ˜¯è®¾è®¡å¡ç‰Œæ¸¸æˆæŠ€èƒ½ã€‚
  
  ### è¾“å‡ºæ ¼å¼ï¼ˆä¸¥æ ¼éµå®ˆï¼‰ï¼š
  {
    "name": "æŠ€èƒ½åç§°ï¼ˆéœ€è¦æœ‰åˆ›æ„å’Œä¸»é¢˜æ€§ï¼‰",
    "cost": <1-6ä¹‹é—´çš„æ•´æ•°>,
    "type": <"Attack"ã€"Support"æˆ–"Heal"ä¹‹ä¸€>,
    "description": "æŠ€èƒ½æ•ˆæœçš„ç®€çŸ­æè¿°ï¼ˆ30å­—å†…ï¼‰"
  }
  
  ### å¹³è¡¡è§„åˆ™ï¼ˆæŒ‰ç¨€æœ‰åº¦åˆ’åˆ†ï¼‰ï¼š
  
  ã€R (COMMON) å¡ã€‘ï¼š
  * å¼ºåº¦ï¼šå¼±
  * Costï¼š1-2
  * æ•ˆæœï¼šç®€å•ã€å•ä¸€
  * ç¤ºä¾‹ï¼š{ "name": "æ·±å‘¼å¸", "cost": 1, "type": "Support", "description": "è·å¾—10 Hype" }
  
  ã€SR (RARE) å¡ã€‘ï¼š
  * å¼ºåº¦ï¼šä¸­ç­‰
  * Costï¼š2-3
  * æ•ˆæœï¼šå¼ºå¤§çš„å•ä¸€æ•ˆæœ æˆ– ä¸¤ä¸ªè¾ƒå¼±çš„å¤åˆæ•ˆæœ
  * ç¤ºä¾‹ï¼š{ "name": "å…¨åŠ›Vocal", "cost": 3, "type": "Attack", "description": "è·å¾— [Vocal] x 3.0 çš„åˆ†æ•°" }
  
  ã€SSR (ULTRA RARE) å¡ã€‘ï¼š
  * å¼ºåº¦ï¼šå¼º æˆ– æˆ˜ç•¥æ€§
  * Costï¼š3-5
  * æ•ˆæœï¼šéå¸¸å¼ºå¤§çš„æ•ˆæœ æˆ– å¤šä¸ªå¼ºåŠ›æ•ˆæœçš„ç»„åˆ
  * ç¤ºä¾‹ï¼š{ "name": "èˆå°æ”¯é…", "cost": 4, "type": "Attack", "description": "è·å¾— [Dance] x 4.0 çš„åˆ†æ•°ã€‚å¦‚æœHypeè¶…è¿‡50ï¼Œé¢å¤–è·å¾— [Dance] x 2.0" }
  
  ã€UR (ULTIMATE RARE) å¡ã€‘ï¼š
  * å¼ºåº¦ï¼šå‹å€’æ€§ æˆ– é¢ è¦†æ€§
  * Costï¼š4-6ï¼ˆé«˜æ˜‚ï¼‰
  * æ•ˆæœï¼šæ”¹å˜è§„åˆ™çš„æœºåˆ¶ æˆ– æå…¶å¼ºå¤§çš„å¤åˆæ•ˆæœ
  * ç¤ºä¾‹1ï¼š{ "name": "æ°¸æ’çš„é«˜æ½®", "cost": 5, "type": "Attack", "description": "è·å¾— [Vocal] x 7.0 çš„åˆ†æ•°ã€‚ä¸‹ä¸€å¼ Vocalå¡Costå˜ä¸º0" }
  * ç¤ºä¾‹2ï¼š{ "name": "å¥‡è¿¹çš„èˆå°", "cost": 4, "type": "Support", "description": "ç«‹å³è·å¾—200 Hypeã€‚æ¥ä¸‹æ¥3å›åˆï¼Œæ‰€æœ‰å±æ€§å¡ç‰Œæ•ˆæœæå‡40%" }
  * ç¤ºä¾‹3ï¼š{ "name": "ä¸–ç•Œçš„ä¸­å¿ƒ", "cost": 6, "type": "Attack", "description": "è·å¾— [Visual] x 5.0 çš„åˆ†æ•°ã€‚æ¯æ‹¥æœ‰1ç‚¹å‰©ä½™Costï¼Œåˆ†æ•°é¢å¤–æå‡ [Visual] x 1.0" }
  
  ### ä½ çš„ä»»åŠ¡ï¼š
  å½“æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œæ ¹æ®ç¨€æœ‰åº¦ï¼ˆR/SR/SSR/URï¼‰ã€è§’è‰²ã€ä¸»é¢˜ã€å±æ€§ï¼Œè®¾è®¡ä¸€å¼ ç¬¦åˆå¹³è¡¡è§„åˆ™çš„å¡ç‰Œã€‚
  åªè¾“å‡ºJSONï¼Œä¸è¦æœ‰ä»»ä½•å…¶ä»–æ–‡å­—ã€‚
  ]
  ```

#### ç”Ÿæˆæµç¨‹

- [ ] **Vueç«¯è§¦å‘ï¼ˆä½¿ç”¨PromptFactoryï¼‰**
  ```typescript
  async function generateSkill(cardId: string) {
    // 1. æ˜¾ç¤ºåŠ è½½é¡µï¼ˆå››æ ¼æ¼«ç”»ï¼‰
    showLoadingOverlay();
    
    // 2. ä½¿ç”¨PromptFactoryç»„è£…å®Œæ•´æç¤ºè¯
    const card = getCardById(cardId);
    const fullPrompt = PromptFactory.assemblePrompt('GENERATE_SKILL', {
      persona: LORE[card.characterId],
      rarity: card.rarity,
      theme: card.theme,
      attribute: card.attribute,
      mechanics: MECHANIC[card.attribute],
      examples: {
        r: EXAMPLE_R[card.attribute],
        sr: EXAMPLE_SR[card.attribute],
        ssr: EXAMPLE_SSR[card.attribute],
        ur: EXAMPLE_UR[card.attribute]
      }
    });
    
    // 3. å‘é€å®Œæ•´æç¤ºè¯ï¼ˆæŒ‡å®šä½¿ç”¨Card Generation Botï¼‰
    postMessage({
      type: 'SEND_PROMPT',
      payload: {
        full_prompt: fullPrompt,
        bot_name: 'Card Generation Bot',
        request_id: cardId  // ç”¨äºå›è°ƒè¯†åˆ«
      }
    });
  }
  ```

- [ ] **STç«¯å¤„ç†**
  ```typescript
  // loaderè„šæœ¬
  let mainCharacter = null;
  
  window.addEventListener('message', (event) => {
    if (event.data.type === 'SEND_PROMPT' && event.data.payload.bot_name) {
      // ä¿å­˜å½“å‰è§’è‰²
      mainCharacter = SillyTavern.Status.character;
      window.currentRequestId = event.data.payload.request_id;
      
      // åˆ‡æ¢åˆ°Bot
      SillyTavern.Api.command(`/switchchar "${event.data.payload.bot_name}"`);
      
      // å‘é€Vueç»„è£…å¥½çš„å®Œæ•´æç¤ºè¯
      SillyTavern.Api.command(`/say "${event.data.payload.full_prompt}"`, true);
    }
  });
  
  // æ‹¦æˆªAIå›å¤
  eventOn('chat:received', (message) => {
    if (window.currentRequestId) {
      // è§£æJSON
      try {
        const skillData = JSON.parse(message.message);
        
        // å‘å›Vue
        iframeWindow.postMessage({
          type: 'AI_RESPONSE',
          payload: {
            text: message.message,
            request_id: window.currentRequestId
          }
        }, '*');
        
        // åˆ‡å›åŸè§’è‰²
        if (mainCharacter) {
          SillyTavern.Api.command(`/switchchar "${mainCharacter}"`);
          mainCharacter = null;
        }
        
        // é™é»˜å¤„ç†
        message.message = "";
        window.currentRequestId = null;
      } catch (error) {
        console.error('AIè¿”å›çš„ä¸æ˜¯æœ‰æ•ˆJSON:', error);
      }
    }
  });
  ```

- [ ] **Vueç«¯ä¿å­˜**
  ```typescript
  window.addEventListener('message', (event) => {
    if (event.data.type === 'AI_RESPONSE' && event.data.payload.request_id) {
      const cardId = event.data.payload.request_id;
      const skillJson = event.data.payload.text;
      
      try {
        const skill = JSON.parse(skillJson);
        
        // å†™å…¥localStorage
        const inventory = loadInventory();
        inventory[cardId].unique_skill = skill;
        saveInventory(inventory);
        
        // éšè—åŠ è½½é¡µ
        hideLoadingOverlay();
        
        // æ˜¾ç¤ºæˆåŠŸæç¤º
        toastr.success(`æŠ€èƒ½ç”ŸæˆæˆåŠŸï¼š${skill.name}`);
        
        // Vueè‡ªåŠ¨åˆ·æ–°UI
      } catch (error) {
        hideLoadingOverlay();
        toastr.error('æŠ€èƒ½ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    }
  });
  ```

#### åŠ è½½é¡µï¼ˆå››æ ¼æ¼«ç”»ï¼‰

- [ ] **LoadingOverlay.vue**
  - [ ] å…¨å±é®ç½©
  - [ ] éšæœºå››æ ¼æ¼«ç”»
  - [ ] åŠ è½½æ–‡å­—ï¼ˆ"å°‘å¥³ç”Ÿæˆä¸­..."ï¼‰
  - [ ] åŠ¨ç”»æ•ˆæœ

- [ ] **å››æ ¼æ¼«ç”»èµ„æºåº“**
  ```typescript
  // four_panel_comics.jsonï¼ˆGitHub Releaseï¼‰
  [
    "https://github.com/.../comic_001.png",
    "https://github.com/.../comic_002.png",
    "https://github.com/.../comic_003.png",
    // ... æ›´å¤šæ¼«ç”»
  ]
  ```

**äº¤ä»˜ç‰©**:
- âŒ "Card Generation Bot"è§’è‰²å¡
- âŒ `LoadingOverlay.vue`ï¼ˆåŠ è½½é¡µç»„ä»¶ï¼‰
- âŒ Botåˆ‡æ¢é€»è¾‘ï¼ˆloaderè„šæœ¬ï¼‰
- âŒ å››æ ¼æ¼«ç”»èµ„æºåº“

---

## Phase 4: å†…å®¹å¡«å……ï¼ˆæœªå¼€å§‹ï¼‰

**ç›®æ ‡**: å¡«å……æ¸¸æˆå†…å®¹ï¼Œå¢åŠ å¯ç©æ€§  
**é¢„è®¡æ—¶é—´**: 4å‘¨

### 4.1 è‡ªç”±æ´»åŠ¨åœ°å›¾ç³»ç»Ÿ âŒ
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰

#### åœ°ç‚¹æ¨¡å—è®¾è®¡

- [ ] **åœ°ç‚¹æ•°æ®ç»“æ„**
  ```typescript
  interface Location {
    id: string;
    name: string;
    description: string;
    unlockConditions: {
      scenarios: string[];    // å“ªäº›å‰§æœ¬å¯ç”¨
      turnRange: [number, number];  // å“ªäº›å›åˆå¯ç”¨
    };
    rewards: {
      stamina?: number;
      love?: number;
      stats?: { vo?, da?, vi? };
    };
    aiPromptTemplate: string;  // AIå‰§æƒ…æç¤ºè¯æ¨¡æ¿
    imageUrl: string;          // åœ°ç‚¹å›¾ç‰‡
  }
  ```

- [ ] **åœ°ç‚¹åº“**
  - [ ] æµ·æ»©ï¼ˆä½“åŠ›æ¢å¤+å¥½æ„Ÿåº¦ï¼‰
  - [ ] å›¾ä¹¦é¦†ï¼ˆå…¨ä¸‰ç»´å°å¹…å¢é•¿ï¼‰
  - [ ] å’–å•¡å…ï¼ˆå¥½æ„Ÿåº¦å¤§å¹…å¢é•¿ï¼‰
  - [ ] å½•éŸ³å®¤ï¼ˆVocalå¢é•¿ï¼‰
  - [ ] èˆè¹ˆå®¤ï¼ˆDanceå¢é•¿ï¼‰
  - [ ] æ‘„å½±æ£šï¼ˆVisualå¢é•¿ï¼‰
  - [ ] å…¬å›­ï¼ˆä½“åŠ›æ¢å¤+éšæœºäº‹ä»¶ï¼‰
  - [ ] å•†ä¸šè¡—ï¼ˆè´­ä¹°é“å…·ï¼Œæœªæ¥æ‰©å±•ï¼‰
  - [ ] äº‹åŠ¡æ‰€ï¼ˆä¸å…¶ä»–å¶åƒäº’åŠ¨ï¼‰
  - [ ] æ¼”å”±ä¼šåœºé¦†ï¼ˆç‰¹æ®Šäº‹ä»¶ï¼‰

#### UIç»„ä»¶

- [ ] **FreeActivityMap.vue**
  - [ ] åœ°ç‚¹å¡ç‰‡ç½‘æ ¼å¸ƒå±€
  - [ ] åœ°ç‚¹è§£é”åŠ¨ç”»
  - [ ] åœ°ç‚¹é€‰æ‹©é«˜äº®
  - [ ] å¥–åŠ±é¢„è§ˆ

- [ ] **LocationCard.vue**
  - [ ] åœ°ç‚¹å›¾ç‰‡
  - [ ] åœ°ç‚¹åç§°
  - [ ] ç®€çŸ­æè¿°
  - [ ] å¥–åŠ±å›¾æ ‡
  - [ ] é”å®š/è§£é”çŠ¶æ€

**äº¤ä»˜ç‰©**:
- âŒ `FreeActivityMap.vue`
- âŒ `locations.json`ï¼ˆ10+ä¸ªåœ°ç‚¹æ•°æ®ï¼‰
- âŒ åœ°ç‚¹å›¾ç‰‡èµ„æº

---

### 4.2 å¥½æ„Ÿåº¦ç³»ç»Ÿ âŒ
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰+ åç«¯ï¼ˆSillyTavernï¼‰

**æ ¸å¿ƒç†å¿µ**: å¥½æ„Ÿåº¦ä¸å†åªæ˜¯"è§£é”å‰§æƒ…çš„é’¥åŒ™"ï¼Œè€Œæ˜¯"é²œæ´»çš„çŠ¶æ€"ã€‚æ¯æ¬¡AIäº¤äº’éƒ½ä¼šæ ¹æ®å½“å‰å¥½æ„Ÿåº¦ç­‰çº§ï¼Œä»ä¸–ç•Œä¹¦åŒºè¯»å–å¯¹åº”çš„"AIè¡¨ç°æŒ‡å¯¼"ï¼Œè®©ç©å®¶åœ¨æ¯ä¸€æ¬¡å¯¹è¯ã€æ¯ä¸€æ¬¡æ´»åŠ¨ä¸­ï¼Œéƒ½èƒ½æ„Ÿå—åˆ°å…³ç³»çš„è¿›æ­¥ã€‚

#### å¥½æ„Ÿåº¦ç­‰çº§è®¾è®¡

- [ ] **ç­‰çº§é˜ˆå€¼**
  ```typescript
  const AFFECTION_LEVELS = {
    1: 0,      // åˆè¯†
    2: 50,     // ç†Ÿæ‚‰
    3: 100,    // äº²è¿‘
    4: 200,    // ä¿¡èµ–
    5: 350,    // æ·±åš
    6: 550,    // æŒšå‹
    7: 800,    // ç‰¹åˆ«
    8: 1100,   // æ·±çˆ±
    9: 1450,   // ä¸å¯åˆ†å‰²
    10: 1850   // ç¾ç»Š
  };
  ```

- [ ] **AIè¡¨ç°æŒ‡å¯¼ï¼ˆä¸–ç•Œä¹¦åŒºï¼‰**
  ```typescript
  // lore/affection-behaviors/*.ts
  export const BOND_BEHAVIORS = {
    1: `[AIè¡¨ç°ï¼šç¤¼è²Œã€æ‹˜è°¨ã€ç§°å‘¼"åˆ¶ä½œäºº"ã€ä¿æŒè·ç¦»]`,
    2: `[AIè¡¨ç°ï¼šå¼€å§‹æ”¾æ¾ã€ä¼šä¸»åŠ¨æ‰“æ‹›å‘¼ã€ç§°å‘¼"åˆ¶ä½œäººå…ˆç”Ÿ"]`,
    3: `[AIè¡¨ç°ï¼šå‹å¥½ã€ä¼šåˆ†äº«è®­ç»ƒå¿ƒå¾—ã€å¶å°”å¼€ç©ç¬‘]`,
    4: `[AIè¡¨ç°ï¼šä¿¡ä»»ã€ä¼šå’¨è¯¢æ„è§ã€ç§°å‘¼"åˆ¶ä½œäººæ¡‘"]`,
    5: `[AIè¡¨ç°ï¼šäº²è¿‘ã€ä¼šåˆ†äº«å°ç§˜å¯†ã€å…³å¿ƒåˆ¶ä½œäººçš„èº«ä½“]`,
    6: `[AIè¡¨ç°ï¼šæŒšå‹ã€ä¼šæ’’å¨‡ã€ç§°å‘¼"P-chan"ã€çœ¼ç¥æ›´æ¸©æŸ”]`,
    7: `[AIè¡¨ç°ï¼šç‰¹åˆ«ã€ä¼šä¸»åŠ¨çº¦ä½ ã€å¸Œæœ›å¤šå¾…åœ¨ä¸€èµ·]`,
    8: `[AIè¡¨ç°ï¼šæ·±çˆ±ã€ä¼šå®³ç¾åœ°è¡¨è¾¾æ„Ÿæƒ…ã€å¾ˆåœ¨æ„ä½ çš„çœ‹æ³•]`,
    9: `[AIè¡¨ç°ï¼šä¸å¯åˆ†å‰²ã€å®Œå…¨ä¾èµ–ã€ä¼šè¯´"æ²¡æœ‰ä½ ä¸è¡Œ"è¿™æ ·çš„è¯]`,
    10: `[AIè¡¨ç°ï¼šç¾ç»Šã€è§†ä½ ä¸ºäººç”Ÿæœ€é‡è¦çš„äººã€ä¼šè¯´å‡ºå¿ƒåº•æœ€æ·±çš„è¯]`
  };
  
  // ä½¿ç”¨ç¤ºä¾‹ï¼š
  function getBondBehavior(bondLevel: number): string {
    const level = Math.floor(bondLevel / 50) + 1;
    return BOND_BEHAVIORS[Math.min(level, 10)];
  }
  ```

- [ ] **å¥½æ„Ÿåº¦å‰§æƒ…æ ‡é¢˜åº“**
  ```typescript
  // æ¯ä¸ªç­‰çº§è§£é”ä¸€ä¸ªç‰¹æ®Šå‰§æƒ…ï¼ˆå¯é€‰ï¼‰
  const AFFECTION_STORIES = {
    mano: {
      lv2: { title: "ç¬¬ä¸€æ¬¡çº¦ä¼š", unlocked: false },
      lv3: { title: "é›¨ä¸­é‚‚é€…", unlocked: false },
      lv4: { title: "èˆå°äº‹æ•…", unlocked: false },
      lv5: { title: "å¿ƒæ„ç›¸é€š", unlocked: false },
      lv6: { title: "å¤æ—¥ç¥­", unlocked: false },
      lv7: { title: "æ˜Ÿç©ºä¸‹çš„è¯‰è¯´", unlocked: false },
      lv8: { title: "é‡è¦çš„äºº", unlocked: false },
      lv9: { title: "ä¸å¯æ›¿ä»£", unlocked: false },
      lv10: { title: "æ°¸è¿œçš„çº¦å®š", unlocked: false }
    }
  };
  ```

#### UIç»„ä»¶

- [ ] **AffectionSystem.vue**
  - [ ] å¶åƒåˆ—è¡¨ï¼ˆ28ä¸ªï¼‰
  - [ ] å¥½æ„Ÿåº¦è¿›åº¦æ¡
  - [ ] ç­‰çº§æ˜¾ç¤ºï¼ˆ1-10ï¼‰
  - [ ] å‰§æƒ…è§£é”æŒ‰é’®

- [ ] **AffectionStoryPlayer.vue**
  - [ ] å¤ç”¨GalDialogueç»„ä»¶
  - [ ] æ›´é•¿çš„å‰§æƒ…æ”¯æŒ
  - [ ] CGå›¾ç‰‡å±•ç¤º
  - [ ] å‰§æƒ…å›æ”¾åŠŸèƒ½

#### AIå‰§æƒ…ç”Ÿæˆï¼ˆä½¿ç”¨PromptFactoryï¼‰

- [ ] **å¥½æ„Ÿåº¦å‰§æƒ…ç”Ÿæˆæµç¨‹**
  ```typescript
  // Vueç«¯ï¼šä½¿ç”¨PromptFactory
  async function playAffectionStory(idolId: string, level: number) {
    const bondLevel = localStorage.getItem(`${idolId}_bond`);
    const storyTitle = AFFECTION_STORIES[idolId][`lv${level}`].title;
    
    // ä½¿ç”¨PromptFactoryç»„è£…å®Œæ•´æç¤ºè¯
    const prompt = PromptFactory.assemblePrompt('AFFECTION_STORY', {
      persona: LORE[idolId],
      bond_level: bondLevel,
      bond_behavior: getBondBehavior(bondLevel),
      story_title: storyTitle,
      story_level: level
    });
    
    // å‘é€ç»™AI
    postMessage({
      type: 'SEND_PROMPT',
      payload: { full_prompt: prompt }
    });
    
    // æ¥æ”¶åæ˜¾ç¤ºåœ¨GalDialogueç»„ä»¶ä¸­
  }
  ```

- [ ] **å¥½æ„Ÿåº¦å‰§æƒ…æç¤ºè¯æ¨¡æ¿**
  ```typescript
  // prompt-factory/templates/affection-story.ts
  export const AFFECTION_STORY_TEMPLATE = `
  [System: å¥½æ„Ÿåº¦ç‰¹æ®Šå‰§æƒ…ç”Ÿæˆä»»åŠ¡ã€‚
  
  ã€è§’è‰²äººè®¾ã€‘ï¼š\${persona}
  ã€å¥½æ„Ÿåº¦ç­‰çº§ã€‘ï¼š\${bond_level}ï¼ˆç­‰çº§\${story_level}ï¼‰
  ã€AIè¡¨ç°æŒ‡å¯¼ã€‘ï¼š\${bond_behavior}
  ã€å‰§æƒ…æ ‡é¢˜ã€‘ï¼š\${story_title}
  
  ã€ä½ çš„ä»»åŠ¡ã€‘ï¼š
  1. ç”Ÿæˆä¸€æ®µ300å­—å·¦å³çš„å‰§æƒ…
  2. è¡¨ç°åˆ¶ä½œäººå’Œå¶åƒä¹‹é—´çš„æ·±åšç¾ç»Š
  3. ç¬¦åˆå½“å‰å¥½æ„Ÿåº¦ç­‰çº§çš„äº²å¯†ç¨‹åº¦
  4. åœºæ™¯è¦æ¸©é¦¨ã€ç•¥å¸¦æ„ŸåŠ¨
  5. ç»“å°¾è¦æœ‰æƒ…æ„Ÿå‡å
  6. ä½¿ç”¨ç¬¬äºŒäººç§°ï¼ˆ"ä½ "ï¼‰æ¥ç§°å‘¼åˆ¶ä½œäºº
  ]`;
  ```

#### ä½“éªŒå¯¹æ¯”

**æ—§ç³»ç»Ÿï¼ˆé™æ€å¥½æ„Ÿåº¦ï¼‰**:
- å¥½æ„Ÿåº¦1-49ï¼šAIè¯­æ°”å®Œå…¨ä¸€æ ·
- å¥½æ„Ÿåº¦50ï¼šè§£é”å‰§æƒ…2ï¼ŒAIè¯­æ°”çªç„¶æ”¹å˜
- ç©å®¶æ„Ÿå—ï¼šæœºæ¢°ã€çªå…€

**æ–°ç³»ç»Ÿï¼ˆé²œæ´»å¥½æ„Ÿåº¦ï¼‰**:
- å¥½æ„Ÿåº¦1ï¼šåŸ¹è‚²ç¬¬1å¤©ï¼Œå»å’–å•¡å… â†’ AIï¼š"åˆ¶ä½œäººï¼Œè¯·ç‚¹å•ã€‚"ï¼ˆç¤¼è²Œã€ç–è¿œï¼‰
- å¥½æ„Ÿåº¦50ï¼šåŸ¹è‚²ç¬¬10å¤©ï¼Œå»å’–å•¡å… â†’ AIï¼š"P-chanï¼Œä½ æƒ³å–ä»€ä¹ˆï¼Ÿæˆ‘è¯·å®¢~"ï¼ˆäº²è¿‘ã€æ’’å¨‡ï¼‰
- ç©å®¶æ„Ÿå—ï¼šè‡ªç„¶ã€æ¸è¿›ã€æœ‰æˆå°±æ„Ÿ

**äº¤ä»˜ç‰©**:
- âŒ `AffectionSystem.vue`
- âŒ å¥½æ„Ÿåº¦ç­‰çº§é…ç½®
- âŒ å¥½æ„Ÿåº¦å‰§æƒ…æ ‡é¢˜åº“ï¼ˆ28å¶åƒ Ã— 9ç­‰çº§ = 252ä¸ªæ ‡é¢˜ï¼‰
- âŒ `lore/affection-behaviors/*.ts`ï¼ˆ10çº§AIè¡¨ç°æŒ‡å¯¼ï¼‰

---

### 4.3 å¤šå‰§æœ¬å¼€å‘ âŒ
**è´Ÿè´£**: å‰ç«¯ï¼ˆVueï¼‰

- [ ] **WINGï¼ˆW.I.N.G.å‡†ä¼˜èƒœï¼‰** - å‡ºé“èµ›
  - [ ] å‰§æœ¬JSONé…ç½®
  - [ ] ç‰¹æ®Šè§„åˆ™ï¼ˆç¬¬1å›åˆå¼ºåˆ¶è®­ç»ƒï¼‰
  - [ ] 3ä¸ªå¯¹æ‰‹

- [ ] **æ„Ÿè°¢ç¥­** - ç²‰ä¸å›é¦ˆè¡¨æ¼”
  - [ ] æ›´æ³¨é‡Visualçš„æ¯”èµ›
  - [ ] ç²‰ä¸äº’åŠ¨äº‹ä»¶

- [ ] **GRADï¼ˆæ¯•ä¸šå…¸ç¤¼ï¼‰** - æ¯•ä¸šæ¼”å‡º
  - [ ] é•¿æœŸåŸ¹è‚²ï¼ˆ40å›åˆï¼‰
  - [ ] æ›´å¼ºçš„å¯¹æ‰‹

- [ ] **Landing Point** - é™è½ç‚¹
  - [ ] ç‰¹æ®Šæœºåˆ¶ï¼ˆéœ€è¦ç®¡ç†ä½“åŠ›ï¼‰

- [ ] **STEP** - å°é˜¶
  - [ ] é˜¶æ®µæ€§ç›®æ ‡

- [ ] **Say Hello** - é—®å€™
  - [ ] æ–°äººå‹å¥½å‰§æœ¬ï¼ˆ20å›åˆï¼‰

**äº¤ä»˜ç‰©**:
- âŒ 6ä¸ªå‰§æœ¬JSONæ–‡ä»¶
- âŒ å‰§æœ¬é€‰æ‹©ç•Œé¢

---

## Phase 5: ä¼˜åŒ–ä¸å®Œå–„ï¼ˆæœªå¼€å§‹ï¼‰

**ç›®æ ‡**: æ‰“ç£¨æ¸¸æˆä½“éªŒï¼Œä¿®å¤é—®é¢˜  
**é¢„è®¡æ—¶é—´**: 2-3å‘¨

### 5.1 æ€§èƒ½ä¼˜åŒ– âŒ

- [ ] **æŒ‰éœ€åŠ è½½ä¼˜åŒ–**
  - [ ] å›¾ç‰‡æ‡’åŠ è½½
  - [ ] éŸ³é¢‘æµå¼ä¼ è¾“
  - [ ] ç»„ä»¶æ‡’åŠ è½½ï¼ˆvue-routerï¼‰

- [ ] **æ‰“åŒ…ä¼˜åŒ–**
  - [ ] Code splitting
  - [ ] Tree shaking
  - [ ] å‹ç¼©èµ„æº

- [ ] **å†…å­˜ç®¡ç†**
  - [ ] é‡Šæ”¾æœªä½¿ç”¨çš„éŸ³é¢‘
  - [ ] é‡Šæ”¾æœªä½¿ç”¨çš„å›¾ç‰‡
  - [ ] å®šæœŸæ¸…ç†localStorage

---

### 5.2 UI/UXæ‰“ç£¨ âŒ

- [ ] **åŠ¨ç”»æ•ˆæœ**
  - [ ] GSAPåŠ¨ç”»ï¼ˆæ‰“å­—æœºã€æ·¡å…¥æ·¡å‡ºï¼‰
  - [ ] é¡µé¢è½¬åœºåŠ¨ç”»
  - [ ] æŒ‰é’®åé¦ˆåŠ¨ç”»

- [ ] **éŸ³æ•ˆ**
  - [ ] UIç‚¹å‡»éŸ³æ•ˆ
  - [ ] æŠ½å¡éŸ³æ•ˆ
  - [ ] èƒœåˆ©/å¤±è´¥éŸ³æ•ˆ

- [ ] **è§†è§‰åé¦ˆ**
  - [ ] åŠ è½½çŠ¶æ€ï¼ˆSkeleton Screenï¼‰
  - [ ] é”™è¯¯æç¤ºï¼ˆToastrï¼‰
  - [ ] æˆåŠŸæç¤º

---

### 5.3 ç”¨æˆ·å¼•å¯¼ âŒ

- [ ] **æ–°æ‰‹æ•™ç¨‹**
  - [ ] ä¸»é¡µé¢ä»‹ç»
  - [ ] æŠ½å¡æ•™ç¨‹
  - [ ] åŸ¹è‚²æ•™ç¨‹
  - [ ] æ‰“ç‰Œæ•™ç¨‹

- [ ] **å¸®åŠ©æ–‡æ¡£**
  - [ ] æ¸¸æˆè§„åˆ™è¯´æ˜
  - [ ] æ•°å€¼æœºåˆ¶è¯´æ˜
  - [ ] å¸¸è§é—®é¢˜FAQ

---

### 5.4 æµ‹è¯•ä¸ä¿®å¤ âŒ

- [ ] **åŠŸèƒ½æµ‹è¯•**
  - [ ] æ‰€æœ‰ç³»ç»ŸåŠŸèƒ½æµ‹è¯•
  - [ ] è¾¹ç•Œæ¡ä»¶æµ‹è¯•
  - [ ] é”™è¯¯å¤„ç†æµ‹è¯•

- [ ] **å…¼å®¹æ€§æµ‹è¯•**
  - [ ] Chrome/Edge/Firefox
  - [ ] ä¸åŒå±å¹•åˆ†è¾¨ç‡
  - [ ] ç§»åŠ¨ç«¯é€‚é…ï¼ˆå¯é€‰ï¼‰

- [ ] **æ€§èƒ½æµ‹è¯•**
  - [ ] é•¿æ—¶é—´æ¸¸ç©æµ‹è¯•
  - [ ] å†…å­˜æ³„æ¼æ£€æµ‹
  - [ ] ç½‘ç»œæ…¢é€Ÿæµ‹è¯•

---

### 5.5 å‘å¸ƒå‡†å¤‡ âŒ

- [ ] **æœ€ç»ˆæ£€æŸ¥æ¸…å•**ï¼ˆå‚è€ƒ`å‘å¸ƒå‰æ£€æŸ¥æ¸…å•.md`ï¼‰
  - [ ] æ¢å¤æµ‹è¯•ç”¨æ— é™ç¾½çŸ³ä¸º3000
  - [ ] ç§»é™¤æ‰€æœ‰console.log
  - [ ] ç§»é™¤å¼€å‘å·¥å…·é¢æ¿ï¼ˆæˆ–éšè—ï¼‰

- [ ] **æ–‡æ¡£å®Œå–„**
  - [ ] README.md
  - [ ] å®‰è£…è¯´æ˜
  - [ ] ä½¿ç”¨è¯´æ˜

- [ ] **èµ„æºæ•´ç†**
  - [ ] ç¡®è®¤æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ åˆ°GitHub Release
  - [ ] ç¡®è®¤æ‰€æœ‰éŸ³é¢‘ä¸Šä¼ åˆ°GitHub Release

- [ ] **å‘å¸ƒ**
  - [ ] Chub.aiä¸Šä¼ 
  - [ ] ç¤¾åŒºåˆ†äº«
  - [ ] æ”¶é›†åé¦ˆ

---

## ğŸ“Š è¿›åº¦è¿½è¸ª

### æ€»ä½“è¿›åº¦

| Phase   | åç§°       | çŠ¶æ€     | è¿›åº¦ | é¢„è®¡å®Œæˆæ—¶é—´ | æ¶æ„å˜åŒ–è¯´æ˜          |
| ------- | ---------- | -------- | ---- | ------------ | --------------------- |
| Phase 1 | åŸºç¡€æ¶æ„   | ğŸŸ¡ è¿›è¡Œä¸­ | 60%  | å·²å®Œæˆ3/4å‘¨  | âœ… ç§»é™¤MVUä¾èµ–         |
| Phase 2 | æ ¸å¿ƒç©æ³•   | âŒ æœªå¼€å§‹ | 0%   | 8-10å‘¨       | ğŸ†• æ–°å¢æç¤ºè¯åŠ å·¥å‚    |
| Phase 3 | AIå™äº‹é›†æˆ | âŒ æœªå¼€å§‹ | 0%   | 3å‘¨          | â¬ ç®€åŒ–ï¼ˆç§»é™¤MVUåŒæ­¥ï¼‰ |
| Phase 4 | å†…å®¹å¡«å……   | âŒ æœªå¼€å§‹ | 0%   | 4å‘¨          | ğŸ”„ å¥½æ„Ÿåº¦ç³»ç»Ÿé‡æ„      |
| Phase 5 | ä¼˜åŒ–ä¸å®Œå–„ | âŒ æœªå¼€å§‹ | 0%   | 2-3å‘¨        | æ— å˜åŒ–                |

### å…³é”®é‡Œç¨‹ç¢‘

- [x] **é‡Œç¨‹ç¢‘1**: æŠ½å¡ç³»ç»Ÿå®Œæˆï¼ˆâœ… 2025-10-29ï¼‰
- [x] **é‡Œç¨‹ç¢‘2**: éŸ³ä¹ç³»ç»Ÿå®Œæˆï¼ˆâœ… 2025-10-26ï¼‰
- [ ] **é‡Œç¨‹ç¢‘3**: iframeé€šä¿¡ç³»ç»Ÿå®Œæˆï¼ˆğŸ¯ ä¸‹ä¸€æ­¥ï¼‰
- [ ] **é‡Œç¨‹ç¢‘4**: æç¤ºè¯åŠ å·¥å‚ç³»ç»Ÿå®Œæˆï¼ˆğŸ†• æ–°å¢ï¼‰
- [ ] **é‡Œç¨‹ç¢‘5**: å¡ç‰Œæˆ˜æ–—ç³»ç»Ÿå®Œæˆ
- [ ] **é‡Œç¨‹ç¢‘6**: P-ProduceåŸ¹è‚²ç³»ç»Ÿå®Œæˆ
- [ ] **é‡Œç¨‹ç¢‘7**: AIå‰§æƒ…ç”Ÿæˆå®Œæˆ
- [ ] **é‡Œç¨‹ç¢‘8**: å®Œæ•´æ¸¸æˆå¾ªç¯å¯ç©
- [ ] **é‡Œç¨‹ç¢‘9**: é¡¹ç›®å‘å¸ƒ

### æ¶æ„å˜é©æ€»ç»“ ğŸ¯

**2025-10-31 é‡å¤§æ¶æ„æ›´æ–°**ï¼ˆåŸºäºä¸Geminiçš„è®¨è®ºï¼‰ï¼š

1. **âŒ ç§»é™¤MVUç³»ç»Ÿ**
   - localStorageæˆä¸ºå”¯ä¸€æ•°æ®æº
   - æ‰€æœ‰å˜é‡ï¼ˆåŒ…æ‹¬å¥½æ„Ÿåº¦ï¼‰éƒ½åœ¨localStorageä¸­ç®¡ç†
   - ä¸å†éœ€è¦Vue â†” MVUçš„åŒæ­¥é€»è¾‘

2. **ğŸ†• æ–°å¢æç¤ºè¯åŠ å·¥å‚**
   - **ä¸–ç•Œä¹¦åŒº**ï¼šæ¨¡å—åŒ–å­˜å‚¨è§’è‰²äººè®¾ã€å¡ç‰Œæœºåˆ¶ã€å¥½æ„Ÿåº¦è¡¨ç°ã€åœ°ç‚¹æè¿°ç­‰
   - **æç¤ºè¯æ¨¡æ¿**ï¼šé¢„å®šä¹‰çš„æ¡†æ¶ï¼Œå¸¦æœ‰å ä½ç¬¦
   - **PromptFactoryç±»**ï¼šæ ¹æ®æ¸¸æˆçŠ¶æ€åŠ¨æ€ç»„è£…å®Œæ•´æç¤ºè¯
   - ä¼˜åŠ¿ï¼šé›¶è®¾ç½®ã€åŠ¨æ€æç¤ºè¯ã€Tokené«˜æ•ˆã€é›†ä¸­ç®¡ç†

3. **ğŸ”„ å¥½æ„Ÿåº¦ç³»ç»Ÿé‡æ„**
   - ä»"è§£é”é’¥åŒ™"å˜ä¸º"é²œæ´»çŠ¶æ€"
   - æ¯æ¬¡AIäº¤äº’éƒ½æ ¹æ®å¥½æ„Ÿåº¦ç­‰çº§æ’å…¥"AIè¡¨ç°æŒ‡å¯¼"
   - ç©å®¶åœ¨æ¯æ¬¡å¯¹è¯ã€æ´»åŠ¨ä¸­éƒ½èƒ½æ„Ÿå—åˆ°å…³ç³»è¿›æ­¥

4. **âš¡ loaderè„šæœ¬ç®€åŒ–**
   - ä»"æ™ºèƒ½ä¸­é—´ä»¶"å˜ä¸º"çº¯ç²¹ä¼ è¯ç­’"
   - åªè´Ÿè´£ï¼šæ¥æ”¶å®Œæ•´æç¤ºè¯ â†’ å‘é€ç»™AI â†’ æ‹¦æˆªå›å¤ â†’ è½¬å‘å›Vue
   - ä¸å†éœ€è¦ç†è§£æ¸¸æˆé€»è¾‘

5. **ğŸ´ URå¡æ–°å¢**
   - æ–°å¢URç¨€æœ‰åº¦ï¼ˆ3å¼ åŸºç¡€URï¼‰
   - å®šä¹‰URå¹³è¡¡è§„åˆ™ï¼šCost 4-6ï¼Œå‹å€’æ€§/é¢ è¦†æ€§æ•ˆæœ
   - Card Generation Botæ›´æ–°ä¸ºæ”¯æŒR/SR/SSR/URå››æ¡£

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³ä¼˜å…ˆçº§ï¼ˆæœ¬å‘¨ï¼‰âš¡

**æ¶æ„å˜é©åçš„æ–°ä¼˜å…ˆçº§**ï¼š

1. **å®ŒæˆPhase 1.6: iframeé€šä¿¡ç³»ç»Ÿï¼ˆç®€åŒ–ç‰ˆï¼‰**
   - åˆ›å»º`idolmaster_loader.html`ï¼ˆçº¯ä¼ è¯ç­’ç‰ˆæœ¬ï¼‰
   - å®ç°postMessageåŒå‘é€šä¿¡
   - å®ç°chat:receivedæ‹¦æˆª
   - âŒ **ä¸å†éœ€è¦**ï¼šMVUåŒæ­¥é€»è¾‘
   - æµ‹è¯•ï¼šå‘é€å®Œæ•´æç¤ºè¯ â†’ AIå›å¤ â†’ è½¬å‘å›Vue

2. **å¼€å§‹Phase 2.0: æç¤ºè¯åŠ å·¥å‚ç³»ç»Ÿ**
   - åˆ›å»º`lore/`æ–‡ä»¶å¤¹ç»“æ„
   - åˆ›å»º`prompt-factory/`æ–‡ä»¶å¤¹ç»“æ„
   - å®ç°`PromptFactory.ts`æ ¸å¿ƒç±»
   - åˆ›å»ºç¬¬ä¸€ä¸ªæ¨¡æ¿ï¼ˆCARD_GENERATION_TEMPLATEï¼‰
   - åˆ›å»ºç¬¬ä¸€ä¸ªä¸–ç•Œä¹¦æ¨¡å—ï¼ˆLORE_MANO + MECHANIC_VOCALï¼‰

### çŸ­æœŸç›®æ ‡ï¼ˆæœ¬æœˆï¼‰

1. **å®Œæˆæç¤ºè¯åŠ å·¥å‚åŸºç¡€è®¾æ–½**
   - å®Œæˆæ‰€æœ‰æç¤ºè¯æ¨¡æ¿ï¼ˆå†™å¡ã€è‡ªç”±æ´»åŠ¨ã€è®­ç»ƒã€ç»“å±€ï¼‰
   - å®Œæˆä¸–ç•Œä¹¦åŒºï¼ˆ28å¶åƒäººè®¾ã€å¡ç‰Œæœºåˆ¶ã€10çº§å¥½æ„Ÿåº¦è¡¨ç°ï¼‰
   
2. **å¼€å§‹Phase 2.1: å¡ç‰Œæˆ˜æ–—ç³»ç»ŸUI**
   - è®¾è®¡å¡ç‰Œæ¨¡æ¿ï¼ˆæ”¯æŒURï¼‰
   - åˆ›å»ºCardGame.vueåŸºç¡€ç•Œé¢
   - å®ç°åŸºç¡€çš„æ‹–æ‹½äº¤äº’

3. **å®ŒæˆAIå¡ç‰Œç”Ÿæˆç³»ç»Ÿ**
   - åˆ›å»ºCard Generation Botè§’è‰²å¡ï¼ˆåŒ…å«R/SR/SSR/URè§„åˆ™ï¼‰
   - æµ‹è¯•AIç”Ÿæˆå„ç¨€æœ‰åº¦å¡ç‰Œ
   - é›†æˆåˆ°æŠ½å¡ç³»ç»Ÿ

### ä¸­æœŸç›®æ ‡ï¼ˆä¸‹ä¸ªæœˆï¼‰

1. **å®Œæˆå¡ç‰Œæˆ˜æ–—ç³»ç»Ÿæ ¸å¿ƒé€»è¾‘**
2. **å®Œæˆå¯¹æˆ˜è€…æ¨¡æ‹Ÿ**
3. **å®ŒæˆP-ProduceåŸ¹è‚²ç³»ç»Ÿæ¡†æ¶**
4. **å®ç°ç¬¬ä¸€ä¸ªå®Œæ•´çš„å‰§æœ¬ï¼ˆWINGï¼‰+ AIå‰§æƒ…ç”Ÿæˆ**

### é•¿æœŸç›®æ ‡ï¼ˆ2-3ä¸ªæœˆï¼‰

1. **å®Œæˆæ‰€æœ‰6ä¸ªå‰§æœ¬**
2. **å®Œæˆå¥½æ„Ÿåº¦ç³»ç»Ÿï¼ˆ28å¶åƒ Ã— 10ç­‰çº§ï¼‰**
3. **å¡«å……è‡ªç”±æ´»åŠ¨åœ°ç‚¹ï¼ˆ10+ä¸ªï¼‰**
4. **æ€§èƒ½ä¼˜åŒ–ä¸æ‰“ç£¨**
5. **é¡¹ç›®å‘å¸ƒ**

---

**å½“å‰çŠ¶æ€**: ğŸŸ¡ Phase 1è¿›è¡Œä¸­ï¼ˆ60%å®Œæˆï¼‰  
**æ¶æ„å˜é©**: âœ… 2025-10-31 å®Œæˆæ¶æ„è®¾è®¡æ›´æ–°  
**ä¸‹ä¸€æ­¥**: ğŸ¯ å®ç°iframeé€šä¿¡ç³»ç»Ÿï¼ˆç®€åŒ–ç‰ˆï¼‰+ æç¤ºè¯åŠ å·¥å‚  
**é¢„è®¡é¡¹ç›®å®Œæˆæ—¶é—´**: 2026å¹´3-4æœˆï¼ˆæ¶æ„ç®€åŒ–åå¯èƒ½æå‰ï¼‰

### æ¶æ„å˜é©å¸¦æ¥çš„å¥½å¤„ ğŸ‰

âœ… **å¼€å‘æ•ˆç‡æå‡**ï¼šç§»é™¤MVUåŒæ­¥é€»è¾‘ï¼Œä»£ç é‡å‡å°‘çº¦20%  
âœ… **ç”¨æˆ·ä½“éªŒæå‡**ï¼šå¥½æ„Ÿåº¦å˜"é²œæ´»"ï¼Œæ¯æ¬¡äº¤äº’éƒ½æœ‰æ„ä¹‰  
âœ… **å¯ç»´æŠ¤æ€§æå‡**ï¼šæ‰€æœ‰"å¤§è„‘"é›†ä¸­åœ¨Vueï¼Œæ˜“äºè°ƒè¯•å’Œæ›´æ–°  
âœ… **åˆ†å‘ä¾¿åˆ©æ€§**ï¼šé›¶è®¾ç½®ï¼Œç”¨æˆ·åªéœ€å¯¼å…¥ä¸€ä¸ªHTML  
âœ… **AIç”Ÿæˆè´¨é‡**ï¼šåŠ¨æ€æç¤ºè¯å¸¦æ¥æ›´é«˜è´¨é‡ã€æ›´ç¬¦åˆä¸Šä¸‹æ–‡çš„AIå›å¤


