# 🧪 测试新卡面系统指南

## 快速开始

### 1. 启动开发服务器

```bash
cd E:\偶像大师\tavern_helper_template
pnpm run dev
```

### 2. 在浏览器中打开

等待编译完成后，浏览器会自动打开或访问提示的地址（通常是 `http://localhost:5173`）

---

## 测试项目

### ✅ 测试1: 抽卡功能

1. 打开抽卡页面
2. **打开浏览器控制台** (F12 → Console标签)
3. 尝试 **单抽**
   - 观察卡面是否正常显示
   - 检查控制台是否有错误
4. 尝试 **十连**
   - 观察动画是否流畅
   - 检查所有卡面是否加载成功

**预期结果**:
- ✅ 卡面图片正常显示
- ✅ 控制台输出: `🎴 抽卡结果: { card: '【xxx】xxx', ... }`
- ✅ 控制台输出: `🎴 卡池统计: { UR: 0, SSR: 399, SR: 0, R: 0 }`
- ❌ 无404错误
- ❌ 无图片加载失败

---

### ✅ 测试2: 偶像图鉴

1. 打开主界面
2. 点击 **设置** → **开发者选项**
3. 点击 **"获取全部偶像"** 按钮
4. 点击 **"偶像图鉴"** 按钮

**预期结果**:
- ✅ 显示 **399张卡面**
- ✅ 所有卡面都是彩色（已拥有状态）
- ✅ 可以点击查看卡面详情
- ✅ 可以按稀有度、角色筛选
- ❌ 无404错误
- ❌ 无卡面显示为灰色或加载失败

---

### ✅ 测试3: URL格式检查

1. 打开浏览器开发者工具 (F12)
2. 切换到 **Network** 标签
3. 在过滤框输入: `webp`
4. 进行抽卡操作

**预期URL格式**:
```
https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/角色卡面/主题名%20角色名.webp
```

**示例**:
```
https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/角色卡面/loading...%20市川雛菜.webp
https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/角色卡面/ちいさな巣立ち%20福丸小糸.webp
```

**注意**: 空格会被编码为 `%20`

**预期结果**:
- ✅ 所有图片请求返回 `200 OK`
- ✅ URL中文字符正确编码
- ❌ 无404 Not Found
- ❌ 无403 Forbidden

---

### ✅ 测试4: 控制台日志

查看控制台输出，确认以下信息：

**启动时**:
```
🎴 卡池统计: {UR: 0, SSR: 399, SR: 0, R: 0}
```

**抽卡时**:
```
🎴 抽卡结果: {
  card: '【主题名】角色名',
  character: '角色名',
  rarity: 'SSR',
  isNew: 'NEW!' 或 '重复',
  pity: 'SSR: X/200, UR: Y/300'
}
```

**打开图鉴时**:
```
💾 从IndexedDB加载用户数据成功
```

---

### ✅ 测试5: IndexedDB数据

1. 打开浏览器开发者工具 (F12)
2. 切换到 **Application** 标签 (Chrome) 或 **Storage** 标签 (Firefox)
3. 展开 **IndexedDB** → **shinycolors_game_data**
4. 查看 **gacha** 存储

**预期结果**:
- ✅ `ownedCards` 对象包含卡片数据
- ✅ 卡片ID格式: `【主题名】角色名`
- ✅ 每个卡片有 `fullName`, `obtainedAt`, `hasSkill` 字段

---

## 常见问题排查

### ❌ 卡面显示404错误

**检查**:
1. 控制台中的完整URL
2. URL中的文件名是否正确
3. GitHub CDN是否可访问

**解决**:
- 检查 `constants.ts` 中的 `CARD_IMAGE_BASE`
- 确认GitHub仓库中存在该文件

---

### ❌ 卡池显示为空 (0张卡)

**检查**:
```javascript
// 在控制台输入:
console.log(ALL_CARDS.length)
```

**预期输出**: `399`

**如果不是399**:
- 重新运行 `node E:\偶像大师\regenerate-card-data.js`
- 重启dev服务器

---

### ❌ 偶像图鉴显示不完整

**检查**:
1. 控制台是否有错误
2. `totalCount` 是否为399
3. `ownedCount` 是否等于 `totalCount`（开启获取全部偶像后）

**解决**:
- 打开偶像图鉴组件的代码
- 检查 `ALL_CARDS` 导入是否正确

---

### ❌ 图片加载很慢

**这是正常的**:
- GitHub Raw CDN在国内访问较慢
- IndexedDB缓存会在第一次加载后生效
- 第二次打开会从缓存读取，速度极快

**加速方法**:
1. 使用科学上网
2. 等待IndexedDB缓存生效
3. 后续访问会快很多

---

## 成功标准

- ✅ 抽卡功能正常，卡面全部显示
- ✅ 偶像图鉴显示399张卡面
- ✅ 无404或图片加载错误
- ✅ IndexedDB数据保存正常
- ✅ 控制台无报错

---

## 如有问题

如果测试中发现任何问题，请提供：
1. 控制台完整错误信息
2. Network标签中失败的请求URL
3. 具体的复现步骤

---

**开始测试吧！** 🚀










